<!DOCTYPE html><html lang="zh-Hans" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Linux-Puppet | YouNeed</title><meta name="keywords" content="automation"><meta name="author" content="Waylon Yan"><meta name="copyright" content="Waylon Yan"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1、认识puppet1.1 引入　　puppet是什么，咱们先不用专业的名词解释它，咱们先描述一些工作场景，看明白这些工作场景，自然会知道puppet是什么。  （1）场景一： 　　管理员想要在100台服务器上同时创建一个名叫”along”的用户，怎么办，当然，我们可以”手动解决”，登录每一台服务器，然后一台一台的创建用户，如果你真的这样干，那么我只能说，算你狠！！！但是，既然我们这篇文章是介绍p">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux-Puppet">
<meta property="og:url" content="https://waylon.whatyouneed.site/2022/08/25/Linux-Puppet/index.html">
<meta property="og:site_name" content="YouNeed">
<meta property="og:description" content="1、认识puppet1.1 引入　　puppet是什么，咱们先不用专业的名词解释它，咱们先描述一些工作场景，看明白这些工作场景，自然会知道puppet是什么。  （1）场景一： 　　管理员想要在100台服务器上同时创建一个名叫”along”的用户，怎么办，当然，我们可以”手动解决”，登录每一台服务器，然后一台一台的创建用户，如果你真的这样干，那么我只能说，算你狠！！！但是，既然我们这篇文章是介绍p">
<meta property="og:locale">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png">
<meta property="article:published_time" content="2022-08-25T07:42:51.000Z">
<meta property="article:modified_time" content="2022-08-25T14:26:15.784Z">
<meta property="article:author" content="Waylon Yan">
<meta property="article:tag" content="automation">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://waylon.whatyouneed.site/2022/08/25/Linux-Puppet/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Linux-Puppet',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-08-25 22:26:15'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.0.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">253</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">39</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">24</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">YouNeed</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Linux-Puppet</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-08-25T07:42:51.000Z" title="Created 2022-08-25 15:42:51">2022-08-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-08-25T14:26:15.784Z" title="Updated 2022-08-25 22:26:15">2022-08-25</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux/">Linux</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Linux-Puppet"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="1、认识puppet"><a href="#1、认识puppet" class="headerlink" title="1、认识puppet"></a>1、认识puppet</h2><h4 id="1-1-引入"><a href="#1-1-引入" class="headerlink" title="1.1 引入"></a><strong>1.1 引入</strong></h4><p>　　puppet是什么，咱们先不用专业的名词解释它，咱们先描述一些工作场景，看明白这些工作场景，自然会知道puppet是什么。</p>
<p> （1）场景一：</p>
<p>　　管理员想要在100台服务器上同时创建一个名叫”along”的用户，怎么办，当然，我们可以”手动解决”，登录每一台服务器，然后一台一台的创建用户，如果你真的这样干，那么我只能说，算你狠！！！但是，既然我们这篇文章是介绍puppet的，我们肯定会推荐你使用puppet解决这个问题。</p>
<p>（2）场景二：</p>
<p>　　公司新买了一堆云服务器，这些服务器最终可能要提供相同的服务，现在需要管理员在这一堆服务器上安装一些相同的应用，而且安装完成后，还需要这些服务器上的应用自动启动，怎么办，当然，手动解决算你狠，兄弟我服了，你说你写脚本解决，嗯，这是个办法，在我没有认识puppet之前我可能也会写个脚本，但是我们是介绍puppet的，我们会推荐你使用puppet解决这个问题。</p>
<p>（3）场景三：</p>
<p>　　在一些服务器中，执行大批量的重复操作，我们可以使用puppet。</p>
<p>　　看完上述三个场景，你应该已经大概猜出puppet是干吗的了，没错，说的糙一点，你可以把它理解成批量处理工具，但是你又不能完全把它理解成批量处理工具，因为除了批量处理，他还有一些别的功能和特性，我们暂且先这么认为，以便我们入门。</p>
<h4 id="1-2-介绍"><a href="#1-2-介绍" class="headerlink" title="1.2 介绍"></a><strong>1.2 介绍</strong></h4><p>（1）我自己对puppet的了解</p>
<p>　　像puppet这种工具有几个专业的名词可以用来称呼它们：”配置管理工具”、”自动化运维管理工具”。</p>
<p>　　Linux中，常见的配置管理工具有puppet、saltstack、ansible、chef等，它们的功能类似，puppet算是这个领域里面的老大哥，时间久（我说的是创始时间久，不要想歪了····），成熟，被广泛的应用，google、twitter、redhat，cisco等大公司都用到了它，功能强大，<strong>puppet是使用ruby研发的</strong>，<strong>saltstack和ansible都属于python系的</strong>， ansible和saltstack与puppet相比，属于后起之秀，我们以后也可能会对它们进行总结，但是现在，我们只聊puppet。</p>
<p>（2）专业术语介绍</p>
<ul>
<li>① puppet是一种Linux/Unix平台下的<strong>集中配置管理系统</strong>，使用自有的puppet描述语言，可管理<strong>配置文件、用户、cron任务、软件包、系统服务</strong>等。puppet把这些系统实体称之为<strong>资源</strong>，puppet的设计目标是简化对这些资源的管理以及妥善处理资源间的依赖关系。</li>
<li>② Puppet是开源的基于<strong>Ruby</strong>的系统配置管理工具，puppet是一个<strong>C/S结构</strong>。所有的puppet客户端同一个服务器端的puppet通讯，每个puppet客户端每半小时(可以设置)连接一次服务器端，下载最新的配置文件，并且严格按照配置文件来配置服务器。 配置完成以后,puppet客户端可以反馈给服务器端一个消息， 如果出错,也会给服务器端反馈一个消息。</li>
<li>③ Puppet是用于大规模集群管理的神器。其本身使用Ruby语言开发，基于C/S架构。在每台机器上部署的客户端每隔一个指定的时间会连接到Master检查资源变化情况，若资源发生变化，将按配置动作进行相应的操作。</li>
<li>④ <strong>Puppet将所有可操作对象抽象为资源</strong>，目前涵盖了40多种，如：File、User、Group、Host、Package、Service、Cron、Exec等，下面我会一一讲述。</li>
<li>⑤ Puppet 通过抽象资源的方式，使得每台机器能够“清楚”其本身“应该”是什么“状态”，而客户端根据当前是否达到这个状态决定采取指定的动作。这使得Puppet 不仅可用于传统的应用部署，而且通过合理的手段，也能够将比应用部署更频繁的配置管理一并解决。甚至可以在Master端外接自己开发的平台，通过集中配 置方式管理各项“资源”，实现高度灵活的自动化管理体系。</li>
</ul>
<h4 id="1-3-puppet-名词解释"><a href="#1-3-puppet-名词解释" class="headerlink" title="1.3 puppet 名词解释"></a>1.3 puppet 名词解释</h4><ul>
<li><strong>资源：</strong>是puppet的核心，通过资源申报，定义在资源清单中。相当于ansible中的模块，只是抽象的更加彻底。</li>
<li><strong>类：</strong>一组资源清单。</li>
<li><strong>模块：</strong>包含多个类。相当于ansible中的角色。</li>
<li><strong>站点清单：</strong>以主机为核心，应用哪些模块。</li>
</ul>
<p>本篇文章主要讲解资源；类、模块、站点清单都在下篇进行详解。 </p>
<h4 id="1-4-puppet常用资源类型"><a href="#1-4-puppet常用资源类型" class="headerlink" title="1.4 puppet常用资源类型"></a><strong>1.4 puppet常用资源类型</strong></h4><table>
<thead>
<tr>
<th>group</th>
<th>组</th>
</tr>
</thead>
<tbody><tr>
<td>user</td>
<td>用户</td>
</tr>
<tr>
<td>packge</td>
<td>程序包</td>
</tr>
<tr>
<td>service</td>
<td>服务</td>
</tr>
<tr>
<td>file</td>
<td>文件</td>
</tr>
<tr>
<td>exec</td>
<td>执行自定义命令</td>
</tr>
<tr>
<td>cron</td>
<td>周期性任务计划</td>
</tr>
<tr>
<td>notify</td>
<td>通知</td>
</tr>
<tr>
<td>yumrepo</td>
<td>源</td>
</tr>
<tr>
<td>host</td>
<td>/etc/hosts中主机解析</td>
</tr>
</tbody></table>
<h4 id="1-5-puppet命令使用"><a href="#1-5-puppet命令使用" class="headerlink" title="1.5 puppet命令使用"></a><strong>1.5 puppet命令使用</strong></h4><p>（1）查询资源类型和帮助信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">puppet describe [-h|--help] [-s|--short] [-p|--providers] [-l|--list] [-m|--meta] [&#96;&#96;type&#96;&#96;]</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>-l</strong>：列出所有资源类型；</li>
<li><strong>-s</strong>：显示指定类型的<strong>简要</strong>帮助信息；也就是基本选项</li>
<li><strong>-m</strong>：显示指定类型的<strong>元参数</strong>，一般与-s 一同使用；这些选项只是来描述这个类型的</li>
</ul>
<p>（2）执行资源清单命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">puppet apply [-h|--help] [-V|--version] [-d|--debug] [-&#96;&#96;v&#96;&#96;|--verbose] [-e|--execute] [--detailed-exitcodes] [-l|--logdest &lt;&#96;&#96;file&#96;&#96;&gt;] [--noop] [--catalog &lt;catalog&gt;] [--write-catalog-summary] &lt;&#96;&#96;file&#96;&#96;&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>-d：打开调试信息，会显示很多信息</li>
<li>-v：显示详细信息</li>
<li>-e：直接执行给定的命令</li>
<li>-l：执行结果保存到指定日志的文件中，否则执行结果会输出到标准输出</li>
<li><strong>–noop：dry run</strong> <strong>干跑</strong>，只是测试的跑一边，不真正的执行</li>
<li>–catalog：应用JSON目录</li>
</ul>
<h4 id="1-6-puppet的优缺点"><a href="#1-6-puppet的优缺点" class="headerlink" title="1.6 puppet的优缺点"></a><strong>1.6 puppet的优缺点</strong></h4><p>　　这类垂直管理系统的使用及活跃，<strong>极大减轻了运维人员在重复性、批量化操作方面的负担</strong>，能够非常有效地在各自领域完成既定的运维子目标。但其缺陷在于只能针对某一垂直领域的特定问题进行高效处理，对于它们之间的<strong>关联性很难应对</strong>。因为运维的本质是保证服务的可用性，而自动化运维则是在完全保证这一前提下，尽可能将需要人干涉的部分处理掉，所以判断其优劣的标准则是——与人工处理比，对服务的保证有没有提高。如果仅是解决报警、部署这些单一动作，后续仍然需要人去处理、去关注、去判断的话，就离这个目标还有距离，谈不上真正的自动化，只能算是工具化。</p>
<p>　　puppet是一个<strong>开源</strong>的软件自动化配置和部署工具，它<strong>使用简单且功能强大</strong>，正得到了越来越多地关注，现在很多大型IT公司均在使用puppet对集群中的软件进行管理和部署，如google利用puppet管理超过6000台地mac桌面电脑（2007年数据）。</p>
<p>　　puppet设计架构是基于c/s架构的。服务器端保存着所有对客户端服务器的配置代码，在puppet里面叫做manifest. 客户端下载manifest之后，可以根据manifest对服务器进行配置，例如软件包管理，用户管理和文件管理等等。</p>
<h2 id="2、puppet的使用模型及工作流程"><a href="#2、puppet的使用模型及工作流程" class="headerlink" title="2、puppet的使用模型及工作流程"></a>2、puppet的使用模型及工作流程</h2><p>　　puppet的使用模型分为 <strong>单机使用模型</strong> 和 <strong>master/agent模型</strong>；本文主要讲解单机使用模型，便于入门。</p>
<h4 id="2-1-master-agent模型"><a href="#2-1-master-agent模型" class="headerlink" title="2.1 master/agent模型"></a><strong>2.1 master/agent模型</strong></h4><p>　　从上述专业的解释中，我们可以得知puppet是<strong>C/S架构</strong>的，也就是说，它有服务端，也有客户端，管理员可以通过puppet服务端（master），管理每一台被管理的服务器，但是需要puppet客户端作为中介，也就是说，puppet客户端作为代理（agent），接收来自puppet服务端的配置信息，按照服务端（master）发送过来的配置信息，对被管理服务器进行配置，真正执行配置操作的是puppet客户端，puppet服务端只负责将配置信息准备好，发送给puppet客户端，以便客户端执行具体操作，puppet客户端还有另一个作用，就是向puppet服务端发送报告，当客户端按照配置信息执行完成相关配置以后，会将执行信息发送到服务端，比如执行成功与否，执行结果等，默认情况下，每30分钟，puppet客户端会向puppet服务端发起一次请求，请求受管理服务器的配置信息， puppet服务端将配置信息发送给客户端，客户端根据反回的信息进行判断，判断被管理服务器是否符合管理员定义的配置，puppet的这种工作模式就是C/S架构的，也可以理解为<strong>master/agent的工作模式</strong>，用文字描述显得太无力，我们画个图来看看。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Waylonwhynot/whatyouneed_blog_pic@main/pic/1216496-20190214111911208-212217973.png" alt="img"></p>
<p>　　那么，我们把上图中的两台服务器拿出来，详细说说它们之间的具体工作流程，但是此处我们需要说明，在master/agent模型下工作的puppet的工作流程比我们总结的要复杂一点，但是为了入门方便，我们只取出其中的一部分核心的流程进行总结，在后面的实际应用中，我们会不断的丰富这些流程，此处先给出一个简化过的流程图，如下图所示。</p>
<p><img src="https://img2018.cnblogs.com/blog/1216496/201902/1216496-20190214111924632-1223803372.png" alt="img"></p>
<p><strong>过程分析：</strong></p>
<p>① 客户端puppet agent请求catalog，我们已经说过，catalog其实就是被管理服务器对应的配置文件（经过处理过的配置文件），服务端master收到agent的请求，然后找到对应被管理服务器的**”站点清单”<strong>，或者被称为”主机清单”，因为一台”被管理服务器”可能同时担任多个</strong>“角色”<strong>，每个角色可能都会对应一个</strong>“manifest”（也就是清单）**，所以，我们可以为每一台被管理服务器配置一个”站点清单”，站点清单也可以理解成为一种”清单”，只是它是针对一台服务器而存在的一种清单。</p>
<p>② 服务端master找到被管理服务器的站点清单后，<strong>根据站点清单，找到对应服务器需要哪些”清单”，</strong>因为一台服务器可能会需要多张”清单”，上图中为了示例，只画出了一个清单，但是这不代表必定只有一个。</p>
<p>③ master将找到的所有”清单”进行处理，<strong>处理为catalog</strong>。</p>
<p>④ master将处理过的<strong>catalog发送到agent端</strong>。</p>
<p>⑤ agent收到master发送过来的catalog，然后，agent会**查询”被管理服务器的当前状态”**，看看服务器的当前状态是否符合catalog中定义的目标状态。</p>
<p>⑥ 如果”被管理服务器的当前状态”与”catalog中定义的目标状态”一致，那么资源对应的操作将不会执行，如果”被管理服务器的当前状态”与”catalog中定义的目标状态”不一致，那么资源对应的操作将会执行，以便**让”被管理服务器”达到管理员指定的”目标状态”**。</p>
<p>⑦ 经过上一步的”状态判断”，执行对应操作，不管执行是否成功，都会<strong>生成对应的报告信息</strong>。</p>
<p>⑧ agent将<strong>生成的报告信息</strong>发送给master端。 </p>
<p>　　上述过程，就是puppet在master/agent模式下的工作流程，我们说过，默认情况下，客户端每隔30分钟向服务端请求一次配置信息，然后根据服务端返回的配置信息，判断当前服务器是否处于管理员定义的目标状态，如果被管理的服务器不处于管理员定义的目标状态，则需要执行对应的操作，使得被管理主机最终处于管理员定义的目标状态，我们也可以不必每次都等待30分钟，我们可以从master端推送catalog到agent端，主动告诉agent端，配置已经发生了改变，请执行对应的操作。这是后话，我们以后再聊。</p>
<h4 id="2-2-单机使用模型"><a href="#2-2-单机使用模型" class="headerlink" title="2.2 单机使用模型"></a><strong>2.2 单机使用模型</strong></h4><p>　　当然，puppet也可以不在master/agent模式下工作，我们可以在受管理服务器上<strong>只安装puppet客户端</strong>，使用客户端手动执行对应配置文件，相当于配置文件中的信息并不是通过puppet服务端发送过来，而是通过本地的配置文件获取，也是可以的，我们暂且称这种不需要puppet服务端的工作模式为<strong>单机模式</strong>，我们在学习puppet时，可以使用单机的模式<strong>进行练习</strong>，但是在生产环境中，一般都使用master/agent的方式使用puppet。</p>
<p>　　实现定义多个manifests –&gt; complier –&gt; catalog –&gt; apply</p>
<p><img src="https://img2018.cnblogs.com/blog/1216496/201902/1216496-20190214111949801-849322413.png" alt="img"></p>
<h2 id="3、puppet资源详解"><a href="#3、puppet资源详解" class="headerlink" title="3、puppet资源详解"></a>3、puppet资源详解</h2><h3 id="3-1-puppet资源介绍"><a href="#3-1-puppet资源介绍" class="headerlink" title="3.1 puppet资源介绍"></a>3.1 puppet资源介绍</h3><h4 id="3-1-1-程序安装及环境"><a href="#3-1-1-程序安装及环境" class="headerlink" title="3.1.1 程序安装及环境"></a><strong>3.1.1 程序安装及环境</strong></h4><p>　　首先，我们还是来安装一下puppet，puppet的安装可以使用源码安装，也可以使用rpm（官方提供）、epel源、官方提供的yum仓库来安装（通过下载官方提供的rpm包可以指定官方的yum仓库）。</p>
<p>　　在这里，我们就是用 yum 安装的方式。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@along ~]<span class="comment"># yum -y install puppet</span></span><br></pre></td></tr></table></figure>

<p>　　</p>
<h4 id="3-1-2-puppet资源简介"><a href="#3-1-2-puppet资源简介" class="headerlink" title="3.1.2 puppet资源简介"></a><strong>3.1.2 puppet资源简介</strong></h4><p>（1）资源抽象</p>
<p>puppet 从以下三个维度来对资源完成抽象：</p>
<ul>
<li>相似的资源被抽象成同一种资源“类型”，如程序包资源、用户资源及服务资源等；</li>
<li><strong>将资源属性或状态的描述与其实现方式剥离开来</strong>，如仅说明安装一个程序包而不用关心其具体是通过yum、pkgadd、ports或是其它方式实现；</li>
<li><strong>仅描述资源的目标状态</strong>，也即期望其实现的结果，而不是其具体过程，如“确定nginx 运行起来” 而不是具体描述为“运行nginx命令将其启动起来”；</li>
</ul>
<p>这三个也被称作puppet 的资源抽象层(RAL)</p>
<p>RAL 由type( 类型) 和provider( 提供者，即不同OS 上的特定实现)组成。</p>
<p>　　</p>
<p>（2）资源定义</p>
<p>① 资源定义通过向资源类型的属性赋值来实现，可称为资源类型实例化；</p>
<p>② 定义了资源实例的文件即清单，manifest；</p>
<p>③ 定义资源的语法如下：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">type &#123;<span class="string">&#x27;title&#x27;</span><span class="symbol">:</span></span><br><span class="line">    attribute1 =&gt; value1,</span><br><span class="line">    atrribute2 =&gt; value2,</span><br><span class="line">    ...</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>　　注意：type必须使用小写字符；title是一个字符串，在同一类型中必须惟一；每一个属性之间需要用“,”隔开，最后一个“,”可省略。</p>
<p>　　例如，可以同时有名为nginx 的“service”资源和“package”资源，但在“package” 类型的资源中只能有一个名为“nginx”的资源。</p>
<p>（3）资源属性中的三个特殊属性：</p>
<ul>
<li>Namevar：可简称为name；</li>
<li>ensure：资源的目标状态；</li>
<li>Provider：指明资源的管理接口；</li>
</ul>
<h3 id="3-2-group：Manage-groups"><a href="#3-2-group：Manage-groups" class="headerlink" title="3.2 group：Manage groups"></a><strong>3.2 group：Manage groups</strong></h3><h4 id="3-2-1-类型属性选项"><a href="#3-2-1-类型属性选项" class="headerlink" title="3.2.1 类型属性选项"></a><strong>3.2.1 类型属性选项</strong></h4><p>（1）属性 Parameters：</p>
<ul>
<li><strong>name</strong>：组名；</li>
<li><strong>gid</strong>：GID；</li>
<li><strong>system</strong>：是否为系统组，true OR false；</li>
<li><strong>ensure</strong>：目标状态，present（创建）/absent（删除）；</li>
<li><strong>members</strong>：成员用户;</li>
</ul>
<p>（2）puppet describe group -s -m  使用之前，可以查询这个类型的选项</p>
<p><img src="https://cdn.jsdelivr.net/gh/Waylonwhynot/whatyouneed_blog_pic@main/pic/1216496-20190214112204450-1608742959.png" alt="img"></p>
<h4 id="3-2-2-演示"><a href="#3-2-2-演示" class="headerlink" title="3.2.2 演示"></a><strong>3.2.2 演示</strong></h4><p>① 编辑manifest( 清单)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]# vim group.pp</span><br><span class="line">group&#123;&#39;mygrp&#39;:</span><br><span class="line">        name &#x3D;&gt; &#39;mygrp&#39;,</span><br><span class="line">        ensure &#x3D;&gt; present,</span><br><span class="line">        gid &#x3D;&gt; 2000,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>② 执行并验证 manifest</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">---先预执行一次，检查是否有语法错误</span><br><span class="line">[root@along manifest]# puppet apply -v --noop group.pp</span><br><span class="line">Notice: Compiled catalog for along in environment production in 0.18 seconds</span><br><span class="line">Info: Applying configuration version &#39;1550042227&#39;</span><br><span class="line">Notice: &#x2F;Stage[main]&#x2F;Main&#x2F;Group[mygrp]&#x2F;ensure: current_value absent, should be present (noop)</span><br><span class="line">Notice: Class[Main]: Would have triggered &#39;refresh&#39; from 1 events</span><br><span class="line">Notice: Stage[main]: Would have triggered &#39;refresh&#39; from 1 events</span><br><span class="line">Info: Creating state file &#x2F;var&#x2F;lib&#x2F;puppet&#x2F;state&#x2F;state.yaml</span><br><span class="line">Notice: Finished catalog run in 0.03 seconds</span><br><span class="line">---真正执行，执行成功</span><br><span class="line">[root@along manifest]# puppet apply -v group.pp</span><br><span class="line">Notice: Compiled catalog for along in environment production in 0.06 seconds</span><br><span class="line">Info: Applying configuration version &#39;1550042298&#39;</span><br><span class="line">Notice: &#x2F;Stage[main]&#x2F;Main&#x2F;Group[mygrp]&#x2F;ensure: created</span><br><span class="line">Notice: Finished catalog run in 0.09 seconds</span><br><span class="line">---查询验证</span><br><span class="line">[root@along manifest]# cat &#x2F;etc&#x2F;group |grep mygrp</span><br><span class="line">mygrp:x:2000:</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h3 id="3-3-user：Manage-users"><a href="#3-3-user：Manage-users" class="headerlink" title="3.3 user：Manage users"></a><strong>3.3 user：Manage users</strong></h3><h4 id="3-3-1-类型属性选项"><a href="#3-3-1-类型属性选项" class="headerlink" title="3.3.1 类型属性选项"></a><strong>3.3.1 类型属性选项</strong></h4><p>（1）属性 Parameters：</p>
<ul>
<li><strong>name：用户名；</strong></li>
<li>uid: UID;</li>
<li>gid：基本组ID；</li>
<li>groups：附加组，不能包含基本组；</li>
<li>comment：注释；</li>
<li>expiry：过期时间 ；</li>
<li>home：家目录；</li>
<li>shell：默认shell类型；</li>
<li>system：是否为系统用户 ；</li>
<li><strong>ensure：present/absent</strong> 存在/不存在；</li>
<li>password：加密后的密码串；</li>
</ul>
<p>（2）puppet describe user -s -m  使用之前，可以查询这个类型的选项</p>
<p><img src="https://cdn.jsdelivr.net/gh/Waylonwhynot/whatyouneed_blog_pic@main/pic/1216496-20190214112325716-993216185.png" alt="img"></p>
<h4 id="3-3-2-演示"><a href="#3-3-2-演示" class="headerlink" title="3.3.2 演示"></a><strong>3.3.2 演示</strong></h4><p>① 编辑manifest( 清单)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]# vim pkg.pp</span><br><span class="line">package&#123;&#39;redis&#39;:</span><br><span class="line">        ensure &#x3D;&gt; installed,</span><br><span class="line">        provider &#x3D;&gt; yum</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>　　</p>
<p>② 执行manifest</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]# puppet apply --noop -v pkg.pp</span><br><span class="line">[root@along manifest]# puppet apply -v pkg.pp</span><br><span class="line">Notice: Compiled catalog for along in environment production in 0.26 seconds</span><br><span class="line">Warning: The package type&#39;s allow_virtual parameter will be changing its default value from false to true in a future release. If you do not want to allow virtual packages, please explicitly set allow_virtual to false.</span><br><span class="line">   (at &#x2F;usr&#x2F;share&#x2F;ruby&#x2F;vendor_ruby&#x2F;puppet&#x2F;type.rb:816:in &#96;set_default&#39;)</span><br><span class="line">Info: Applying configuration version &#39;1550044027&#39;</span><br><span class="line">Notice: &#x2F;Stage[main]&#x2F;Main&#x2F;Package[redis]&#x2F;ensure: created</span><br><span class="line">Notice: Finished catalog run in 6.09 seconds</span><br><span class="line">[root@along manifest]# rpm -ql redis</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h3 id="3-4-package：Manage-packages"><a href="#3-4-package：Manage-packages" class="headerlink" title="3.4 package：Manage packages"></a><strong>3.4 package：Manage packages</strong></h3><h4 id="3-4-1-类型属性选项"><a href="#3-4-1-类型属性选项" class="headerlink" title="3.4.1 类型属性选项"></a><strong>3.4.1 类型属性选项</strong></h4><p>① 属性：</p>
<ul>
<li><strong>ensure：installed</strong>, present, <strong>latest, absent,</strong> any version string (implies present)</li>
<li><strong>name：包名；</strong></li>
<li>ource：程序包来源，仅对不会自动下载相关程序包的provider有用，例如rpm或dpkg；</li>
<li>provider：指明安装方式；rpm/yum/…</li>
</ul>
<p>② puppet describe package -s -m  可以查询这个类型的选项</p>
<p><img src="https://cdn.jsdelivr.net/gh/Waylonwhynot/whatyouneed_blog_pic@main/pic/1216496-20190214112420107-952508454.png" alt="img"></p>
<h4 id="3-4-2-演示"><a href="#3-4-2-演示" class="headerlink" title="3.4.2 演示"></a><strong>3.4.2 演示</strong></h4><p>① 创建manifest</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]# vim pkg.pp</span><br><span class="line">package&#123;&#39;redis&#39;:</span><br><span class="line">        ensure &#x3D;&gt; installed,</span><br><span class="line">        provider &#x3D;&gt; yum</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>　　</p>
<p>② 执行manifest</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]# puppet apply --noop -v pkg.pp</span><br><span class="line">[root@along manifest]# puppet apply -v pkg.pp</span><br><span class="line">Notice: Compiled catalog for along in environment production in 0.26 seconds</span><br><span class="line">Warning: The package type&#39;s allow_virtual parameter will be changing its default value from false to true in a future release. If you do not want to allow virtual packages, please explicitly set allow_virtual to false.</span><br><span class="line">   (at &#x2F;usr&#x2F;share&#x2F;ruby&#x2F;vendor_ruby&#x2F;puppet&#x2F;type.rb:816:in &#96;set_default&#39;)</span><br><span class="line">Info: Applying configuration version &#39;1550044027&#39;</span><br><span class="line">Notice: &#x2F;Stage[main]&#x2F;Main&#x2F;Package[redis]&#x2F;ensure: created</span><br><span class="line">Notice: Finished catalog run in 6.09 seconds</span><br><span class="line">[root@along manifest]# rpm -ql redis</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h3 id="3-5-service：Manage-running-services"><a href="#3-5-service：Manage-running-services" class="headerlink" title="3.5 service：Manage running services"></a><strong>3.5 service：Manage running services</strong></h3><h4 id="3-5-1-类型属性选项"><a href="#3-5-1-类型属性选项" class="headerlink" title="3.5.1 类型属性选项"></a><strong>3.5.1 类型属性选项</strong></h4><p>① 属性：</p>
<ul>
<li><strong>ensure：running\true（开启）</strong> 或 <strong>stopped</strong>/<strong>false（停止）</strong></li>
<li>enable：是否开机自启：true（开机自启）、false（不自启）、manual（手动）</li>
<li><strong>name：服务名</strong></li>
<li>binary：若服务不是systemctl/service 启动，则需规定启动命令；如nginx -s start</li>
<li>path：如果不是systemctl/service 这样启动服务，而是通过脚本启动，指明path路径。多个值应该由冒号分隔，或者作为数组提供。脚本的搜索路径，默认为/etc/init.d/；</li>
<li>hasrestart：是否支持restart 这个参数重启；true/fault ；true 表示支持</li>
<li>hasstatus：是否支持status 这个参数查看状态；true/false</li>
<li>start：手动定义启动命令；</li>
<li>stop：手动定义关闭命令；</li>
<li>status：若hasstatus 为fals 手动定义查看信息命令；</li>
<li>restart：若hasrestart 为false 手动定义reload操作</li>
</ul>
<p>② puppet describe service -s -m  可以查询这个类型的选项</p>
<p><img src="https://cdn.jsdelivr.net/gh/Waylonwhynot/whatyouneed_blog_pic@main/pic/1216496-20190214112503756-879372839.png" alt="img"></p>
<h4 id="3-5-2-演示1：开启redis-服务"><a href="#3-5-2-演示1：开启redis-服务" class="headerlink" title="3.5.2 演示1：开启redis 服务"></a><strong>3.5.2 演示1：开启redis 服务</strong></h4><p>① 编写manifest 资源清单</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]# vim srv1.pp</span><br><span class="line">service&#123;&#39;redis&#39;:</span><br><span class="line">        ensure &#x3D;&gt; running,</span><br><span class="line">        enable &#x3D;&gt; true,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>② 执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]# puppet apply -v --noop srv1.pp</span><br><span class="line">[root@along manifest]# puppet apply -v srv1.pp</span><br><span class="line">Notice: Compiled catalog for along in environment production in 0.08 seconds</span><br><span class="line">Info: Applying configuration version &#39;1550044320&#39;</span><br><span class="line">Notice: &#x2F;Stage[main]&#x2F;Main&#x2F;Service[redis]&#x2F;ensure: ensure changed &#39;stopped&#39; to &#39;running&#39;</span><br><span class="line">Info: &#x2F;Stage[main]&#x2F;Main&#x2F;Service[redis]: Unscheduling refresh on Service[redis]</span><br><span class="line">Notice: Finished catalog run in 0.11 seconds</span><br><span class="line">[root@along manifest]# ss -nutl |grep 6379</span><br><span class="line">tcp    LISTEN     0      128    127.0.0.1:6379                  *:*</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h4 id="3-5-2-演示1：下载memcached-包，且开启服务"><a href="#3-5-2-演示1：下载memcached-包，且开启服务" class="headerlink" title="3.5.2 演示1：下载memcached 包，且开启服务"></a><strong>3.5.2 演示1：下载memcached 包，且开启服务</strong></h4><p>① 编写manifest 资源清单</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]# vim srv2.pp</span><br><span class="line">package &#123;&#39;memcached&#39;:</span><br><span class="line">        ensure &#x3D;&gt; installed,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">service&#123;&#39;memcached&#39;:</span><br><span class="line">        ensure &#x3D;&gt; running,</span><br><span class="line">        enable &#x3D;&gt; false,</span><br><span class="line">        require &#x3D;&gt; Package[&#39;memcached&#39;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> ② 执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]# puppet apply -v --noop srv2.pp</span><br><span class="line">[root@along manifest]# puppet apply -v srv2.pp</span><br><span class="line">Notice: Compiled catalog for along in environment production in 0.35 seconds</span><br><span class="line">Warning: The package type&#39;s allow_virtual parameter will be changing its default value from false to true in a future release. If you do not want to allow virtual packages, please explicitly set allow_virtual to false.</span><br><span class="line">   (at &#x2F;usr&#x2F;share&#x2F;ruby&#x2F;vendor_ruby&#x2F;puppet&#x2F;type.rb:816:in &#96;set_default&#39;)</span><br><span class="line">Info: Applying configuration version &#39;1550044434&#39;</span><br><span class="line">Notice: &#x2F;Stage[main]&#x2F;Main&#x2F;Package[memcached]&#x2F;ensure: created</span><br><span class="line">Notice: &#x2F;Stage[main]&#x2F;Main&#x2F;Service[memcached]&#x2F;ensure: ensure changed &#39;stopped&#39; to &#39;running&#39;</span><br><span class="line">Info: &#x2F;Stage[main]&#x2F;Main&#x2F;Service[memcached]: Unscheduling refresh on Service[memcached]</span><br><span class="line">Notice: Finished catalog run in 3.28 seconds</span><br><span class="line">[root@along manifest]# ss -nutlp |grep memcached</span><br><span class="line">udp    UNCONN     0      0         *:11211                 *:*                   users:((&quot;memcached&quot;,pid&#x3D;8573,fd&#x3D;28))</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h3 id="3-6-file：管理文件，包括它们的内容、所有权和权限"><a href="#3-6-file：管理文件，包括它们的内容、所有权和权限" class="headerlink" title="3.6 file：管理文件，包括它们的内容、所有权和权限"></a><strong>3.6 file：管理文件，包括它们的内容、所有权和权限</strong></h3><h4 id="3-6-1-类型属性选项"><a href="#3-6-1-类型属性选项" class="headerlink" title="3.6.1 类型属性选项"></a><strong>3.6.1 类型属性选项</strong></h4><p>（1）类型的属性、选项</p>
<p>① 属性</p>
<ul>
<li>**ensure：<code>**present</code>创建, <code>absent</code>删除, <code>file</code>创建普通文件, <code>directory</code>创建目录, link`创建软链接.</li>
<li>file：类型为普通文件，其内容由content属性生成或复制由source属性指向的文件路径来创建；</li>
<li>link：类型为符号链接文件，必须由target属性指明其链接的目标文件；</li>
<li>directory：类型为目录，可通过source指向的路径复制生成，recurse属性指明是否递归复制；</li>
<li><strong>path：文件路径；</strong></li>
<li>source：源文件；当复制文件内容时需要指定</li>
<li>content：文件内容；直接编写文件内容</li>
<li>target：符号链接的目标文件；</li>
<li>owner：属主</li>
<li>group：属组</li>
<li>mode：权限；</li>
<li>atime/ctime/mtime：时间戳；</li>
<li>access time：访问时间，atime，读取文件内容</li>
<li>modify time: 修改时间, mtime，改变文件内容（数据）</li>
<li>change time: 改变时间, ctime，元数据发生改变</li>
</ul>
<p>② puppet describe <strong>file</strong> -s -m |tail -20</p>
<p><img src="https://img2018.cnblogs.com/blog/1216496/201902/1216496-20190214112619728-1999514285.png" alt="img"></p>
<h4 id="3-6-2-演示1：创建test-txt，且直接写内容"><a href="#3-6-2-演示1：创建test-txt，且直接写内容" class="headerlink" title="3.6.2 演示1：创建test.txt，且直接写内容"></a><strong>3.6.2 演示1：创建test.txt，且直接写内容</strong></h4><p>创建test.txt，且直接写内容</p>
<p>① 编写manifest 清单</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]# vim file1.pp</span><br><span class="line">file&#123;&#39;&#x2F;mnt&#x2F;test.txt&#39;:</span><br><span class="line">        ensure &#x3D;&gt; file,</span><br><span class="line">        content &#x3D;&gt; &quot;How are you?\nHow old are you?\n&quot;,</span><br><span class="line">        owner &#x3D;&gt; &#39;along1&#39;,</span><br><span class="line">        group &#x3D;&gt; &#39;mygrp&#39;,</span><br><span class="line">        mode &#x3D;&gt; &#39;0400&#39;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> ② 执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]# puppet apply -v --noop file1.pp</span><br><span class="line">[root@along manifest]# puppet apply -v file1.pp</span><br><span class="line">Notice: Compiled catalog for along in environment production in 0.07 seconds</span><br><span class="line">Info: Applying configuration version &#39;1550044597&#39;</span><br><span class="line">Notice: &#x2F;Stage[main]&#x2F;Main&#x2F;File[&#x2F;mnt&#x2F;test.txt]&#x2F;ensure: defined content as &#39;&#123;md5&#125;93c1208b855bf27a44bb2eb1b022b8cd&#39;</span><br><span class="line">Notice: Finished catalog run in 0.04 seconds</span><br><span class="line">[root@along manifest]# ll &#x2F;mnt&#x2F;test.txt</span><br><span class="line">-r-------- 1 along1 mygrp 30 Feb 13 15:56 &#x2F;mnt&#x2F;test.txt</span><br><span class="line">[root@along manifest]# cat &#x2F;mnt&#x2F;test.txt</span><br><span class="line">How are you?</span><br><span class="line">How old are you?</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h4 id="3-6-3-演示2：创建一个文件，且复制另一个文件的内容；再对这个文件创建一个软链接文件"><a href="#3-6-3-演示2：创建一个文件，且复制另一个文件的内容；再对这个文件创建一个软链接文件" class="headerlink" title="3.6.3 演示2：创建一个文件，且复制另一个文件的内容；再对这个文件创建一个软链接文件"></a><strong>3.6.3 演示2：创建一个文件，且复制另一个文件的内容；再对这个文件创建一个软链接文件</strong></h4><p>① 编写manifest 清单</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]# vim file2.pp </span><br><span class="line">file&#123;&#39;redis.conf&#39;:</span><br><span class="line">        path &#x3D;&gt; &#39;&#x2F;mnt&#x2F;redis.conf&#39;,</span><br><span class="line">        ensure &#x3D;&gt; file,</span><br><span class="line">        source &#x3D;&gt; &#39;&#x2F;root&#x2F;manifest&#x2F;files&#x2F;redis.conf&#39;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">file&#123;&#39;symlink.conf&#39;:</span><br><span class="line">        ensure &#x3D;&gt; link,</span><br><span class="line">        path &#x3D;&gt; &#39;&#x2F;mnt&#x2F;symlink.conf&#39;,</span><br><span class="line">        target &#x3D;&gt; &#39;&#x2F;mnt&#x2F;redis.conf&#39;,</span><br><span class="line">        require &#x3D;&gt; File[&#39;redis.conf&#39;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>　　提示：若要指定source ，最好先把源文件复制到此目录中，因为在master-agent 模式中，不能确保agent 机器上的路径下，一定有要复制的文件；本次操作需要在/root/manifests/files/准备好redis.con文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]# mkdir files</span><br><span class="line">[root@along manifest]# cp &#x2F;etc&#x2F;redis.conf &#x2F;root&#x2F;manifest&#x2F;files&#x2F;</span><br></pre></td></tr></table></figure>

<p>　　</p>
<p>② 执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]# puppet apply -v --noop file2.pp</span><br><span class="line">[root@along manifest]# puppet apply -v file2.pp</span><br><span class="line">Notice: Compiled catalog for along in environment production in 0.07 seconds</span><br><span class="line">Info: Applying configuration version &#39;1550045858&#39;</span><br><span class="line">Notice: &#x2F;Stage[main]&#x2F;Main&#x2F;File[redis.conf]&#x2F;ensure: defined content as &#39;&#123;md5&#125;d98629fded012cd2a25b9db0599a9251&#39;</span><br><span class="line">Notice: &#x2F;Stage[main]&#x2F;Main&#x2F;File[symlink.conf]&#x2F;ensure: created</span><br><span class="line">Notice: Finished catalog run in 0.05 seconds</span><br><span class="line">[root@along manifest]# ll &#x2F;mnt&#x2F;redis.conf &#x2F;mnt&#x2F;symlink.conf</span><br><span class="line">-rw-r----- 1  777 root 46729 Feb 13 16:17 &#x2F;mnt&#x2F;redis.conf</span><br><span class="line">lrwxrwxrwx 1 root root    15 Feb 13 16:17 &#x2F;mnt&#x2F;symlink.conf -&gt; &#x2F;mnt&#x2F;redis.conf</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h4 id="3-6-4-演示3：创建目录，且递归复制另一个目录"><a href="#3-6-4-演示3：创建目录，且递归复制另一个目录" class="headerlink" title="3.6.4 演示3：创建目录，且递归复制另一个目录"></a><strong>3.6.4 演示3：创建目录，且递归复制另一个目录</strong></h4><p>创建目录，且递归复制另一个目录</p>
<p>① 编写manifest 清单</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]# vim file3.pp</span><br><span class="line">file&#123;&#39;test.dir&#39;:</span><br><span class="line">        ensure &#x3D;&gt; directory,</span><br><span class="line">        path &#x3D;&gt; &#39;&#x2F;app&#x2F;test.dir&#39;, </span><br><span class="line">    source &#x3D;&gt; &#39;&#x2F;etc&#x2F;httpd&#39;,</span><br><span class="line">        recurse &#x3D;&gt; true   #递归复制</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 注意：</p>
<p>　　目录复制目录，是将目录下的所有文件递归复制；</p>
<p>　　不要用path 为目录，source为文件，不会将此文件复制到目录中；只能是目录复制目录</p>
<p>② 执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]# puppet apply -v file3.pp</span><br><span class="line">Notice: Compiled catalog for along in environment production in 0.07 seconds</span><br><span class="line">Info: Applying configuration version &#39;1550046089&#39;</span><br><span class="line">Notice: &#x2F;Stage[main]&#x2F;Main&#x2F;File[test.dir]&#x2F;ensure: created</span><br><span class="line">Notice: &#x2F;Stage[main]&#x2F;Main&#x2F;File[&#x2F;mnt&#x2F;test.dir&#x2F;along]&#x2F;ensure: created</span><br><span class="line">Notice: &#x2F;Stage[main]&#x2F;Main&#x2F;File[&#x2F;mnt&#x2F;test.dir&#x2F;along&#x2F;.bash_logout]&#x2F;ensure: defined content as &#39;&#123;md5&#125;6a5bc1cc5f80a48b540bc09d082b5855&#39;</span><br><span class="line">Notice: &#x2F;Stage[main]&#x2F;Main&#x2F;File[&#x2F;mnt&#x2F;test.dir&#x2F;symlink.conf]&#x2F;ensure: created</span><br><span class="line">Notice: &#x2F;Stage[main]&#x2F;Main&#x2F;File[&#x2F;mnt&#x2F;test.dir&#x2F;along&#x2F;.bash_profile]&#x2F;ensure: defined content as &#39;&#123;md5&#125;f939eb71a81a9da364410b799e817202&#39;</span><br><span class="line">Notice: &#x2F;Stage[main]&#x2F;Main&#x2F;File[&#x2F;mnt&#x2F;test.dir&#x2F;redis.conf]&#x2F;ensure: defined content as &#39;&#123;md5&#125;d98629fded012cd2a25b9db0599a9251&#39;</span><br><span class="line">Notice: &#x2F;Stage[main]&#x2F;Main&#x2F;File[&#x2F;mnt&#x2F;test.dir&#x2F;along&#x2F;.bashrc]&#x2F;ensure: defined content as &#39;&#123;md5&#125;2f8222b4f275c4f18e69c34f66d2631b&#39;</span><br><span class="line">Notice: &#x2F;Stage[main]&#x2F;Main&#x2F;File[&#x2F;mnt&#x2F;test.dir&#x2F;test.txt]&#x2F;ensure: defined content as &#39;&#123;md5&#125;93c1208b855bf27a44bb2eb1b022b8cd&#39;</span><br><span class="line">Notice: Finished catalog run in 0.08 seconds</span><br><span class="line">[root@along manifest]# ll &#x2F;mnt&#x2F;test.dir&#x2F;</span><br><span class="line">total 52</span><br><span class="line">drwx------ 2 along1 along1    62 Feb 13 16:21 along</span><br><span class="line">-rw-r----- 1    777 root   46729 Feb 13 16:21 redis.conf</span><br><span class="line">lrwxrwxrwx 1 root   root      15 Feb 13 16:21 symlink.conf -&gt; &#x2F;mnt&#x2F;redis.conf</span><br><span class="line">-r-------- 1 along1 mygrp     30 Feb 13 16:21 test.txt</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h4 id="3-6-5-演示4：下载redis-包，复制配置文件，启动redis-服务"><a href="#3-6-5-演示4：下载redis-包，复制配置文件，启动redis-服务" class="headerlink" title="3.6.5 演示4：下载redis 包，复制配置文件，启动redis 服务"></a><strong>3.6.5 演示4：下载redis 包，复制配置文件，启动redis 服务</strong></h4><p>下载redis 包，复制配置文件，启动redis 服务</p>
<p>① 编写manifest 清单</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]# vim srv3.pp</span><br><span class="line">package&#123;&#39;redis&#39;:</span><br><span class="line">        ensure &#x3D;&gt; installed,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">file&#123;&#39;&#x2F;etc&#x2F;redis.conf&#39;:</span><br><span class="line">        ensure  &#x3D;&gt; file,</span><br><span class="line">        source  &#x3D;&gt; &#39;&#x2F;root&#x2F;manifest&#x2F;files&#x2F;redis.conf&#39;,</span><br><span class="line">        owner   &#x3D;&gt; &#39;redis&#39;,</span><br><span class="line">        group   &#x3D;&gt; &#39;root&#39;,</span><br><span class="line">        mode    &#x3D;&gt; &#39;0640&#39;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">service&#123;&#39;redis&#39;:</span><br><span class="line">        ensure  &#x3D;&gt; running,</span><br><span class="line">        enable  &#x3D;&gt; false</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Package[&#39;redis&#39;] -&gt; File[&#39;&#x2F;etc&#x2F;redis.conf&#39;] -&gt; Service[&#39;redis&#39;]</span><br></pre></td></tr></table></figure>

<p>注意：我事先将/root/manifest/files/redis.conf配置文件的端口修改为了6300</p>
<p>② 执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]# puppet apply -v --noop srv3.pp</span><br><span class="line">[root@along manifest]# puppet apply -v srv3.pp</span><br><span class="line">Notice: Compiled catalog for along in environment production in 0.46 seconds</span><br><span class="line">Warning: The package type&#39;s allow_virtual parameter will be changing its default value from false to true in a future release. If you do not want to allow virtual packages, please explicitly set allow_virtual to false.</span><br><span class="line">   (at &#x2F;usr&#x2F;share&#x2F;ruby&#x2F;vendor_ruby&#x2F;puppet&#x2F;type.rb:816:in &#96;set_default&#39;)</span><br><span class="line">Info: Applying configuration version &#39;1550046351&#39;</span><br><span class="line">Notice: &#x2F;Stage[main]&#x2F;Main&#x2F;Package[redis]&#x2F;ensure: created</span><br><span class="line">Info: &#x2F;Stage[main]&#x2F;Main&#x2F;File[&#x2F;etc&#x2F;redis.conf]: Filebucketed &#x2F;etc&#x2F;redis.conf to puppet with sum d98629fded012cd2a25b9db0599a9251</span><br><span class="line">Notice: &#x2F;Stage[main]&#x2F;Main&#x2F;File[&#x2F;etc&#x2F;redis.conf]&#x2F;content: content changed &#39;&#123;md5&#125;d98629fded012cd2a25b9db0599a9251&#39; to &#39;&#123;md5&#125;d3fc0c22e1a90f88a895242b2a251dad&#39;</span><br><span class="line">Notice: &#x2F;Stage[main]&#x2F;Main&#x2F;Service[redis]&#x2F;ensure: ensure changed &#39;stopped&#39; to &#39;running&#39;</span><br><span class="line">Info: &#x2F;Stage[main]&#x2F;Main&#x2F;Service[redis]: Unscheduling refresh on Service[redis]</span><br><span class="line">Notice: Finished catalog run in 3.65 seconds</span><br><span class="line">[root@along manifest]# ss -nutlp |grep 6300</span><br><span class="line">tcp    LISTEN     0      128    127.0.0.1:6300                  *:*                   users:((&quot;redis-server&quot;,pid&#x3D;11628,fd&#x3D;4))</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h3 id="3-7-exec：执行外部命令"><a href="#3-7-exec：执行外部命令" class="headerlink" title="3.7 exec：执行外部命令"></a><strong>3.7 exec：执行外部命令</strong></h3><p>　　注意：exec资源中的任何命令都必须能够多次运行而不会造成损害——也就是说，它必须具有<strong>幂等性</strong>。</p>
<h4 id="3-7-1-类型属性选项"><a href="#3-7-1-类型属性选项" class="headerlink" title="3.7.1 类型属性选项"></a><strong>3.7.1 类型属性选项</strong></h4><ul>
<li>command：要运行的命令；</li>
<li>cwd：用于运行该命令的目录</li>
<li><strong>creates：文件路径，仅此路径表示的文件不存在时，command方才执行；</strong></li>
<li>user/group：运行命令的用户身份；</li>
<li><strong>path：用于执行命令的搜索路径。</strong>如果没有指定路径，则命令必须完全限定。</li>
<li>onlyif：此属性指定一个命令，此命令正常（退出码为0）运行时，当前command才会运行；</li>
<li>unless：此属性指定一个命令，此命令非正常（退出码为非0）运行时，当前command才会运行；</li>
<li><strong>refresh：重新执行当前command的替代命令</strong>；</li>
<li>refreshonly：仅接收到订阅的资源的通知时方才运行；</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/Waylonwhynot/whatyouneed_blog_pic@main/pic/1216496-20190214112835402-2124993879.png" alt="img"></p>
<h4 id="3-7-2-演示1：创建一个目录"><a href="#3-7-2-演示1：创建一个目录" class="headerlink" title="3.7.2 演示1：创建一个目录"></a><strong>3.7.2 演示1：创建一个目录</strong></h4><p>创建一个目录</p>
<p>① 编写manifest 清单</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]# vim cmd1.pp</span><br><span class="line">exec&#123;&#39;cmd&#39;:</span><br><span class="line">        command &#x3D;&gt; &#39;[ -e &#x2F;mnt&#x2F;testdir ] || mkdir &#x2F;mnt&#x2F;testdir&#39;,</span><br><span class="line">        path &#x3D;&gt; [&#39;&#x2F;bin&#39;,&#39;sbin&#39;,&#39;&#x2F;usr&#x2F;bin&#39;,&#39;&#x2F;usr&#x2F;sbin&#39;],</span><br><span class="line">#        creates &#x3D;&gt; &#39;&#x2F;mnt&#x2F;testdir&#39;    判断目录是否存在</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>　　分析：先判断目录是否存在，不存在再创建目录，使命令具有幂等性；就算是目录已存在，也不会有报错</p>
<p>② 执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]# puppet apply -v cmd1.pp</span><br><span class="line">Notice: Compiled catalog for along in environment production in 0.02 seconds</span><br><span class="line">Info: Applying configuration version &#39;1550047003&#39;</span><br><span class="line">Notice: &#x2F;Stage[main]&#x2F;Main&#x2F;Exec[cmd]&#x2F;returns: executed successfully</span><br><span class="line">Notice: Finished catalog run in 0.03 seconds</span><br><span class="line">[root@along manifest]# ll -d &#x2F;mnt&#x2F;testdir&#x2F;</span><br><span class="line">drwxr-xr-x 2 root root 6 Feb 13 16:36 &#x2F;mnt&#x2F;testdir&#x2F;</span><br><span class="line">[root@along manifest]# puppet apply -v cmd1.pp</span><br><span class="line">Notice: Compiled catalog for along in environment production in 0.02 seconds</span><br><span class="line">Info: Applying configuration version &#39;1550047046&#39;</span><br><span class="line">Notice: &#x2F;Stage[main]&#x2F;Main&#x2F;Exec[cmd]&#x2F;returns: executed successfully</span><br><span class="line">Notice: Finished catalog run in 0.03 seconds</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h4 id="3-7-3-演示2：创建一个用户"><a href="#3-7-3-演示2：创建一个用户" class="headerlink" title="3.7.3 演示2：创建一个用户"></a><strong>3.7.3 演示2：创建一个用户</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">---编写manifest 清单</span><br><span class="line">[root@along manifest]# vim cmd2.pp</span><br><span class="line">exec&#123;&#39;user&#39;:</span><br><span class="line">        command &#x3D;&gt; &#39;useradd along&#39;,</span><br><span class="line">        path &#x3D;&gt; &#39;&#x2F;bin:sbin:&#x2F;usr&#x2F;bin:&#x2F;usr&#x2F;sbin&#39;,</span><br><span class="line">        unless &#x3D;&gt; &#39;id along&#39;</span><br><span class="line">&#125;</span><br><span class="line">---执行</span><br><span class="line">[root@along manifest]# puppet apply -v cmd2.pp</span><br><span class="line">Notice: Compiled catalog for along in environment production in 0.02 seconds</span><br><span class="line">Info: Applying configuration version &#39;1550047187&#39;</span><br><span class="line">Notice: Finished catalog run in 0.03 seconds</span><br><span class="line">[root@along manifest]# id along</span><br><span class="line">uid&#x3D;1000(along) gid&#x3D;1000(along) groups&#x3D;1000(along)</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h4 id="3-7-4-演示3：下载，开启redis"><a href="#3-7-4-演示3：下载，开启redis" class="headerlink" title="3.7.4 演示3：下载，开启redis"></a><strong>3.7.4 演示3：下载，开启redis</strong></h4><p>① 编写manifest 清单</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]# vim cmd3.pp</span><br><span class="line">package&#123;&#39;redis&#39;:</span><br><span class="line">        ensure &#x3D;&gt; installed,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">file&#123;&#39;&#x2F;etc&#x2F;redis.conf&#39;:</span><br><span class="line">        ensure  &#x3D;&gt; file,</span><br><span class="line">        source  &#x3D;&gt; &#39;&#x2F;root&#x2F;manifest&#x2F;files&#x2F;redis.conf&#39;,</span><br><span class="line">        owner   &#x3D;&gt; &#39;redis&#39;,</span><br><span class="line">        group   &#x3D;&gt; &#39;root&#39;,</span><br><span class="line">        mode    &#x3D;&gt; &#39;0640&#39;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">exec&#123;&#39;redis&#39;:</span><br><span class="line">        command &#x3D;&gt; &#39;&#x2F;usr&#x2F;bin&#x2F;systemctl start redis&#39;,</span><br><span class="line">        refresh &#x3D;&gt; &quot;&#x2F;usr&#x2F;bin&#x2F;systemctl restart redis&quot;,</span><br><span class="line">        user    &#x3D;&gt; &#39;redis&#39;,</span><br><span class="line">        group   &#x3D;&gt; &#39;redis&#39;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Package[&#39;redis&#39;] -&gt; File[&#39;&#x2F;etc&#x2F;redis.conf&#39;] ~&gt; Exec[&#39;redis&#39;]</span><br></pre></td></tr></table></figure>

<p>注意：当配置文件修改，触发动作，会执行refresh 命令替代command</p>
<p>② 执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]# vim files&#x2F;redis.conf   把redis 端口修改为7777，再执行</span><br><span class="line">port 7777</span><br><span class="line">[root@along manifest]# puppet apply -v cmd3.pp</span><br><span class="line">Notice: Compiled catalog for along in environment production in 0.38 seconds</span><br><span class="line">Warning: The package type&#39;s allow_virtual parameter will be changing its default value from false to true in a future release. If you do not want to allow virtual packages, please explicitly set allow_virtual to false.</span><br><span class="line">   (at &#x2F;usr&#x2F;share&#x2F;ruby&#x2F;vendor_ruby&#x2F;puppet&#x2F;type.rb:816:in &#96;set_default&#39;)</span><br><span class="line">Info: Applying configuration version &#39;1550109397&#39;</span><br><span class="line">Notice: &#x2F;Stage[main]&#x2F;Main&#x2F;Exec[redis]&#x2F;returns: executed successfully</span><br><span class="line">Notice: Finished catalog run in 0.12 seconds</span><br><span class="line">[root@along manifest]# ss -nutlp |grep redis</span><br><span class="line">tcp    LISTEN     0      128    127.0.0.1:7777                  *:*                   users:((&quot;redis-server&quot;,pid&#x3D;4988,fd&#x3D;4))</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h3 id="3-8-cron：安装和管理cron作业"><a href="#3-8-cron：安装和管理cron作业" class="headerlink" title="3.8 cron：安装和管理cron作业"></a><strong>3.8 cron：安装和管理cron作业</strong></h3><p>　　由Puppet创建的每个cron资源都需要一个命令和至少一个周期属性(小时、分钟、月、月、工作日、或特殊)</p>
<h4 id="3-8-1-类型属性选项"><a href="#3-8-1-类型属性选项" class="headerlink" title="3.8.1 类型属性选项"></a><strong>3.8.1 类型属性选项</strong></h4><ul>
<li>command：要执行的任务；</li>
<li>ensure：present/absent；</li>
<li>hour：</li>
<li>minute:</li>
<li>monthday:</li>
<li>month:</li>
<li>weekday：</li>
<li>user：以哪个用户的身份运行命令</li>
<li>target：添加为哪个用户的任务</li>
<li>name：cron job的名称；</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/Waylonwhynot/whatyouneed_blog_pic@main/pic/1216496-20190214113005903-707292165.png" alt="img"></p>
<h4 id="3-8-2-演示"><a href="#3-8-2-演示" class="headerlink" title="3.8.2 演示"></a><strong>3.8.2 演示</strong></h4><p>① 编写manifest 清单</p>
<p>下载ntpdate包，并制定计划任务，每隔5分钟同步一次时间</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]# vim cron.pp </span><br><span class="line">package&#123;&#39;ntpdate&#39;:</span><br><span class="line">    ensure &#x3D;&gt; installed,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cron&#123;&#39;mysync&#39;:</span><br><span class="line">        command &#x3D;&gt; &#39;&#x2F;usr&#x2F;sbin&#x2F;ntpdate 192.168.10.1 &amp;&gt; &#x2F;dec&#x2F;null&#39;,</span><br><span class="line">        ensure &#x3D;&gt; present,</span><br><span class="line">        minute &#x3D;&gt; &quot;*&#x2F;5&quot;,</span><br><span class="line">        target &#x3D;&gt; &#39;root&#39;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>② 执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]# puppet apply -v cron.pp</span><br><span class="line">Notice: Compiled catalog for along in environment production in 0.29 seconds</span><br><span class="line">Warning: The package type&#39;s allow_virtual parameter will be changing its default value from false to true in a future release. If you do not want to allow virtual packages, please explicitly set allow_virtual to false.</span><br><span class="line">   (at &#x2F;usr&#x2F;share&#x2F;ruby&#x2F;vendor_ruby&#x2F;puppet&#x2F;type.rb:816:in &#96;set_default&#39;)</span><br><span class="line">Info: Applying configuration version &#39;1550109974&#39;</span><br><span class="line">Notice: &#x2F;Stage[main]&#x2F;Main&#x2F;Cron[mysync]&#x2F;ensure: created</span><br><span class="line">Notice: &#x2F;Stage[main]&#x2F;Main&#x2F;Package[ntpdate]&#x2F;ensure: created</span><br><span class="line">Notice: Finished catalog run in 3.20 seconds</span><br><span class="line">[root@along manifest]# crontab -l</span><br><span class="line"># HEADER: This file was autogenerated at 2019-02-14 10:06:14 +0800 by puppet.</span><br><span class="line"># HEADER: While it can still be managed manually, it is definitely not recommended.</span><br><span class="line"># HEADER: Note particularly that the comments starting with &#39;Puppet Name&#39; should</span><br><span class="line"># HEADER: not be deleted, as doing so could cause duplicate cron jobs.</span><br><span class="line"># Puppet Name: mysync</span><br><span class="line">*&#x2F;5 * * * * &#x2F;usr&#x2F;sbin&#x2F;ntpdate 192.168.10.1 &amp;&gt; &#x2F;dec&#x2F;null</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h3 id="3-9-notify：向代理运行时日志发送一个任意的消息"><a href="#3-9-notify：向代理运行时日志发送一个任意的消息" class="headerlink" title="3.9 notify：向代理运行时日志发送一个任意的消息"></a><strong>3.9 notify：向代理运行时日志发送一个任意的消息</strong></h3><h4 id="3-9-1-类型属性选项"><a href="#3-9-1-类型属性选项" class="headerlink" title="3.9.1 类型属性选项"></a><strong>3.9.1 类型属性选项</strong></h4><ul>
<li>message：信息内容</li>
<li>name：信息名称；</li>
</ul>
<h4 id="3-9-2-演示"><a href="#3-9-2-演示" class="headerlink" title="3.9.2 演示"></a><strong>3.9.2 演示</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">---编写manifest 清单</span><br><span class="line">[root@along manifest]# vim notify.pp</span><br><span class="line">notify&#123;&#39;syhi&#39;:</span><br><span class="line">        message &#x3D;&gt; &quot;hi there.&quot;</span><br><span class="line">&#125;</span><br><span class="line">---执行</span><br><span class="line">[root@along manifest]# puppet apply -v notify.pp</span><br><span class="line">Notice: Compiled catalog for along in environment production in 0.01 seconds</span><br><span class="line">Info: Applying configuration version &#39;1550110275&#39;</span><br><span class="line">Notice: hi there.</span><br><span class="line">Notice: &#x2F;Stage[main]&#x2F;Main&#x2F;Notify[syhi]&#x2F;message: defined &#39;message&#39; as &#39;hi there.&#39;</span><br><span class="line">Notice: Finished catalog run in 0.04 seconds</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h3 id="3-10-非核心类型的常用资源：yumrepo-host"><a href="#3-10-非核心类型的常用资源：yumrepo-host" class="headerlink" title="3.10 非核心类型的常用资源：yumrepo, host"></a><strong>3.10 非核心类型的常用资源：yumrepo, host</strong></h3><p>（1）yumrepo：yum源</p>
<p><img src="https://cdn.jsdelivr.net/gh/Waylonwhynot/whatyouneed_blog_pic@main/pic/1216496-20190214113105357-1444295829.png" alt="img"></p>
<p>（2）host：定义/etc/hosts 中名字解析</p>
<p><img src="https://cdn.jsdelivr.net/gh/Waylonwhynot/whatyouneed_blog_pic@main/pic/1216496-20190214113116447-1719448305.png" alt="img"></p>
<h2 id="4、资源的特殊属性"><a href="#4、资源的特殊属性" class="headerlink" title="4、资源的特殊属性"></a>4、资源的特殊属性</h2><h3 id="4-1-资源间依赖和通知关系"><a href="#4-1-资源间依赖和通知关系" class="headerlink" title="4.1 资源间依赖和通知关系"></a><strong>4.1 资源间依赖和通知关系</strong></h3><h4 id="4-1-1-依赖关系元参数：before-require"><a href="#4-1-1-依赖关系元参数：before-require" class="headerlink" title="4.1.1 依赖关系元参数：before/require"></a><strong>4.1.1 依赖关系元参数：before/require</strong></h4><p>（1）格式：3中实现方法</p>
<p>① A <strong>before</strong> B: B依赖于A，定义在A资源中；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    before    &#x3D;&gt; Type[&#39;B&#39;],</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> ② B <strong>require</strong> A： B依赖于A，定义在B资源中；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    require    &#x3D;&gt; Type[&#39;A&#39;],</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> ③ A -&gt; B，B依赖于A</p>
<p>（2）注意：</p>
<p>① before、 require 和 -&gt; 三者用其一即可</p>
<p>② 资源引用：Type[‘title’]</p>
<p>类型的<strong>首字母必须大写</strong></p>
<p>（3）演示：创建一个用户，需要依赖一个组</p>
<p>① 创建manifest</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]# vim user2.pp </span><br><span class="line">[root@along manifest]# cat user2.pp</span><br><span class="line">group&#123;&#39;redhat&#39;:</span><br><span class="line">        ensure &#x3D;&gt; present,</span><br><span class="line">#       before &#x3D;&gt; User[&#39;ilinux&#39;],  #方案1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">user&#123;&#39;ilinux&#39;:</span><br><span class="line">        ensure &#x3D;&gt; present,</span><br><span class="line">        comment &#x3D;&gt; &quot;ilinux.io&quot;,</span><br><span class="line">        groups &#x3D;&gt; &#39;redhat&#39;,</span><br><span class="line">        require &#x3D;&gt; Group[&#39;redhat&#39;],   #方案2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#Group[&#39;redhat&#39;] -&gt; User[&#39;ilinux&#39;]   #方案3</span><br></pre></td></tr></table></figure>



<p>② 执行，先创建了组redhat，再创建了用户ilinux</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]# puppet apply -v user2.pp</span><br><span class="line">Notice: Compiled catalog for along in environment production in 0.14 seconds</span><br><span class="line">Info: Applying configuration version &#39;1550043297&#39;</span><br><span class="line">Notice: &#x2F;Stage[main]&#x2F;Main&#x2F;Group[redhat]&#x2F;ensure: created</span><br><span class="line">Notice: &#x2F;Stage[main]&#x2F;Main&#x2F;User[ilinux]&#x2F;ensure: created</span><br><span class="line">Notice: Finished catalog run in 0.12 seconds</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h4 id="4-1-2-通知关系：通知相关的其它资源进行“刷新”操作"><a href="#4-1-2-通知关系：通知相关的其它资源进行“刷新”操作" class="headerlink" title="4.1.2 通知关系：通知相关的其它资源进行“刷新”操作"></a><strong>4.1.2 通知关系：通知相关的其它资源进行“刷新”操作</strong></h4><p>（1）格式：notify/subscribe</p>
<p>① notify：A notify B：B依赖于A，且A发生改变后会通知B；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    notify &#x3D;&gt; Type[&#39;B&#39;],</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> ② subscribe：B subscribe A：B依赖于A，且B监控A资源的变化产生的事件；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    ...</span><br><span class="line">    subscribe &#x3D;&gt; Type[&#39;A&#39;],</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> ③ A ~ B ，B依赖于A缩写版</p>
<p>（2）实例：下载redis 包，复制配置文件，启动redis 服务</p>
<p>① 修改srv3.pp manifest 清单</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]# vim srv3.pp</span><br><span class="line">package&#123;&#39;redis&#39;:</span><br><span class="line">        ensure &#x3D;&gt; installed,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">file&#123;&#39;&#x2F;etc&#x2F;redis.conf&#39;:</span><br><span class="line">        ensure  &#x3D;&gt; file,</span><br><span class="line">        source  &#x3D;&gt; &#39;&#x2F;root&#x2F;manifest&#x2F;files&#x2F;redis.conf&#39;,</span><br><span class="line">        owner   &#x3D;&gt; &#39;redis&#39;,</span><br><span class="line">        group   &#x3D;&gt; &#39;root&#39;,</span><br><span class="line">        mode    &#x3D;&gt; &#39;0640&#39;,</span><br><span class="line">#     notify    &#x3D;&gt; Service[&#39;redis&#39;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">service&#123;&#39;redis&#39;:</span><br><span class="line">        ensure  &#x3D;&gt; running,</span><br><span class="line">        enable  &#x3D;&gt; false,</span><br><span class="line">    hasrestart &#x3D;&gt; true,</span><br><span class="line">#     subscribe &#x3D;&gt; File[&#39;&#x2F;etc&#x2F;redis.conf&#39;]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Package[&#39;redis&#39;] -&gt; File[&#39;&#x2F;etc&#x2F;redis.conf&#39;] ~&gt; Service[&#39;redis&#39;]</span><br></pre></td></tr></table></figure>



<p>② 执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]<span class="comment"># puppet apply -v --noop srv3.pp</span></span><br><span class="line">[root@along manifest]<span class="comment"># puppet apply -v srv3.pp</span></span><br><span class="line">Notice: Compiled catalog <span class="keyword">for</span> along <span class="keyword">in</span> environment production <span class="keyword">in</span> 0.42 seconds</span><br><span class="line">Warning: The package <span class="built_in">type</span><span class="string">&#x27;s allow_virtual parameter will be changing its default value from false to true in a future release. If you do not want to allow virtual packages, please explicitly set allow_virtual to false.</span></span><br><span class="line"><span class="string">   (at /usr/share/ruby/vendor_ruby/puppet/type.rb:816:in `set_default&#x27;</span>)</span><br><span class="line">Info: Applying configuration version <span class="string">&#x27;1550046675&#x27;</span></span><br><span class="line">Notice: /Stage[main]/Main/Package[redis]/ensure: created</span><br><span class="line">Info: FileBucket got a duplicate file &#123;md5&#125;d98629fded012cd2a25b9db0599a9251</span><br><span class="line">Info: /Stage[main]/Main/File[/etc/redis.conf]: Filebucketed /etc/redis.conf to puppet with sum d98629fded012cd2a25b9db0599a9251</span><br><span class="line">Notice: /Stage[main]/Main/File[/etc/redis.conf]/content: content changed <span class="string">&#x27;&#123;md5&#125;d98629fded012cd2a25b9db0599a9251&#x27;</span> to <span class="string">&#x27;&#123;md5&#125;d3fc0c22e1a90f88a895242b2a251dad&#x27;</span></span><br><span class="line">Info: /Stage[main]/Main/File[/etc/redis.conf]: Scheduling refresh of Service[redis]</span><br><span class="line">Notice: /Stage[main]/Main/Service[redis]/ensure: ensure changed <span class="string">&#x27;stopped&#x27;</span> to <span class="string">&#x27;running&#x27;</span></span><br><span class="line">Info: /Stage[main]/Main/Service[redis]: Unscheduling refresh on Service[redis]</span><br><span class="line">Notice: Finished catalog run <span class="keyword">in</span> 5.25 seconds</span><br><span class="line">[root@along manifest]<span class="comment"># ss -nutlp |grep redis</span></span><br><span class="line">tcp    LISTEN     0      128    127.0.0.1:6300                  *:*                   users:((<span class="string">&quot;redis-server&quot;</span>,pid=12492,fd=4))</span><br></pre></td></tr></table></figure>

<p>　　</p>
<p>③ 修改 /root/manifest/files/redis.conf  把端口改为6000</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]<span class="comment"># vim files/redis.conf</span></span><br><span class="line">port 6000</span><br><span class="line">[root@along manifest]<span class="comment"># puppet apply -v srv3.pp    再执行，因为文件发生了修改，触发了重启服务，端口也确实改为了6000</span></span><br><span class="line">Notice: Compiled catalog <span class="keyword">for</span> along <span class="keyword">in</span> environment production <span class="keyword">in</span> 0.44 seconds</span><br><span class="line">Warning: The package <span class="built_in">type</span><span class="string">&#x27;s allow_virtual parameter will be changing its default value from false to true in a future release. If you do not want to allow virtual packages, please explicitly set allow_virtual to false.</span></span><br><span class="line"><span class="string">   (at /usr/share/ruby/vendor_ruby/puppet/type.rb:816:in `set_default&#x27;</span>)</span><br><span class="line">Info: Applying configuration version <span class="string">&#x27;1550046726&#x27;</span></span><br><span class="line">Info: /Stage[main]/Main/File[/etc/redis.conf]: Filebucketed /etc/redis.conf to puppet with sum d3fc0c22e1a90f88a895242b2a251dad</span><br><span class="line">Notice: /Stage[main]/Main/File[/etc/redis.conf]/content: content changed <span class="string">&#x27;&#123;md5&#125;d3fc0c22e1a90f88a895242b2a251dad&#x27;</span> to <span class="string">&#x27;&#123;md5&#125;46e070a908eb1aca5c908e62dd4296b9&#x27;</span></span><br><span class="line">Info: /Stage[main]/Main/File[/etc/redis.conf]: Scheduling refresh of Service[redis]</span><br><span class="line">Notice: /Stage[main]/Main/Service[redis]: Triggered <span class="string">&#x27;refresh&#x27;</span> from 1 events</span><br><span class="line">Notice: Finished catalog run <span class="keyword">in</span> 0.23 seconds</span><br><span class="line">[root@along manifest]<span class="comment"># ss -nutlp |grep redis</span></span><br><span class="line">tcp    LISTEN     0      128    127.0.0.1:6000                  *:*                   users:((<span class="string">&quot;redis-server&quot;</span>,pid=12785,fd=4))</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h3 id="4-2-tag-标签"><a href="#4-2-tag-标签" class="headerlink" title="4.2 tag 标签"></a><strong>4.2 tag 标签</strong></h3><p>　　如同 anssible 一样，puppet 也可以定义“标签”——tag，打了标签以后，我们在运行资源的时候就可以只运行某个打过标签的部分，而非全部。这样就更方便于我们的操作。</p>
<p>一个资源中，可以有一个tag也可以有多个。</p>
<p>（1）格式：</p>
<p>资源定义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">type&#123;&#39;title&#39;:</span><br><span class="line">　　...</span><br><span class="line">　　tag &#x3D;&gt; &#39;TAG1&#39;,</span><br><span class="line">&#125;</span><br><span class="line">type&#123;&#39;title&#39;:</span><br><span class="line">　　...</span><br><span class="line">　　tag &#x3D;&gt; [&#39;TAG1&#39;,&#39;TAG2&#39;,...],</span><br><span class="line">&#125;      </span><br></pre></td></tr></table></figure>



<p> 手动调用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">puppet apply --tags TAG1,TAG2,... FILE.PP</span><br></pre></td></tr></table></figure>



<p>（2）实例：</p>
<p>① 创建manifest</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@along manifest]<span class="comment"># vim srv3.pp</span></span><br><span class="line">package&#123;<span class="string">&#x27;redis&#x27;</span>:</span><br><span class="line">        ensure =&gt; installed,</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">file&#123;<span class="string">&#x27;/etc/redis.conf&#x27;</span>:</span><br><span class="line">        ensure  =&gt; file,</span><br><span class="line">        <span class="built_in">source</span>  =&gt; <span class="string">&#x27;/root/manifests/files/redis.conf&#x27;</span>,</span><br><span class="line">        owner   =&gt; <span class="string">&#x27;redis&#x27;</span>,</span><br><span class="line">        group   =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        mode    =&gt; <span class="string">&#x27;0640&#x27;</span>,</span><br><span class="line">        tag     =&gt; <span class="string">&#x27;conf&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">service&#123;<span class="string">&#x27;redis&#x27;</span>:</span><br><span class="line">        ensure  =&gt; running,</span><br><span class="line">        <span class="built_in">enable</span>  =&gt; <span class="literal">false</span>,</span><br><span class="line">        hasrestart =&gt; <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">Package[<span class="string">&#x27;redis&#x27;</span>] -&gt; File[<span class="string">&#x27;/etc/redis.conf&#x27;</span>] ~&gt; Service[<span class="string">&#x27;redis&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>　　</p>
<p>② 执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">---先修改files配置文件端口为8888</span><br><span class="line">[root@along manifest]<span class="comment"># vim files/redis.conf</span></span><br><span class="line">port 8888</span><br><span class="line">---再执行</span><br><span class="line">[root@along manifest]<span class="comment"># puppet apply -v --tags conf srv3.pp</span></span><br><span class="line">Notice: Compiled catalog <span class="keyword">for</span> along <span class="keyword">in</span> environment production <span class="keyword">in</span> 0.44 seconds</span><br><span class="line">Warning: The package <span class="built_in">type</span><span class="string">&#x27;s allow_virtual parameter will be changing its default value from false to true in a future release. If you do not want to allow virtual packages, please explicitly set allow_virtual to false.</span></span><br><span class="line"><span class="string">   (at /usr/share/ruby/vendor_ruby/puppet/type.rb:816:in `set_default&#x27;</span>)</span><br><span class="line">Info: Applying configuration version <span class="string">&#x27;1550113147&#x27;</span></span><br><span class="line">Info: /Stage[main]/Main/File[/etc/redis.conf]: Filebucketed /etc/redis.conf to puppet with sum fe60391ea96c958fe489f86002679ec3</span><br><span class="line">Notice: /Stage[main]/Main/File[/etc/redis.conf]/content: content changed <span class="string">&#x27;&#123;md5&#125;fe60391ea96c958fe489f86002679ec3&#x27;</span> to <span class="string">&#x27;&#123;md5&#125;cb214aa5ead0d70454d957ca9125ad01&#x27;</span></span><br><span class="line">Info: /Stage[main]/Main/File[/etc/redis.conf]: Scheduling refresh of Service[redis]</span><br><span class="line">Notice: /Stage[main]/Main/Service[redis]: Triggered <span class="string">&#x27;refresh&#x27;</span> from 1 events</span><br><span class="line">Notice: Finished catalog run <span class="keyword">in</span> 0.17 seconds</span><br><span class="line">[root@along manifest]<span class="comment"># grep &quot;port 8888&quot; /etc/redis.conf</span></span><br><span class="line">port 8888</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h2 id="5、puppet-变量"><a href="#5、puppet-变量" class="headerlink" title="5、puppet 变量"></a>5、puppet 变量</h2><p>puppet 变量以“$”开头，赋值操作符为“=”，语法为$variable_name=value。</p>
<p>（1）数据类型：</p>
<ul>
<li>字符型：引号可有可无；但单引号为强引用，双引号为弱引用；支持转义符；</li>
<li>数值型：默认均识别为字符串，仅在数值上下文才以数值对待；</li>
<li>数组：[]中以逗号分隔元素列表；</li>
<li>布尔型值：true, false；不能加引号；</li>
<li>hash：{}中以逗号分隔k/v数据列表； 键为字符型，值为任意puppet支持的类型；{ ‘mon’ =&gt; ‘Monday’, ‘tue’ =&gt; ‘Tuesday’, }；</li>
<li>undef：从未被声明的变量的值类型；</li>
</ul>
<p>（2）正则表达式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">　　(?&lt;ENABLED OPTION&gt;:&lt;PATTERN&gt;)</span><br><span class="line">　　(?-&lt;DISABLED OPTION&gt;:&lt;PATTERN&gt;)</span><br><span class="line">　　OPTIONS：</span><br><span class="line">　　　　i：忽略字符大小写；</span><br><span class="line">　　　　m：把.当换行符；</span><br><span class="line">　　　　x：忽略&lt;PATTERN&gt;中的空白字符；</span><br></pre></td></tr></table></figure>

<p>注意：不能赋值给变量，仅能用在接受=<del>或!</del>操作符的位置；</p>
<p>（3）puppet的变量种类</p>
<p>　　puppet 种类有三种，为facts，内建变量和用户自定义变量。</p>
<ul>
<li><p>facts</p>
<p>：</p>
<ul>
<li>由facter提供；top scope；</li>
</ul>
</li>
<li><p>内建变量：</p>
<ul>
<li>master端变量：$servername, $serverip, $serverversion</li>
<li>agent端变量：$clientcert, $clientversion, $environment　</li>
<li>parser变量:$module_name</li>
</ul>
</li>
<li><p>用户自定义变量</p>
</li>
</ul>
<p>（4）变量的作用域</p>
<ul>
<li>不同的变量也有其不同的作用域。我们称之为Scope。</li>
<li>作用域有三种，top scope，node scope，class scope。</li>
<li>其生效范围排序为：top scope &gt; node scope &gt; class scope</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/Waylonwhynot/whatyouneed_blog_pic@main/pic/1216496-20190214113435675-899383428.png" alt="img"></p>
<p>其优先级排序为：top scope &lt; node scope &lt; class scope</p>
<h2 id="6、puppet-流程控制语句"><a href="#6、puppet-流程控制语句" class="headerlink" title="6、puppet 流程控制语句"></a>6、puppet 流程控制语句</h2><p>　　puppet 支持<strong>if 语句</strong>，<strong>case 语句</strong>和<strong>selector 语句</strong>。</p>
<h3 id="1）if-语句"><a href="#1）if-语句" class="headerlink" title="1）if 语句"></a>1）if 语句</h3><p>　　if语句支持单分支，双分支和多分支。具体语法如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">单分支：</span><br><span class="line">    <span class="keyword">if</span> CONDITION &#123;</span><br><span class="line">        statement</span><br><span class="line">        ……</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">双分支：</span><br><span class="line">    <span class="keyword">if</span> CONDITION &#123;</span><br><span class="line">        statement</span><br><span class="line">        ……</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        statement</span><br><span class="line">        ……        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">多分支：</span><br><span class="line">    <span class="keyword">if</span> CONDITION &#123;</span><br><span class="line">        statement</span><br><span class="line">        ……</span><br><span class="line">    &#125;</span><br><span class="line">elsif CONDITION&#123;</span><br><span class="line">        statement</span><br><span class="line">        ……</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        statement</span><br><span class="line">        ……        </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>　　其中，CONDITION的给定方式有如下三种：</p>
<ul>
<li>变量</li>
<li>比较表达式</li>
<li>有返回值的函数</li>
</ul>
<p><strong>举例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="keyword">if</span>.pp</span><br><span class="line">    <span class="keyword">if</span> $operatingsystemmajrelease == <span class="string">&#x27;7&#x27;</span> &#123;</span><br><span class="line">        $db_pkg=<span class="string">&#x27;mariadb-server&#x27;</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $db_pkg=<span class="string">&#x27;mysql-server&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    package&#123;<span class="string">&quot;$db_pkg&quot;</span>:</span><br><span class="line">        ensure =&gt; installed,</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="2）case-语句"><a href="#2）case-语句" class="headerlink" title="2）case 语句"></a>2）case 语句</h4><p>　　类似 if 语句，case 语句会从多个代码块中选择一个分支执行，这跟其它编程语言中的 case 语句功能一致。 　case 语句会接受一个控制表达式和一组 case 代码块，并执行第一个匹配到控制表达式的块。 　使用语法如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> CONTROL_EXPRESSION &#123;</span><br><span class="line">    case1: &#123; ... &#125;</span><br><span class="line">    case2: &#123; ... &#125;</span><br><span class="line">    case3: &#123; ... &#125;</span><br><span class="line">    ……</span><br><span class="line">    <span class="keyword">default</span>: &#123; ... &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>复制</p>
<p>　　其中，CONTROL_EXPRESSION的给定方式有如下三种:</p>
<ul>
<li>变量</li>
<li>表达式</li>
<li>有返回值的函数</li>
</ul>
<p>　　各case的给定方式有如下五种：</p>
<ul>
<li>直接字串；</li>
<li>变量</li>
<li>有返回值的函数</li>
<li>正则表达式模式；</li>
<li>default</li>
</ul>
<p><strong>举例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="keyword">case</span>.pp</span><br><span class="line">    <span class="keyword">case</span> $osfamily &#123;</span><br><span class="line">        <span class="string">&quot;RedHat&quot;</span>: &#123; $webserver=<span class="string">&#x27;httpd&#x27;</span> &#125;</span><br><span class="line">        /(?i-mx:debian)/: &#123; $webserver=<span class="string">&#x27;apache2&#x27;</span> &#125;</span><br><span class="line">        <span class="keyword">default</span>: &#123; $webserver=<span class="string">&#x27;httpd&#x27;</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    package&#123;<span class="string">&quot;$webserver&quot;</span>:</span><br><span class="line">        ensure  =&gt; installed,    <span class="function"><span class="params">before</span>  =&gt;</span> [ File[<span class="string">&#x27;httpd.conf&#x27;</span>], Service[<span class="string">&#x27;httpd&#x27;</span>] ],</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    file&#123;<span class="string">&#x27;httpd.conf&#x27;</span>:</span><br><span class="line">        path    =&gt; <span class="string">&#x27;/etc/httpd/conf/httpd.conf&#x27;</span>,</span><br><span class="line">        source  =&gt; <span class="string">&#x27;/root/manifests/httpd.conf&#x27;</span>,</span><br><span class="line">        ensure  =&gt; file,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    service&#123;<span class="string">&#x27;httpd&#x27;</span>:</span><br><span class="line">        ensure  =&gt; running,</span><br><span class="line">        enable  =&gt; <span class="literal">true</span>,    <span class="function"><span class="params">restart</span> =&gt;</span> <span class="string">&#x27;systemctl restart httpd.service&#x27;</span>,</span><br><span class="line">        subscribe =&gt; File[<span class="string">&#x27;httpd.conf&#x27;</span>],</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="3）selector-语句"><a href="#3）selector-语句" class="headerlink" title="3）selector 语句"></a>3）selector 语句</h4><p>　　Selector 只能用于期望出现直接值(plain value) 的地方，这包括变量赋值、资源属性、函数参数、资源标题、其它 selector。 　selector 不能用于一个已经嵌套于于selector 的case 中，也不能用于一个已经嵌套于case 的case 语句中。 　具体语法如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CONTROL_VARIABLE ? &#123;</span><br><span class="line">    case1 =&gt; value1,</span><br><span class="line">    case2 =&gt; value2,</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">default</span> =&gt; valueN,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>复制</p>
<p>　　其中，CONTROL_EXPRESSION的给定方式有如下三种:</p>
<ul>
<li>变量</li>
<li>表达式</li>
<li>有返回值的函数</li>
</ul>
<p>　　各case的给定方式有如下五种：</p>
<ul>
<li><p>直接子串；</p>
</li>
<li><p>变量；</p>
</li>
<li><p>有返回值的函数；</p>
</li>
<li><p>正则表达式模式；</p>
</li>
<li><p>default</p>
<p><strong>selectors 使用要点：</strong></p>
</li>
</ul>
<ol>
<li>整个selector 语句会被当作一个单独的值，puppet 会将控制变量按列出的次序与每个case 进行比较，并在遇到一个匹配的 case 后，将其值作为整个语句的值进行返回，并忽略后面的其它 case。</li>
<li>控制变量与各 case 比较的方式与 case 语句相同，但如果没有任何一个 case 与控制变量匹配时，puppet 在编译时将会返回一个错误，因此，实践中，其必须提供default case。</li>
<li>selector 的控制变量只能是变量或有返回值的函数，切记不能使用表达式。</li>
<li>其各 case 可以是直接值(需要加引号) 、变量、能调用返回值的函数、正则表达式模式或 default。</li>
<li>但与 case 语句所不同的是，selector 的各 case 不能使用列表。</li>
<li>selector 的各 case 的值可以是一个除了 hash 以外的直接值、变量、能调用返回值的函数或其它的 selector。</li>
</ol>
<p><strong>举例</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vim selector.pp</span><br><span class="line">    $pkgname = $operatingsystem ? &#123;</span><br><span class="line">        /(?i-mx:(ubuntu|debian))/       =&gt; <span class="string">&#x27;apache2&#x27;</span>,</span><br><span class="line">        /(?i-mx:(redhat|fedora|centos))/        =&gt; <span class="string">&#x27;httpd&#x27;</span>,</span><br><span class="line">        <span class="keyword">default</span> =&gt; <span class="string">&#x27;httpd&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    package&#123;<span class="string">&quot;$pkgname&quot;</span>:</span><br><span class="line">        ensure  =&gt; installed,</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined" rel="external nofollow noreferrer">Waylon Yan</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://waylon.whatyouneed.site/2022/08/25/Linux-Puppet/">https://waylon.whatyouneed.site/2022/08/25/Linux-Puppet/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener external nofollow noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/automation/">automation</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/08/26/Linux-Puppet-02/"><img class="prev-cover" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Linux-Puppet-02</div></div></a></div><div class="next-post pull-right"><a href="/2022/06/19/mysql-03/"><img class="next-cover" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">mysql-03</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2022/08/27/Linux-Puppet-03/" title="Linux-Puppet-03"><img class="cover" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-27</div><div class="title">Linux-Puppet-03</div></div></a></div><div><a href="/2022/08/26/Linux-Puppet-02/" title="Linux-Puppet-02"><img class="cover" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-26</div><div class="title">Linux-Puppet-02</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Waylon Yan</div><div class="author-info__description">tech life sharing</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">253</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">39</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">24</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Waylonwhynot" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:ywl1006@outlook.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">无止境</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E8%AE%A4%E8%AF%86puppet"><span class="toc-number">1.</span> <span class="toc-text">1、认识puppet</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E5%BC%95%E5%85%A5"><span class="toc-number">1.0.1.</span> <span class="toc-text">1.1 引入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.0.2.</span> <span class="toc-text">1.2 介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-puppet-%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A"><span class="toc-number">1.0.3.</span> <span class="toc-text">1.3 puppet 名词解释</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-puppet%E5%B8%B8%E7%94%A8%E8%B5%84%E6%BA%90%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.0.4.</span> <span class="toc-text">1.4 puppet常用资源类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-puppet%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8"><span class="toc-number">1.0.5.</span> <span class="toc-text">1.5 puppet命令使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-6-puppet%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-number">1.0.6.</span> <span class="toc-text">1.6 puppet的优缺点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81puppet%E7%9A%84%E4%BD%BF%E7%94%A8%E6%A8%A1%E5%9E%8B%E5%8F%8A%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">2.</span> <span class="toc-text">2、puppet的使用模型及工作流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-master-agent%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.0.1.</span> <span class="toc-text">2.1 master&#x2F;agent模型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E5%8D%95%E6%9C%BA%E4%BD%BF%E7%94%A8%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.0.2.</span> <span class="toc-text">2.2 单机使用模型</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81puppet%E8%B5%84%E6%BA%90%E8%AF%A6%E8%A7%A3"><span class="toc-number">3.</span> <span class="toc-text">3、puppet资源详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-puppet%E8%B5%84%E6%BA%90%E4%BB%8B%E7%BB%8D"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 puppet资源介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-1-%E7%A8%8B%E5%BA%8F%E5%AE%89%E8%A3%85%E5%8F%8A%E7%8E%AF%E5%A2%83"><span class="toc-number">3.1.1.</span> <span class="toc-text">3.1.1 程序安装及环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2-puppet%E8%B5%84%E6%BA%90%E7%AE%80%E4%BB%8B"><span class="toc-number">3.1.2.</span> <span class="toc-text">3.1.2 puppet资源简介</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-group%EF%BC%9AManage-groups"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 group：Manage groups</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-%E7%B1%BB%E5%9E%8B%E5%B1%9E%E6%80%A7%E9%80%89%E9%A1%B9"><span class="toc-number">3.2.1.</span> <span class="toc-text">3.2.1 类型属性选项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-%E6%BC%94%E7%A4%BA"><span class="toc-number">3.2.2.</span> <span class="toc-text">3.2.2 演示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-user%EF%BC%9AManage-users"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 user：Manage users</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-1-%E7%B1%BB%E5%9E%8B%E5%B1%9E%E6%80%A7%E9%80%89%E9%A1%B9"><span class="toc-number">3.3.1.</span> <span class="toc-text">3.3.1 类型属性选项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-2-%E6%BC%94%E7%A4%BA"><span class="toc-number">3.3.2.</span> <span class="toc-text">3.3.2 演示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-package%EF%BC%9AManage-packages"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 package：Manage packages</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-1-%E7%B1%BB%E5%9E%8B%E5%B1%9E%E6%80%A7%E9%80%89%E9%A1%B9"><span class="toc-number">3.4.1.</span> <span class="toc-text">3.4.1 类型属性选项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-2-%E6%BC%94%E7%A4%BA"><span class="toc-number">3.4.2.</span> <span class="toc-text">3.4.2 演示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-service%EF%BC%9AManage-running-services"><span class="toc-number">3.5.</span> <span class="toc-text">3.5 service：Manage running services</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-1-%E7%B1%BB%E5%9E%8B%E5%B1%9E%E6%80%A7%E9%80%89%E9%A1%B9"><span class="toc-number">3.5.1.</span> <span class="toc-text">3.5.1 类型属性选项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-2-%E6%BC%94%E7%A4%BA1%EF%BC%9A%E5%BC%80%E5%90%AFredis-%E6%9C%8D%E5%8A%A1"><span class="toc-number">3.5.2.</span> <span class="toc-text">3.5.2 演示1：开启redis 服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-2-%E6%BC%94%E7%A4%BA1%EF%BC%9A%E4%B8%8B%E8%BD%BDmemcached-%E5%8C%85%EF%BC%8C%E4%B8%94%E5%BC%80%E5%90%AF%E6%9C%8D%E5%8A%A1"><span class="toc-number">3.5.3.</span> <span class="toc-text">3.5.2 演示1：下载memcached 包，且开启服务</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-file%EF%BC%9A%E7%AE%A1%E7%90%86%E6%96%87%E4%BB%B6%EF%BC%8C%E5%8C%85%E6%8B%AC%E5%AE%83%E4%BB%AC%E7%9A%84%E5%86%85%E5%AE%B9%E3%80%81%E6%89%80%E6%9C%89%E6%9D%83%E5%92%8C%E6%9D%83%E9%99%90"><span class="toc-number">3.6.</span> <span class="toc-text">3.6 file：管理文件，包括它们的内容、所有权和权限</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-1-%E7%B1%BB%E5%9E%8B%E5%B1%9E%E6%80%A7%E9%80%89%E9%A1%B9"><span class="toc-number">3.6.1.</span> <span class="toc-text">3.6.1 类型属性选项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-2-%E6%BC%94%E7%A4%BA1%EF%BC%9A%E5%88%9B%E5%BB%BAtest-txt%EF%BC%8C%E4%B8%94%E7%9B%B4%E6%8E%A5%E5%86%99%E5%86%85%E5%AE%B9"><span class="toc-number">3.6.2.</span> <span class="toc-text">3.6.2 演示1：创建test.txt，且直接写内容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-3-%E6%BC%94%E7%A4%BA2%EF%BC%9A%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6%EF%BC%8C%E4%B8%94%E5%A4%8D%E5%88%B6%E5%8F%A6%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6%E7%9A%84%E5%86%85%E5%AE%B9%EF%BC%9B%E5%86%8D%E5%AF%B9%E8%BF%99%E4%B8%AA%E6%96%87%E4%BB%B6%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E8%BD%AF%E9%93%BE%E6%8E%A5%E6%96%87%E4%BB%B6"><span class="toc-number">3.6.3.</span> <span class="toc-text">3.6.3 演示2：创建一个文件，且复制另一个文件的内容；再对这个文件创建一个软链接文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-4-%E6%BC%94%E7%A4%BA3%EF%BC%9A%E5%88%9B%E5%BB%BA%E7%9B%AE%E5%BD%95%EF%BC%8C%E4%B8%94%E9%80%92%E5%BD%92%E5%A4%8D%E5%88%B6%E5%8F%A6%E4%B8%80%E4%B8%AA%E7%9B%AE%E5%BD%95"><span class="toc-number">3.6.4.</span> <span class="toc-text">3.6.4 演示3：创建目录，且递归复制另一个目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-6-5-%E6%BC%94%E7%A4%BA4%EF%BC%9A%E4%B8%8B%E8%BD%BDredis-%E5%8C%85%EF%BC%8C%E5%A4%8D%E5%88%B6%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%8C%E5%90%AF%E5%8A%A8redis-%E6%9C%8D%E5%8A%A1"><span class="toc-number">3.6.5.</span> <span class="toc-text">3.6.5 演示4：下载redis 包，复制配置文件，启动redis 服务</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-7-exec%EF%BC%9A%E6%89%A7%E8%A1%8C%E5%A4%96%E9%83%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">3.7.</span> <span class="toc-text">3.7 exec：执行外部命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-1-%E7%B1%BB%E5%9E%8B%E5%B1%9E%E6%80%A7%E9%80%89%E9%A1%B9"><span class="toc-number">3.7.1.</span> <span class="toc-text">3.7.1 类型属性选项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-2-%E6%BC%94%E7%A4%BA1%EF%BC%9A%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%9B%AE%E5%BD%95"><span class="toc-number">3.7.2.</span> <span class="toc-text">3.7.2 演示1：创建一个目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-3-%E6%BC%94%E7%A4%BA2%EF%BC%9A%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%94%A8%E6%88%B7"><span class="toc-number">3.7.3.</span> <span class="toc-text">3.7.3 演示2：创建一个用户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-7-4-%E6%BC%94%E7%A4%BA3%EF%BC%9A%E4%B8%8B%E8%BD%BD%EF%BC%8C%E5%BC%80%E5%90%AFredis"><span class="toc-number">3.7.4.</span> <span class="toc-text">3.7.4 演示3：下载，开启redis</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-cron%EF%BC%9A%E5%AE%89%E8%A3%85%E5%92%8C%E7%AE%A1%E7%90%86cron%E4%BD%9C%E4%B8%9A"><span class="toc-number">3.8.</span> <span class="toc-text">3.8 cron：安装和管理cron作业</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-8-1-%E7%B1%BB%E5%9E%8B%E5%B1%9E%E6%80%A7%E9%80%89%E9%A1%B9"><span class="toc-number">3.8.1.</span> <span class="toc-text">3.8.1 类型属性选项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-8-2-%E6%BC%94%E7%A4%BA"><span class="toc-number">3.8.2.</span> <span class="toc-text">3.8.2 演示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-9-notify%EF%BC%9A%E5%90%91%E4%BB%A3%E7%90%86%E8%BF%90%E8%A1%8C%E6%97%B6%E6%97%A5%E5%BF%97%E5%8F%91%E9%80%81%E4%B8%80%E4%B8%AA%E4%BB%BB%E6%84%8F%E7%9A%84%E6%B6%88%E6%81%AF"><span class="toc-number">3.9.</span> <span class="toc-text">3.9 notify：向代理运行时日志发送一个任意的消息</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-9-1-%E7%B1%BB%E5%9E%8B%E5%B1%9E%E6%80%A7%E9%80%89%E9%A1%B9"><span class="toc-number">3.9.1.</span> <span class="toc-text">3.9.1 类型属性选项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-9-2-%E6%BC%94%E7%A4%BA"><span class="toc-number">3.9.2.</span> <span class="toc-text">3.9.2 演示</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-10-%E9%9D%9E%E6%A0%B8%E5%BF%83%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%B8%B8%E7%94%A8%E8%B5%84%E6%BA%90%EF%BC%9Ayumrepo-host"><span class="toc-number">3.10.</span> <span class="toc-text">3.10 非核心类型的常用资源：yumrepo, host</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E8%B5%84%E6%BA%90%E7%9A%84%E7%89%B9%E6%AE%8A%E5%B1%9E%E6%80%A7"><span class="toc-number">4.</span> <span class="toc-text">4、资源的特殊属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E8%B5%84%E6%BA%90%E9%97%B4%E4%BE%9D%E8%B5%96%E5%92%8C%E9%80%9A%E7%9F%A5%E5%85%B3%E7%B3%BB"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 资源间依赖和通知关系</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-1-%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB%E5%85%83%E5%8F%82%E6%95%B0%EF%BC%9Abefore-require"><span class="toc-number">4.1.1.</span> <span class="toc-text">4.1.1 依赖关系元参数：before&#x2F;require</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-2-%E9%80%9A%E7%9F%A5%E5%85%B3%E7%B3%BB%EF%BC%9A%E9%80%9A%E7%9F%A5%E7%9B%B8%E5%85%B3%E7%9A%84%E5%85%B6%E5%AE%83%E8%B5%84%E6%BA%90%E8%BF%9B%E8%A1%8C%E2%80%9C%E5%88%B7%E6%96%B0%E2%80%9D%E6%93%8D%E4%BD%9C"><span class="toc-number">4.1.2.</span> <span class="toc-text">4.1.2 通知关系：通知相关的其它资源进行“刷新”操作</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-tag-%E6%A0%87%E7%AD%BE"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 tag 标签</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81puppet-%E5%8F%98%E9%87%8F"><span class="toc-number">5.</span> <span class="toc-text">5、puppet 变量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81puppet-%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6%E8%AF%AD%E5%8F%A5"><span class="toc-number">6.</span> <span class="toc-text">6、puppet 流程控制语句</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%89if-%E8%AF%AD%E5%8F%A5"><span class="toc-number">6.1.</span> <span class="toc-text">1）if 语句</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89case-%E8%AF%AD%E5%8F%A5"><span class="toc-number">6.1.1.</span> <span class="toc-text">2）case 语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%89selector-%E8%AF%AD%E5%8F%A5"><span class="toc-number">6.1.2.</span> <span class="toc-text">3）selector 语句</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/04/21/Python-%E5%B8%B8%E7%94%A8%E5%BA%93-jsonpath/" title="Python-常用库-jsonpath"><img src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Python-常用库-jsonpath"/></a><div class="content"><a class="title" href="/2023/04/21/Python-%E5%B8%B8%E7%94%A8%E5%BA%93-jsonpath/" title="Python-常用库-jsonpath">Python-常用库-jsonpath</a><time datetime="2023-04-21T15:47:39.000Z" title="Created 2023-04-21 23:47:39">2023-04-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/04/09/Ansible-Runner-01/" title="Ansible-Runner-01"><img src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Ansible-Runner-01"/></a><div class="content"><a class="title" href="/2023/04/09/Ansible-Runner-01/" title="Ansible-Runner-01">Ansible-Runner-01</a><time datetime="2023-04-09T05:03:50.000Z" title="Created 2023-04-09 13:03:50">2023-04-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/01/28/mongoengine-01/" title="mongoengine-01"><img src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="mongoengine-01"/></a><div class="content"><a class="title" href="/2023/01/28/mongoengine-01/" title="mongoengine-01">mongoengine-01</a><time datetime="2023-01-27T18:16:07.000Z" title="Created 2023-01-28 02:16:07">2023-01-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/12/17/%E5%89%8D%E7%AB%AF-cookie-session-%E5%85%B6%E4%BB%96%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F/" title="前端-cookie-session-其他存储方式"><img src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="前端-cookie-session-其他存储方式"/></a><div class="content"><a class="title" href="/2022/12/17/%E5%89%8D%E7%AB%AF-cookie-session-%E5%85%B6%E4%BB%96%E5%AD%98%E5%82%A8%E6%96%B9%E5%BC%8F/" title="前端-cookie-session-其他存储方式">前端-cookie-session-其他存储方式</a><time datetime="2022-12-17T13:58:36.000Z" title="Created 2022-12-17 21:58:36">2022-12-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/11/30/Linux-%E4%B8%89%E5%89%91%E5%AE%A2grep-sed-awk/" title="Linux-三剑客grep-sed-awk"><img src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux-三剑客grep-sed-awk"/></a><div class="content"><a class="title" href="/2022/11/30/Linux-%E4%B8%89%E5%89%91%E5%AE%A2grep-sed-awk/" title="Linux-三剑客grep-sed-awk">Linux-三剑客grep-sed-awk</a><time datetime="2022-11-29T17:30:06.000Z" title="Created 2022-11-30 01:30:06">2022-11-30</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Waylon Yan</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Local search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>