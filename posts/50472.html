<!DOCTYPE html><html lang="zh-Hans" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>09-Django进阶-模型-单表多表 | YouNeed</title><meta name="keywords" content="ORM"><meta name="author" content="Waylon Yan"><meta name="copyright" content="Waylon Yan"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Django Models 多表&#x2F;子查询&#x2F;联表查询&#x2F;FQ">
<meta property="og:type" content="article">
<meta property="og:title" content="09-Django进阶-模型-单表多表">
<meta property="og:url" content="http://yoursite.com/posts/50472.html">
<meta property="og:site_name" content="YouNeed">
<meta property="og:description" content="Django Models 多表&#x2F;子查询&#x2F;联表查询&#x2F;FQ">
<meta property="og:locale">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png">
<meta property="article:published_time" content="2021-05-09T15:26:42.000Z">
<meta property="article:modified_time" content="2025-08-04T15:41:26.877Z">
<meta property="article:author" content="Waylon Yan">
<meta property="article:tag" content="ORM">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://yoursite.com/posts/50472"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '09-Django进阶-模型-单表多表',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-08-04 23:41:26'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.0.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">266</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">40</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">25</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Catagroires</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">YouNeed</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Catagroires</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">09-Django进阶-模型-单表多表</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2021-05-09T15:26:42.000Z" title="Created 2021-05-09 23:26:42">2021-05-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-08-04T15:41:26.877Z" title="Updated 2025-08-04 23:41:26">2025-08-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Django/">Django</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="09-Django进阶-模型-单表多表"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>Django Models 多表/子查询/联表查询/FQ</p>
<a id="more"></a>

<h1 id="一-表关系回顾"><a href="#一-表关系回顾" class="headerlink" title="一 表关系回顾"></a>一 表关系回顾</h1><p> 在讲解MySQL时，我们提到，把应用程序的所有数据都放在一张表里是极不合理的。</p>
<p> 比如我们开发一个员工管理系统，在数据库里只创建一张员工信息表，该表有四个字段：工号、姓名、部门名、部门职能描述，此时若公司有1万名员工，但只有3个部门，因为每一名员工后都需要跟着部门信息（部门名、部门职能），所以将会导致部门信息出现大量重复、浪费空间。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Waylonwhynot/whatyouneed_blog_pic@main/pic/1825659-20191012154506056-742977620.gif" alt="img">]</p>
<p> 解决方法就是将数据存放于不同的表中，然后基于foreign key建立表之间的关联关系。</p>
<p> 细说的话，表之间存在三种关系：多对一、一对一、多对多，那如何确定两张表之间的关系呢？按照下述步骤操作即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">左表&lt;-------------------------------&gt;右表</span><br><span class="line"></span><br><span class="line"><span class="comment"># 步骤一：先分析</span></span><br><span class="line"><span class="comment">#分析1、先站在左表的角度</span></span><br><span class="line">是否左表的多条记录可以对应右表的一条记录</span><br><span class="line"></span><br><span class="line"><span class="comment">#分析2、再站在右表的角度去找</span></span><br><span class="line">是否右表的多条记录可以对应左表的一条记录</span><br><span class="line"></span><br><span class="line"><span class="comment"># 步骤二：后确定关系</span></span><br><span class="line"><span class="comment"># 多对一</span></span><br><span class="line">如果只有<span class="string">&quot;分析1&quot;</span>成立，那么可以确定两张表的关系是：左表多对一右表，关联字段应该创建在左表中，然后foreign key 右表一个字段（通常是id）</span><br><span class="line">如果只有<span class="string">&quot;分析2&quot;</span>成立，那么可以确定两张表的关系是：右表多对一左表，关联字段应该创建在右表中，然后foreign key 左表一个字段（通常是id）</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一对一</span></span><br><span class="line">如果<span class="string">&quot;分析1&quot;</span>和<span class="string">&quot;分析2&quot;</span>都不成立，而是左表的一条记录唯一对应右表的一条记录，反之亦然。这种情况很简单，就是在左表foreign key右表的基础上，将左表的关联字段设置成unique即可</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多对多</span></span><br><span class="line">如果<span class="string">&quot;分析1&quot;</span>和<span class="string">&quot;分析2&quot;</span>同时成立，则证明这两张表是一个双向的多对一，即多对多,需要创建一张单独的新表来专门存放二者的关系，关联字段应该创建在新表中，然后在新表中分别foreign key两张表的id字段</span><br></pre></td></tr></table></figure>

<p>我们以一个图书管理系统为背景，设计了下述四张表，让我们来找一找它们之间的关系</p>
<p>书籍表：app01_book</p>
<p>出版社表：app01_publish</p>
<p>作者表：app01_author</p>
<p>作者详细信息表：app01_authordetail</p>
<h4 id="例1、app01-book与app01-publish"><a href="#例1、app01-book与app01-publish" class="headerlink" title="例1、app01_book与app01_publish"></a>例1、app01_book与app01_publish</h4><p>找关系</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">左表(app01_book)&lt;-------------------------------&gt;右表(app01_publish)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 步骤一：</span></span><br><span class="line"><span class="comment">#分析1、先站在左表的角度</span></span><br><span class="line">左表的多条记录代表多版本书籍，右表的一条记录代表一个出版社，多本书籍对应同一个出版社 ✔️</span><br><span class="line"></span><br><span class="line"><span class="comment">#分析2、再站在右表的角度去找</span></span><br><span class="line">右表的多条记录代表多个出版社，左表的一条记录代表一本书，多个出版社不能出版同一本书 ✘</span><br><span class="line"></span><br><span class="line"><span class="comment"># 步骤二：后确定关系</span></span><br><span class="line"><span class="comment"># 多对一</span></span><br><span class="line">只有<span class="string">&quot;分析1&quot;</span>成立，那么可以确定两张表的关系是：左表(app01_book)多对一右表(app01_publish)，关联字段应该创建在左表(app01_book)中，然后foreign key 右表(app01_publish)的id字段</span><br></pre></td></tr></table></figure>

<p>sql语句</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、由于foreign key的影响,必须先创建被关联表</span></span><br><span class="line">CREATE TABLE app01_publish (</span><br><span class="line">    id INT PRIMARY KEY auto_increment,</span><br><span class="line">    name VARCHAR (<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、才能创建出关联表</span></span><br><span class="line">CREATE TABLE app01_book (</span><br><span class="line">    id INT PRIMARY KEY auto_increment,</span><br><span class="line">    title VARCHAR (<span class="number">20</span>),</span><br><span class="line">    price DECIMAL (<span class="number">8</span>, <span class="number">2</span>),</span><br><span class="line">    pub_date DATE,</span><br><span class="line">    publish_id INT, <span class="comment"># 新增关联字段</span></span><br><span class="line">    FOREIGN KEY (publish_id) REFERENCES app01_publish (id) </span><br><span class="line">    ON UPDATE CASCADE ON DELETE CASCADE</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="例2、app01-author与app01-authordetail"><a href="#例2、app01-author与app01-authordetail" class="headerlink" title="例2、app01_author与app01_authordetail"></a>例2、app01_author与app01_authordetail</h4><p>找关系</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">左表(app01_author)&lt;-------------------------------&gt;右表(app01_authordetail)</span><br><span class="line"></span><br><span class="line">一个作者唯一对应一条自己的详情信息，反之亦然，所以两张表是一对一的关系。在左表中新增关联字段并添加unique约束，然后foreign key右表</span><br></pre></td></tr></table></figure>

<p>sql语句</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、由于foreign key的影响,必须先创建被关联表</span></span><br><span class="line">CREATE TABLE app01_authordetail (</span><br><span class="line">    id INT PRIMARY KEY auto_increment,</span><br><span class="line">    tel VARCHAR (<span class="number">20</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、才能创建出关联表</span></span><br><span class="line">CREATE TABLE app01_author (</span><br><span class="line">    id INT PRIMARY KEY auto_increment,</span><br><span class="line">    name VARCHAR (<span class="number">20</span>),</span><br><span class="line">    age INT,</span><br><span class="line">    authordetail_id INT UNIQUE, <span class="comment"># 新增关联字段,并添加唯一性约束unique</span></span><br><span class="line">    FOREIGN KEY (authordetail_id) REFERENCES app01_authordetail (id) </span><br><span class="line">    ON UPDATE CASCADE ON DELETE CASCADE</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="例3、app01-book与app01-author"><a href="#例3、app01-book与app01-author" class="headerlink" title="例3、app01_book与app01_author"></a>例3、app01_book与app01_author</h4><p>找关系</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">左表(app01_book)&lt;-------------------------------&gt;右表(app01_author)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 步骤一：</span></span><br><span class="line"><span class="comment">#分析1、先站在左表的角度</span></span><br><span class="line">左表的多条记录代表多版本书籍，右表的一条记录代表一个作者，多本书籍可以由同一个作者编写 ✔️</span><br><span class="line"></span><br><span class="line"><span class="comment">#分析2、再站在右表的角度去找</span></span><br><span class="line">右表的多条记录代表多个作者，左表的一条记录代表一本书，多个作者可以合作编写同一本书 ✔️</span><br><span class="line"></span><br><span class="line"><span class="comment"># 步骤二：后确定关系</span></span><br><span class="line"><span class="comment"># 多对多</span></span><br><span class="line"><span class="string">&quot;分析1&quot;</span>和<span class="string">&quot;分析2&quot;</span>同时成立，证明这两张表是多对多的关系,需要创建一张单独的新表来专门存放二者的关系，关联字段应该创建在新表中，然后在新表中分别foreign key两张表的id字段</span><br></pre></td></tr></table></figure>

<p>sql语句</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、创建被关联表一：app01_book，例1中已创建</span></span><br><span class="line"><span class="comment"># 2、创建被关联表二：app01_author，例2中已创建</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、创建新表，存放app01_book于app01_author的关联关系</span></span><br><span class="line">CREATE TABLE app01_book_authors (</span><br><span class="line">    id INT PRIMARY KEY auto_increment,</span><br><span class="line">    book_id INT, <span class="comment"># 新增关联字段，用来关联表app01_book</span></span><br><span class="line">    author_id INT, <span class="comment"># 新增关联字段，用来关联表app01_author</span></span><br><span class="line">    FOREIGN KEY (book_id) REFERENCES app01_book (id) ON UPDATE CASCADE ON DELETE CASCADE,</span><br><span class="line">    FOREIGN KEY (author_id) REFERENCES app01_author (id) ON UPDATE CASCADE ON DELETE CASCADE</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>上述三个例子中生成的表如下</p>
<p>插图5，修改链接：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.processon.com/diagraming/5a895fdde4b0874437c9c580">https://www.processon.com/diagraming/5a895fdde4b0874437c9c580</a></p>
<p>[<img src="https://cdn.jsdelivr.net/gh/Waylonwhynot/whatyouneed_blog_pic@main/pic/1825659-20191012154506295-1608619351.-20210509234914708.jpg" alt="插图5"></p>
<h1 id="二-创建模型"><a href="#二-创建模型" class="headerlink" title="二 创建模型"></a>二 创建模型</h1><p>模型类如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">Copyfrom django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># 表app01_publish</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Publish</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    nid = models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = models.CharField(max_length=<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 表app01_book</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    nid = models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">    title = models.CharField(max_length=<span class="number">20</span>)</span><br><span class="line">    price = models.DecimalField(max_digits=<span class="number">8</span>, decimal_places=<span class="number">2</span>)</span><br><span class="line">    pub_date = models.DateField()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 表app01_book多对一表app01_publish，参数to指定模型名，参数to_field指定要关联的那个字段</span></span><br><span class="line">    <span class="comment"># 默认与出版社的主键字段做外键关联</span></span><br><span class="line">    publish = models.ForeignKey(to=<span class="string">&#x27;Publish&#x27;</span>,to_field=<span class="string">&#x27;nid&#x27;</span>,on_delete=models.CASCADE)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 我们自己写sql时，针对书籍表与作者表的多对关系，需要自己创建新表，而基于django的orm，下面这一行代码可以帮我们自动创建那张关系表</span></span><br><span class="line">    authors=models.ManyToManyField(to=<span class="string">&#x27;Author&#x27;</span>) </span><br><span class="line">    <span class="comment"># 变量名为authors，则新表名为app01_book_authors，若变量名为xxx，则新表名为app01_book_xxx</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 表app01_author</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    nid = models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = models.CharField(max_length=<span class="number">20</span>)</span><br><span class="line">    age = models.IntegerField()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 表app01_author一对一表app01_authordetail</span></span><br><span class="line">    author_detail = models.OneToOneField(to=<span class="string">&#x27;AuthorDetail&#x27;</span>,to_field=<span class="string">&#x27;nid&#x27;</span>,unique=<span class="literal">True</span>,on_delete=models.CASCADE)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 表app01_authordetail</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AuthorDetail</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    nid = models.AutoField(primary_key=<span class="literal">True</span>)</span><br><span class="line">    tel = models.CharField(max_length=<span class="number">20</span>)</span><br></pre></td></tr></table></figure>

<p>强调：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在创建关联时，针对参数to，如果传入的是字符串（to=<span class="string">&quot;模型名&quot;</span>），则模型类的定义不区分先后顺序，如果传入的是模型名（to=Author），则Author类必须事先定义</span><br></pre></td></tr></table></figure>





<hr>
<h1 id="1、单表查询-增删改查"><a href="#1、单表查询-增删改查" class="headerlink" title="1、单表查询(增删改查)"></a>1、单表查询(增删改查)</h1><p>Django自带的sqlite3数据库对日期格式不是很敏感，处理的时候容易出错，所以我们直接切换成mysql。</p>
<p>settings.py文件配置数据库：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">&#x27;default&#x27;</span>: &#123;</span><br><span class="line">        <span class="comment"># &#x27;ENGINE&#x27;: &#x27;django.db.backends.sqlite3&#x27;,</span></span><br><span class="line">        <span class="comment"># &#x27;NAME&#x27;: os.path.join(BASE_DIR, &#x27;db.sqlite3&#x27;),</span></span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>:<span class="string">&#x27;django.db.backends.mysql&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>:<span class="string">&#x27;day64&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;USER&#x27;</span>:<span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PASSWORD&#x27;</span>:<span class="string">&#x27;dingding&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;HOST&#x27;</span>:<span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PORT&#x27;</span>:<span class="number">3306</span>,</span><br><span class="line">        <span class="string">&#x27;CHARSET&#x27;</span>:<span class="string">&#x27;utf8&#x27;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">#    这里还可以设置mysql的严格模式，如下：</span></span><br><span class="line">   <span class="comment">#      &#x27;OPTIONS&#x27;: &#123;</span></span><br><span class="line">   <span class="comment">#          &#x27;init_command&#x27;: &quot;SET sql_mode=&#x27;STRICT_TRANS_TABLES&#x27;&quot;,</span></span><br><span class="line">   <span class="comment">#          &#x27;charset&#x27;: &#x27;utf8mb4&#x27;,</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>init文件中做代码声明：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure>

<p>再到models.py文件创建一张表：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    age = models.IntegerField()</span><br><span class="line">    register_time = models.DateField()  <span class="comment"># 年月日格式</span></span><br><span class="line">    <span class="comment"># DateTimeField：年月日 时分秒格式</span></span><br><span class="line">    <span class="comment"># auto_now:每次操作数据的时候，该字段会自动将当前时间更新</span></span><br><span class="line">    <span class="comment"># auto_now_add:在创建数据的时候回自动将当前创建时间记录下来，如果之后不人为修改，那么该数据就会一直不变。例如我们记录用户的注册时间。</span></span><br><span class="line">    <span class="comment"># register_time1 = models.DateTimeField(auto_now=True,auto_now_add=True)</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;对象：%s&#x27;</span>%self.name           <span class="comment"># 如果不加这段函数，默认返回的数据对象是User object 形式，加上之后返回的数据对象是“对象：jack_sam”，方便我们看清楚数据</span></span><br></pre></td></tr></table></figure>

<p>然后同步到数据库中：<br>python3.8 <a href="https://link.zhihu.com/?target=http://manage.py/" rel="external nofollow noreferrer">manage.py</a> makemigrations<br>python3.8 <a href="https://link.zhihu.com/?target=http://manage.py/" rel="external nofollow noreferrer">manage.py</a> migrate</p>
<blockquote>
<p>测试脚本</p>
</blockquote>
<p>当只想测试Django中某一个py文件的内容，我们可以不用写前后端交互的形式，而是直接写一个测试脚本即可。</p>
<p>tests.py文件(应用下的tests.py或者自己新建的py文件都可以)：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    os.environ.setdefault(<span class="string">&quot;DJANGO_SETTINGS_MODULE&quot;</span>, <span class="string">&quot;day64.settings&quot;</span>)       <span class="comment"># 这是manage.py文件中拷贝的</span></span><br><span class="line">    <span class="keyword">import</span> django</span><br><span class="line">    django.setup()</span><br><span class="line">    <span class="comment"># 下面就可以测试Django里面的单个py文件了</span></span><br><span class="line">    <span class="keyword">from</span> app01 <span class="keyword">import</span> models       <span class="comment"># 所有代码必须要写在测试环境的后面，就是说要等环境准备完毕后才能书写</span></span><br><span class="line">    models.User.objects.all()</span><br></pre></td></tr></table></figure>

<h3 id="单表查询-增删改"><a href="#单表查询-增删改" class="headerlink" title="单表查询-增删改"></a>单表查询-增删改</h3><blockquote>
<p><strong>create方法返回值是对象</strong></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    os.environ.setdefault(<span class="string">&quot;DJANGO_SETTINGS_MODULE&quot;</span>, <span class="string">&quot;day64.settings&quot;</span>)</span><br><span class="line">    <span class="keyword">import</span> django</span><br><span class="line">    django.setup()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line">    models.User.objects.all()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 增</span></span><br><span class="line">     <span class="comment"># 方式1：</span></span><br><span class="line">     models.User.objects.create(name=<span class="string">&#x27;nimo&#x27;</span>,age=<span class="number">18</span>,register_time=<span class="string">&#x27;2020-01-12&#x27;</span>)</span><br><span class="line">     res = models.User.objects.create(name=<span class="string">&#x27;jack&#x27;</span>,age=<span class="number">19</span>,register_time=<span class="string">&#x27;2019-01-13&#x27;</span>)</span><br><span class="line">     print(res)</span><br><span class="line">     <span class="comment"># 对象：这个返回值就是当前被创建对象本身。</span></span><br><span class="line">     <span class="comment"># 方式2：</span></span><br><span class="line">      <span class="keyword">import</span> datetime</span><br><span class="line">      ctime = datetime.datetime.now()</span><br><span class="line">      user_obj = models.User(name=<span class="string">&#x27;ross&#x27;</span>,age=<span class="number">20</span>,register_time=ctime)</span><br><span class="line">      user_obj.save()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 删</span></span><br><span class="line">      <span class="comment"># 方式1:</span></span><br><span class="line">      res = models.User.objects.filter(id=<span class="number">2</span>).delete()</span><br><span class="line">      建议写pk，pk会自动查找当前表的主键字段，指代的就是当前表的主键字段，用了pk之后，我们不需要知道当前表的主键字段名称也可进行删除操作。</span><br><span class="line">      res = models.User.objects.filter(pk=<span class="number">2</span>).delete()</span><br><span class="line">      print(res)  <span class="comment"># 返回的是删除操作所影响的行数</span></span><br><span class="line">      (<span class="number">1</span>, &#123;<span class="string">&#x27;app01.User&#x27;</span>: <span class="number">1</span>&#125;)</span><br><span class="line">      <span class="comment"># 方式2：</span></span><br><span class="line">      user_obj1 = models.User.objects.filter(pk=<span class="number">8</span>).first()</span><br><span class="line">      user_obj1.delete()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 改</span></span><br><span class="line">    <span class="comment"># 方式1：</span></span><br><span class="line">    models.User.objects.filter(pk=<span class="number">4</span>).update(name=<span class="string">&#x27;nimoding&#x27;</span>)</span><br><span class="line">    <span class="comment"># 方式2：</span></span><br><span class="line">    user_obj2 = models.User.objects.get(pk=<span class="number">5</span>)</span><br><span class="line">    print(user_obj2)</span><br><span class="line">    <span class="comment"># 对象：jack_sam,get拿到的直接就是这个数据对象，就不需要用filter(pk=5).first()了。</span></span><br><span class="line">    <span class="comment"># 但是该方法不推荐使用，因为如果数据不存在，数据会直接报错；filter则不会报错</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># user_obj2 = models.User.objects.filter(pk=5).first()</span></span><br><span class="line">    <span class="comment"># user_obj2.name = &#x27;jack_sam&#x27;</span></span><br><span class="line">    <span class="comment"># user_obj2.save()</span></span><br></pre></td></tr></table></figure>

<h1 id="2、常见的查询方法-必知必会13条"><a href="#2、常见的查询方法-必知必会13条" class="headerlink" title="2、常见的查询方法(必知必会13条)"></a>2、常见的查询方法(必知必会13条)</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    os.environ.setdefault(<span class="string">&quot;DJANGO_SETTINGS_MODULE&quot;</span>, <span class="string">&quot;day64.settings&quot;</span>)</span><br><span class="line">    <span class="keyword">import</span> django</span><br><span class="line">    django.setup()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line">    models.User.objects.all()</span><br><span class="line">    <span class="comment"># 1、all() 查询所有数据</span></span><br><span class="line">    <span class="comment"># 2、filter() 过滤查询</span></span><br><span class="line">    <span class="comment"># 3、get() 直接拿到数据对象，但是条件不存在会直接报错</span></span><br><span class="line">    <span class="comment"># 4、first() 拿到queryset里面第一个元素</span></span><br><span class="line">    res = models.User.objects.all().first()</span><br><span class="line">    print(res.name)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5、last()  拿到queryset里面最后一个元素</span></span><br><span class="line">    res = models.User.objects.all().last()</span><br><span class="line">    print(res.name)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 6、values() 列表中嵌套字典 值字典   ---- 返回值不是数据对象</span></span><br><span class="line">    <span class="comment"># 只取User表中name字段和age字段</span></span><br><span class="line">    res = models.User.objects.values(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;age&#x27;</span>)</span><br><span class="line">    print(res)</span><br><span class="line">    <span class="comment"># 返回结果可以看成是列表中嵌套字典</span></span><br><span class="line">    <span class="comment"># &lt;QuerySet [&#123;&#x27;name&#x27;: &#x27;jack&#x27;, &#x27;age&#x27;: 19&#125;, &#123;&#x27;name&#x27;: &#x27;nimoding&#x27;, &#x27;age&#x27;: 18&#125;, &#123;&#x27;name&#x27;: &#x27;jack_sam&#x27;, &#x27;age&#x27;: 19&#125;, &#123;&#x27;name&#x27;: &#x27;ross&#x27;, &#x27;age&#x27;: 20&#125;, &#123;&#x27;name&#x27;: &#x27;ross&#x27;, &#x27;age&#x27;: 20&#125;, &#123;&#x27;name&#x27;: &#x27;ross&#x27;, &#x27;age&#x27;: 20&#125;, &#123;&#x27;name&#x27;: &#x27;ross&#x27;, &#x27;age&#x27;: 20&#125;, &#123;&#x27;name&#x27;: &#x27;ross&#x27;, &#x27;age&#x27;: 20&#125;, &#123;&#x27;name&#x27;: &#x27;ross&#x27;, &#x27;age&#x27;: 20&#125;, &#123;&#x27;name&#x27;: &#x27;ross&#x27;, &#x27;age&#x27;: 20&#125;, &#123;&#x27;name&#x27;: &#x27;ross&#x27;, &#x27;age&#x27;: 20&#125;]&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 7、values_list() 列表嵌套元组 值元祖   ---- 返回值不是数据对象 ---- 用在choice比较多</span></span><br><span class="line">    res = models.User.objects.values_list(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;age&#x27;</span>)</span><br><span class="line">    print(res)</span><br><span class="line">    <span class="comment"># 返回的结果可以看成是列表嵌套元组</span></span><br><span class="line">    <span class="comment"># &lt;QuerySet [(&#x27;jack&#x27;, 19), (&#x27;nimoding&#x27;, 18), (&#x27;jack_sam&#x27;, 19), (&#x27;ross&#x27;, 20), (&#x27;ross&#x27;, 20), (&#x27;ross&#x27;, 20), (&#x27;ross&#x27;, 20), (&#x27;ross&#x27;, 20), (&#x27;ross&#x27;, 20), (&#x27;ross&#x27;, 20), (&#x27;ross&#x27;, 20)]&gt;</span></span><br><span class="line">    print(res.query)  <span class="comment"># 查看内部封装的SQL语句</span></span><br><span class="line">    <span class="comment"># SELECT `app01_user`.`name`, `app01_user`.`age` FROM `app01_user`</span></span><br><span class="line">    <span class="comment"># 这种查看SQL语句的方式只适用于queryset对象，只有queryset对象才能够点query查看内部SQL语句</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 8、distinct() 去重</span></span><br><span class="line">    res = models.User.objects.all()</span><br><span class="line">    print(res)</span><br><span class="line">    <span class="comment"># &lt;QuerySet [&lt;User: 对象：jack&gt;, &lt;User: 对象：nimoding&gt;, &lt;User: 对象：jack_sam&gt;, &lt;User: 对象：ross&gt;, &lt;User: 对象：ross&gt;, &lt;User: 对象：ross&gt;, &lt;User: 对象：ross&gt;, &lt;User: 对象：ross&gt;, &lt;User: 对象：ross&gt;, &lt;User: 对象：ross&gt;, &lt;User: 对象：ross&gt;, &lt;User: 对象：nimo&gt;, &lt;User: 对象：jack&gt;]&gt;</span></span><br><span class="line"></span><br><span class="line">    res = models.User.objects.values(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;age&#x27;</span>).distinct()   <span class="comment"># 去重不要带主键</span></span><br><span class="line">    print(res)</span><br><span class="line">    <span class="comment"># &lt;QuerySet [&#123;&#x27;name&#x27;: &#x27;jack&#x27;, &#x27;age&#x27;: 19&#125;, &#123;&#x27;name&#x27;: &#x27;nimoding&#x27;, &#x27;age&#x27;: 18&#125;, &#123;&#x27;name&#x27;: &#x27;jack_sam&#x27;, &#x27;age&#x27;: 19&#125;, &#123;&#x27;name&#x27;: &#x27;ross&#x27;, &#x27;age&#x27;: 20&#125;, &#123;&#x27;name&#x27;: &#x27;nimo&#x27;, &#x27;age&#x27;: 18&#125;]&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 9、order_by()</span></span><br><span class="line">    res = models.User.objects.order_by(<span class="string">&#x27;age&#x27;</span>) <span class="comment"># 默认升序</span></span><br><span class="line">    res1 = models.User.objects.order_by(<span class="string">&#x27;-age&#x27;</span>) <span class="comment"># 加一个减号就是降序了</span></span><br><span class="line">    print(res)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 10、reverse()  # 反转的前提是数据已经排序了</span></span><br><span class="line">    res = models.User.objects.all()</span><br><span class="line">    res1 = models.User.objects.order_by(<span class="string">&#x27;age&#x27;</span>).reverse()</span><br><span class="line">    print(res)</span><br><span class="line">    print(res1)</span><br><span class="line">    <span class="comment"># &lt;QuerySet [&lt;User: 对象：jack&gt;, &lt;User: 对象：nimoding&gt;, &lt;User: 对象：jack_sam&gt;, &lt;User: 对象：ross&gt;, &lt;User: 对象：ross&gt;, &lt;User: 对象：ross&gt;, &lt;User: 对象：ross&gt;, &lt;User: 对象：ross&gt;, &lt;User: 对象：ross&gt;, &lt;User: 对象：ross&gt;, &lt;User: 对象：ross&gt;, &lt;User: 对象：nimo&gt;, &lt;User: 对象：jack&gt;]&gt;</span></span><br><span class="line">    <span class="comment"># &lt;QuerySet [&lt;User: 对象：ross&gt;, &lt;User: 对象：ross&gt;, &lt;User: 对象：ross&gt;, &lt;User: 对象：ross&gt;, &lt;User: 对象：ross&gt;, &lt;User: 对象：ross&gt;, &lt;User: 对象：ross&gt;, &lt;User: 对象：ross&gt;, &lt;User: 对象：jack&gt;, &lt;User: 对象：jack_sam&gt;, &lt;User: 对象：jack&gt;, &lt;User: 对象：nimoding&gt;, &lt;User: 对象：nimo&gt;]&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 11、count()</span></span><br><span class="line">    res = models.User.objects.count()  <span class="comment"># 当前数据行数</span></span><br><span class="line">    print(res)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 12、exclude()</span></span><br><span class="line">    res = models.User.objects.exclude(name=<span class="string">&#x27;ross&#x27;</span>)  <span class="comment"># 排除符合条件的数据</span></span><br><span class="line">    print(res)</span><br><span class="line">    <span class="comment"># &lt;QuerySet [&lt;User: 对象：jack&gt;, &lt;User: 对象：nimoding&gt;, &lt;User: 对象：jack_sam&gt;, &lt;User: 对象：nimo&gt;, &lt;User: 对象：jack&gt;]&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 13、exists()  # 基本用不到，因为数据本身就自带布尔值</span></span><br><span class="line">    res = models.User.objects.filter(pk=<span class="number">4</span>).exists()   <span class="comment"># 判断是否存在，返回布尔值</span></span><br><span class="line">    print(res)</span><br></pre></td></tr></table></figure>

<h3 id="2-1-相关截图："><a href="#2-1-相关截图：" class="headerlink" title="2.1.相关截图："></a>2.1.相关截图：</h3><p><strong>&lt;1&gt; all(): 查询所有结果</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/Waylonwhynot/whatyouneed_blog_pic@main/pic/1342004-20180620150444179-1547126914.png" alt="img"></p>
<p><strong>&lt;2&gt; filter(\</strong>kwargs): 它包含了与所给筛选条件相匹配的对象**</p>
<p><img src="https://cdn.jsdelivr.net/gh/Waylonwhynot/whatyouneed_blog_pic@main/pic/1342004-20180620150651361-592927926.png" alt="img"></p>
<p><strong>&lt;3&gt; get(\</strong>kwargs): 返回与所给筛选条件相匹配的对象，返回结果有且只有一个，如果符合筛选条件的对象超过一个或者没有都会抛出错误。**</p>
<p><img src="https://cdn.jsdelivr.net/gh/Waylonwhynot/whatyouneed_blog_pic@main/pic/1342004-20180620150839363-1744654160.png" alt="img"></p>
<p><strong>&lt;4&gt; exclude(\</strong>kwargs): 它包含了与所给筛选条件不匹配的对象**</p>
<p><img src="https://cdn.jsdelivr.net/gh/Waylonwhynot/whatyouneed_blog_pic@main/pic/1342004-20180620151130718-29597851.png" alt="img"></p>
<p><strong>&lt;5&gt; values(*field): 返回一个ValueQuerySet——一个特殊的QuerySet，运行后得到的并不是一系列model的实例化对象，而是一个可迭代的字典序列</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/Waylonwhynot/whatyouneed_blog_pic@main/pic/1342004-20180620151319973-577855569.png" alt="img"></p>
<p><strong>&lt;6&gt; values_list(*field): 它与values()非常相似，它返回的是一个元组序列，values返回的是一个字典序列</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/Waylonwhynot/whatyouneed_blog_pic@main/pic/1342004-20180620151410181-1703038947.png" alt="img"></p>
<p><strong>&lt;7&gt; order_by(*field): 对查询结果排序</strong></p>
<p><strong>&lt;8&gt; reverse(): 对查询结果反向排序，请注意reverse()通常只能在具有已定义顺序的QuerySet上调用(在model类的Meta中指定ordering或调用order_by()方法)。</strong></p>
<p><strong>&lt;9&gt; distinct(): 从返回结果中剔除重复纪录(如果你查询跨越多个表，可能在计算QuerySet时得到重复的结果。此时可以使用distinct()，注意只有在PostgreSQL中支持按字段去重。)</strong></p>
<p><strong>&lt;10&gt; count(): 返回数据库中匹配查询(QuerySet)的对象数量。</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/Waylonwhynot/whatyouneed_blog_pic@main/pic/1342004-20180620151740220-356341461.png" alt="img"></p>
<p><strong>&lt;11&gt; first(): 返回第一条记录</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/Waylonwhynot/whatyouneed_blog_pic@main/pic/1342004-20180620151857709-1858002534.png" alt="img"></p>
<p><strong>&lt;12&gt; last(): 返回最后一条记录</strong></p>
<p><strong>&lt;13&gt; exists(): 如果QuerySet包含数据，就返回True，否则返回False</strong></p>
<h1 id="3、-增删改和13个必会查询操作总结："><a href="#3、-增删改和13个必会查询操作总结：" class="headerlink" title="3、 增删改和13个必会查询操作总结："></a>3、 增删改和13个必会查询操作总结：</h1><h4 id="Create返回值是被创建对象本身"><a href="#Create返回值是被创建对象本身" class="headerlink" title="Create返回值是被创建对象本身"></a>Create返回值是被创建对象本身</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 方式1：</span><br><span class="line">     models.User.objects.create(name&#x3D;&#39;nimo&#39;,age&#x3D;18,register_time&#x3D;&#39;2020-01-12&#39;)</span><br><span class="line">     res &#x3D; models.User.objects.create(name&#x3D;&#39;jack&#39;,age&#x3D;19,register_time&#x3D;&#39;2019-01-13&#39;)</span><br><span class="line">     print(res)</span><br><span class="line">     # 对象：这个返回值就是当前被创建对象本身。</span><br></pre></td></tr></table></figure>

<h4 id="delete返回值是操作影响的行数"><a href="#delete返回值是操作影响的行数" class="headerlink" title="delete返回值是操作影响的行数"></a>delete返回值是操作影响的行数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 删</span><br><span class="line">      # 方式1:</span><br><span class="line">      res &#x3D; models.User.objects.filter(id&#x3D;2).delete()</span><br><span class="line">      建议写pk，pk会自动查找当前表的主键字段，指代的就是当前表的主键字段，用了pk之后，我们不需要知道当前表的主键字段名称也可进行删除操作。</span><br><span class="line">      res &#x3D; models.User.objects.filter(pk&#x3D;2).delete()</span><br><span class="line">      print(res)  # 返回的是删除操作所影响的行数</span><br><span class="line">      (1, &#123;&#39;app01.User&#39;: 1&#125;)</span><br><span class="line">      # 方式2：</span><br><span class="line">      user_obj1 &#x3D; models.User.objects.filter(pk&#x3D;8).first()</span><br><span class="line">      user_obj1.delete()</span><br></pre></td></tr></table></figure>

<h4 id="update返回值为1"><a href="#update返回值为1" class="headerlink" title="update返回值为1"></a>update返回值为1</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 改</span><br><span class="line">    # 方式1：</span><br><span class="line">    models.User.objects.filter(pk&#x3D;4).update(name&#x3D;&#39;nimoding&#39;)</span><br></pre></td></tr></table></figure>

<h4 id="返回QuerySet对象的方法有"><a href="#返回QuerySet对象的方法有" class="headerlink" title="返回QuerySet对象的方法有"></a><strong>返回QuerySet对象的方法有</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">all()</span><br><span class="line"></span><br><span class="line">filter()</span><br><span class="line"></span><br><span class="line">exclude()</span><br><span class="line"></span><br><span class="line">order_by()</span><br><span class="line"></span><br><span class="line">reverse()</span><br><span class="line"></span><br><span class="line">distinct()</span><br></pre></td></tr></table></figure>

<h4 id="特殊的QuerySet"><a href="#特殊的QuerySet" class="headerlink" title="特殊的QuerySet"></a>特殊的QuerySet</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">values()       返回一个可迭代的字典序列</span><br><span class="line"></span><br><span class="line">values_list() 返回一个可迭代的元祖序列</span><br></pre></td></tr></table></figure>

<h4 id="返回具体对象的"><a href="#返回具体对象的" class="headerlink" title="返回具体对象的"></a><strong>返回具体对象的</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">get()</span><br><span class="line"></span><br><span class="line">first()</span><br><span class="line"></span><br><span class="line">last()</span><br></pre></td></tr></table></figure>

<h4 id="返回布尔值的方法有："><a href="#返回布尔值的方法有：" class="headerlink" title="返回布尔值的方法有："></a><strong>返回布尔值的方法有：</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exists()</span><br></pre></td></tr></table></figure>

<h4 id="返回数字的方法有"><a href="#返回数字的方法有" class="headerlink" title="返回数字的方法有"></a><strong>返回数字的方法有</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">count()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>查看ORM内部SQL语句的方式</p>
</blockquote>
<p>方式1：<br>print(res.query) # 只有queryset对象才能够点query查看内部封装的SQL语句</p>
<p><img src="https://pic2.zhimg.com/80/v2-220e7a8689db6d878c8545aa3cfdff09_1440w.jpg" alt="img"></p>
<p>方式2：<br>去配置文件中配置，将如下代码添加到settings.py文件中：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">LOGGING = &#123;</span><br><span class="line">    <span class="string">&#x27;version&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&#x27;disable_existing_loggers&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">    <span class="string">&#x27;handlers&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;console&#x27;</span>:&#123;</span><br><span class="line">            <span class="string">&#x27;level&#x27;</span>:<span class="string">&#x27;DEBUG&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;class&#x27;</span>:<span class="string">&#x27;logging.StreamHandler&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;loggers&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;django.db.backends&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;handlers&#x27;</span>: [<span class="string">&#x27;console&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;propagate&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">            <span class="string">&#x27;level&#x27;</span>:<span class="string">&#x27;DEBUG&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://pic1.zhimg.com/80/v2-663135a506fd109e95eface33ae25774_1440w.jpg" alt="img"></p>
<p>红色部分就是我们运行tests.py文件后自动显示出来的。能看到每段代码背后的SQL语句。</p>
<h1 id="3、神奇的双下划线查询-filter中使用，范围模糊查询"><a href="#3、神奇的双下划线查询-filter中使用，范围模糊查询" class="headerlink" title="3、神奇的双下划线查询(filter中使用，范围模糊查询)"></a>3、神奇的双下划线查询(filter中使用，范围模糊查询)</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    os.environ.setdefault(<span class="string">&quot;DJANGO_SETTINGS_MODULE&quot;</span>, <span class="string">&quot;day64.settings&quot;</span>)</span><br><span class="line">    <span class="keyword">import</span> django</span><br><span class="line">    django.setup()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line">    models.User.objects.all()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 年龄大于35岁数据</span></span><br><span class="line">    res = models.User.objects.filter(age__gt=<span class="number">35</span>)  <span class="comment"># 大于</span></span><br><span class="line">    res1 = models.User.objects.filter(age__gte=<span class="number">35</span>) <span class="comment"># 大于等于</span></span><br><span class="line">    res2 = models.User.objects.filter(age__lt=<span class="number">35</span>)  <span class="comment"># 小于</span></span><br><span class="line">    res3 = models.User.objects.filter(age__lte=<span class="number">35</span>) <span class="comment"># 小于等于</span></span><br><span class="line">    print(res)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 年龄是18或40或32</span></span><br><span class="line">    res = models.User.objects.filter(age__in=[<span class="number">18</span>,<span class="number">32</span>,<span class="number">40</span>])</span><br><span class="line">    print(res)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 年龄在18-50之间(首尾都包含了)</span></span><br><span class="line">    res = models.User.objects.filter(age__range=[<span class="number">18</span>,<span class="number">50</span>])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查询出名字里含有n的数据(默认区分大小写) 模糊查询</span></span><br><span class="line">    res =models.User.objects.filter(name__contains=<span class="string">&#x27;n&#x27;</span>)</span><br><span class="line">    print(res)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查询出名字里含有n的数据(忽略大小写)</span></span><br><span class="line">    res = models.User.objects.filter(name__icontains=<span class="string">&#x27;n&#x27;</span>)</span><br><span class="line">    print(res)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 名字以什么开头什么结尾</span></span><br><span class="line">    res = models.User.objects.filter(name__startswith=<span class="string">&#x27;s&#x27;</span>)</span><br><span class="line">    res1 = models.User.objects.filter(name__endswith=<span class="string">&#x27;s&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查询出注册时间是1月的数据</span></span><br><span class="line">    res =models.User.objects.filter(register_time__month=<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    res =models.User.objects.filter(register_time__year =<span class="string">&#x27;2020&#x27;</span>) <span class="comment"># 按年份</span></span><br></pre></td></tr></table></figure>

<h1 id="4、多表操作-创建表"><a href="#4、多表操作-创建表" class="headerlink" title="4、多表操作-创建表"></a>4、多表操作-创建表</h1><p>models.py文件中创建表：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    price = models.DecimalField(max_digits=<span class="number">8</span>,decimal_places=<span class="number">2</span>)</span><br><span class="line">    publish_date = models.DateField(auto_now_add=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># 书籍与出版社一对多的关系：</span></span><br><span class="line">    publish = models.ForeignKey(to=<span class="string">&#x27;Publish&#x27;</span>)</span><br><span class="line">    <span class="comment"># 书籍与作者多对多关系：</span></span><br><span class="line">    authors = models.ManyToManyField(to=<span class="string">&#x27;Author&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Publish</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    addr = models.CharField(max_length=<span class="number">64</span>)</span><br><span class="line">    email = models.EmailField() <span class="comment"># 本质是varchar(254)类型，但是校验性组件中EmailField只能存邮箱类型</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    age = models.IntegerField()</span><br><span class="line">    <span class="comment"># 一对一关系</span></span><br><span class="line">    author_detail = models.OneToOneField(to=<span class="string">&#x27;AuthorDetail&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AuthorDetail</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    phone = models.BigIntegerField() <span class="comment"># 电话号码用IntegerField不够，要用BigIntegerField或者CharField</span></span><br><span class="line">    addr = models.CharField(max_length=<span class="number">64</span>)</span><br></pre></td></tr></table></figure>

<p><strong>同步到数据库：</strong><br>python3.8 <a href="https://link.zhihu.com/?target=http://manage.py/" rel="external nofollow noreferrer">manage.py</a> makemigrations<br>python3.8 <a href="https://link.zhihu.com/?target=http://manage.py/" rel="external nofollow noreferrer">manage.py</a> migrate</p>
<h1 id="5、外键字段的增删改查"><a href="#5、外键字段的增删改查" class="headerlink" title="5、外键字段的增删改查"></a>5、外键字段的增删改查</h1><p><a href="https://link.zhihu.com/?target=https://www.bilibili.com/video/BV1qC4y1s71m?p=785" rel="external nofollow noreferrer">外键的增删改查www.bilibili.com<img src="https://pic2.zhimg.com/v2-e6cdf00518a61ad1b907ca86ddfe4439_180x120.jpg" alt="图标"></a></p>
<h2 id="一对多外键增删改查-直接id或者对象"><a href="#一对多外键增删改查-直接id或者对象" class="headerlink" title="一对多外键增删改查(直接id或者对象)"></a>一对多外键增删改查(直接id或者对象)</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    os.environ.setdefault(<span class="string">&quot;DJANGO_SETTINGS_MODULE&quot;</span>, <span class="string">&quot;day64.settings&quot;</span>)</span><br><span class="line">    <span class="keyword">import</span> django</span><br><span class="line">    django.setup()</span><br><span class="line">    <span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line">    models.User.objects.all()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 一对多外键增删改查</span></span><br><span class="line">    <span class="comment"># 增</span></span><br><span class="line">    <span class="comment"># 方式1：直接写实际字段,写id值</span></span><br><span class="line">      models.Book.objects.create(title=<span class="string">&#x27;三国演义&#x27;</span>,price=<span class="number">123.123</span>,publish_id=<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># 方式2：写虚拟字段,传对象</span></span><br><span class="line">      publish_obj = models.Publish.objects.filter(pk=<span class="number">2</span>).first()</span><br><span class="line">      models.Book.objects.create(title=<span class="string">&#x27;红楼梦&#x27;</span>,price=<span class="number">223.123</span>,publish=publish_obj)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 删</span></span><br><span class="line">      models.Book.objects.filter(pk=<span class="number">2</span>).delete()  <span class="comment"># 级联删除</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 改</span></span><br><span class="line">      models.Book.objects.filter(pk=<span class="number">1</span>).update(publish_id=<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">      publish_obj = models.Publish.objects.filter(pk=<span class="number">1</span>).first()</span><br><span class="line">      models.Book.objects.filter(pk=<span class="number">1</span>).update(publish = publish_obj)</span><br></pre></td></tr></table></figure>

<h2 id="多对多外键增删改查"><a href="#多对多外键增删改查" class="headerlink" title="多对多外键增删改查"></a>多对多外键增删改查</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    os.environ.setdefault(<span class="string">&quot;DJANGO_SETTINGS_MODULE&quot;</span>, <span class="string">&quot;day64.settings&quot;</span>)</span><br><span class="line">    <span class="keyword">import</span> django</span><br><span class="line">    django.setup()</span><br><span class="line">    <span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line">    models.User.objects.all()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 多对多外键增删改查(就是在操作第三张表)</span></span><br><span class="line">    <span class="comment"># 增</span></span><br><span class="line">    <span class="comment"># 如何给书籍添加作者？书籍和作者是多对多关系</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># add：给第三张关系表添加数据，括号内既可以传数字也可以传对象，都支持多个。</span></span><br><span class="line">    <span class="comment"># 方式1：</span></span><br><span class="line">    book_obj = models.Book.objects.filter(pk=<span class="number">1</span>).first()</span><br><span class="line">    <span class="comment"># print(book_obj.authors)  # .authors就相当于你已经到了第三张关系表了</span></span><br><span class="line">    <span class="comment"># app01.Author.None</span></span><br><span class="line">    book_obj.authors.add(<span class="number">1</span>)    <span class="comment"># 去第三张表中添加一个关系：给书籍id=1的书籍绑定一个主键=1的作者</span></span><br><span class="line">    book_obj.authors.add(<span class="number">2</span>,<span class="number">3</span>)  <span class="comment"># 给书籍id=1的书籍绑定一个主键=2和主键=3的作者</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 方式2：</span></span><br><span class="line">    book_obj = models.Book.objects.filter(pk=<span class="number">3</span>).first()</span><br><span class="line">    author_obj = models.Author.objects.filter(pk=<span class="number">1</span>).first()</span><br><span class="line">    author_obj1 = models.Author.objects.filter(pk=<span class="number">2</span>).first()</span><br><span class="line">    author_obj2 = models.Author.objects.filter(pk=<span class="number">3</span>).first()</span><br><span class="line">    book_obj.authors.add(author_obj)</span><br><span class="line">    book_obj.authors.add(author_obj1,author_obj2)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 删</span></span><br><span class="line">    <span class="comment"># 删除书籍id=3作者id=2的数据</span></span><br><span class="line">    <span class="comment"># 获取书籍id=3</span></span><br><span class="line">    book_obj = models.Book.objects.filter(pk=<span class="number">3</span>).first()</span><br><span class="line">    book_obj.authors.remove(<span class="number">2</span>) <span class="comment"># 支持传多个</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 获取作者id=1</span></span><br><span class="line">    author_obj = models.Author.objects.filter(pk=<span class="number">1</span>).first()</span><br><span class="line">    author_obj1 = models.Author.objects.filter(pk=<span class="number">2</span>).first()</span><br><span class="line">    book_obj.authors.remove(author_obj,author_obj1) <span class="comment"># 支持传对象</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 改(先删除后新增)</span></span><br><span class="line">    <span class="comment"># 方式1：</span></span><br><span class="line">    <span class="comment"># 针对book的id=3的数据进行修改</span></span><br><span class="line">    book_obj = models.Book.objects.filter(pk=<span class="number">3</span>).first()</span><br><span class="line">    <span class="comment"># 书籍id=3的数据中将作者id改成2和3</span></span><br><span class="line">    book_obj.authors.set([<span class="number">2</span>,<span class="number">3</span>])   <span class="comment"># 括号内必须放一个可迭代对象</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 方式2：放对象</span></span><br><span class="line">    <span class="comment"># 书籍id=3的数据中将作者id改成1</span></span><br><span class="line">    author_obj = models.Author.objects.filter(pk=<span class="number">1</span>).first()</span><br><span class="line">    book_obj.authors.set([author_obj])</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 清空</span></span><br><span class="line">    <span class="comment"># 假如一本书下架了，我们将这本书和作者的绑定关系清空</span></span><br><span class="line">    <span class="comment"># 清空书籍id=3与其他作者的关系</span></span><br><span class="line">    book_obj = models.Book.objects.filter(pk=<span class="number">3</span>).first()</span><br><span class="line">    book_obj.authors.clear()</span><br><span class="line">    <span class="comment"># clear括号内不要任何参数</span></span><br></pre></td></tr></table></figure>

<h1 id="6、正反向概念"><a href="#6、正反向概念" class="headerlink" title="6、正反向概念"></a>6、正反向概念</h1><p>Book书籍表(外键字段在书籍表) —– Publish出版社表<br>从书籍查找出版社就是正向查找<br>从出版社查找书籍就是反向查找</p>
<p><strong>正向查询按字段</strong><br><strong>反向查询按表名小写(看情况加_set后缀或者.all()后缀)</strong></p>
<h1 id="7、多表查询"><a href="#7、多表查询" class="headerlink" title="7、多表查询"></a>7、多表查询</h1><blockquote>
<p><strong>子查询(基于对象的跨表查询)</strong></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、查询书籍主键=1的出版社名称</span></span><br><span class="line">book_obj = models.Book.objects.filter(pk=<span class="number">1</span>).first()</span><br><span class="line"><span class="comment"># 拿到书籍信息后，从书籍查出版社是属于正向查询，所以要按字段查询</span></span><br><span class="line">res = book_obj.publish</span><br><span class="line">print(res.name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、查询书籍主键=1的作者</span></span><br><span class="line">book_obj = models.Book.objects.filter(pk=<span class="number">1</span>).first()</span><br><span class="line"><span class="comment"># 从书籍查作者，外键在书籍表中，所以要按字段查询</span></span><br><span class="line"><span class="comment"># res = book_obj.authors</span></span><br><span class="line"><span class="comment"># print(res)</span></span><br><span class="line"><span class="comment"># app01.Author.None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 后面要加.all(),拿到的就是QuerySet对象</span></span><br><span class="line">res = book_obj.authors.all()</span><br><span class="line">print(res)</span><br><span class="line"><span class="comment"># &lt;QuerySet [&lt;Author: Author object&gt;, &lt;Author: Author object&gt;, &lt;Author: Author object&gt;]&gt;</span></span><br><span class="line"></span><br><span class="line">res = book_obj.authors.values(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">print(res)</span><br><span class="line"><span class="comment"># &lt;QuerySet [&#123;&#x27;name&#x27;: &#x27;tank&#x27;&#125;, &#123;&#x27;name&#x27;: &#x27;jack&#x27;&#125;, &#123;&#x27;name&#x27;: &#x27;ross&#x27;&#125;]&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、查询作者jack的电话号码</span></span><br><span class="line">author_obj = models.Author.objects.filter(name=<span class="string">&#x27;jack&#x27;</span>).first()</span><br><span class="line"><span class="comment"># 从作者表查询作者详情表，外键在作者表中，所以是正向查询,按字段查找</span></span><br><span class="line">res = author_obj.author_detail</span><br><span class="line">print(res.phone)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 什么时候需要加.all()</span></span><br><span class="line"><span class="comment"># 当你的结果可能有多个时就需要加.all()，如果结果是一个，则直接拿到数据对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4、查询出版社是东方出版社出版的书</span></span><br><span class="line"><span class="comment"># 从出版社表查找书籍表，外键字段在书籍表中，所以属于反向查询，按表名小写查找</span></span><br><span class="line">publish_obj = models.Publish.objects.filter(name=<span class="string">&#x27;东方出版社&#x27;</span>).first()</span><br><span class="line">res = publish_obj.book_set.all()</span><br><span class="line">print(res)</span><br><span class="line"><span class="comment"># 拿到了6本书</span></span><br><span class="line"><span class="comment"># &lt;QuerySet [&lt;Book: Book object&gt;, &lt;Book: Book object&gt;, &lt;Book: Book object&gt;, &lt;Book: Book object&gt;, &lt;Book: Book object&gt;, &lt;Book: Book object&gt;]&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5、查询作者是jack的书籍</span></span><br><span class="line">author_obj = models.Author.objects.filter(name=<span class="string">&#x27;jack&#x27;</span>).first()</span><br><span class="line"><span class="comment"># 通过作者查询书籍是反向</span></span><br><span class="line">res = author_obj.book_set.all()</span><br><span class="line">print(res)</span><br><span class="line"><span class="comment"># &lt;QuerySet [&lt;Book: Book object&gt;]&gt;</span></span><br><span class="line">print(res.values())</span><br><span class="line"><span class="comment"># &lt;QuerySet [&#123;&#x27;id&#x27;: 1, &#x27;title&#x27;: &#x27;三国演义&#x27;, &#x27;price&#x27;: Decimal(&#x27;123.12&#x27;), &#x27;publish_date&#x27;: datetime.date(2020, 8, 20), &#x27;publish_id&#x27;: 2&#125;]&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 6、查询手机号是1373900888的作者姓名</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">author_detail_obj = models.AuthorDetail.objects.filter(phone=<span class="number">1373900888</span>).first()</span><br><span class="line">res = author_detail_obj.author</span><br><span class="line">print(res.name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当你的查询结果可以有多个时，就必须加_set.all()，当你的结果只有一个时，不需要加_set.all()</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>联表查询(基于双下划线的跨表查询)</strong></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    os.environ.setdefault(<span class="string">&quot;DJANGO_SETTINGS_MODULE&quot;</span>, <span class="string">&quot;day64.settings&quot;</span>)</span><br><span class="line">    <span class="keyword">import</span> django</span><br><span class="line">    django.setup()</span><br><span class="line">    <span class="keyword">from</span> app01 <span class="keyword">import</span> models</span><br><span class="line">    models.User.objects.all()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1、查询jack的手机号(一行代码搞定)</span></span><br><span class="line">    res = models.Author.objects.filter(name=<span class="string">&#x27;jack&#x27;</span>).values(<span class="string">&#x27;author_detail__phone&#x27;</span>)</span><br><span class="line">    print(res)</span><br><span class="line">    <span class="comment"># &lt;QuerySet [&#123;&#x27;author_detail__phone&#x27;: 13212128888&#125;]&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 反向查询，不用.Author</span></span><br><span class="line">    res = models.AuthorDetail.objects.filter(author__name=<span class="string">&#x27;jack&#x27;</span>).values(<span class="string">&#x27;phone&#x27;</span>)</span><br><span class="line">    print(res)</span><br><span class="line">    <span class="comment"># &lt;QuerySet [&#123;&#x27;phone&#x27;: 13212128888&#125;]&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2、查询书籍主键=1的出版社名称和书的名称</span></span><br><span class="line">    res = models.Book.objects.filter(pk=<span class="number">1</span>).values(<span class="string">&#x27;publish__name&#x27;</span>,<span class="string">&#x27;title&#x27;</span>)</span><br><span class="line">    print(res)</span><br><span class="line">    <span class="comment"># &lt; QuerySet[&#123;&#x27;publish__name&#x27;: &#x27;人民出版社&#x27;, &#x27;title&#x27;: &#x27;三国演义&#x27;&#125;] &gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 反向查询</span></span><br><span class="line">    res = models.Publish.objects.filter(book__id=<span class="number">1</span>).values(<span class="string">&#x27;book__title&#x27;</span>,<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    print(res)</span><br><span class="line">    <span class="comment"># &lt;QuerySet [&#123;&#x27;book__title&#x27;: &#x27;三国演义&#x27;, &#x27;name&#x27;: &#x27;人民出版社&#x27;&#125;]&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3、查询书籍主键为1的作者姓名</span></span><br><span class="line">    res = models.Book.objects.filter(pk=<span class="number">1</span>).values(<span class="string">&#x27;authors__name&#x27;</span>)</span><br><span class="line">    print(res)</span><br><span class="line">    <span class="comment"># &lt;QuerySet [&#123;&#x27;authors__name&#x27;: &#x27;tank&#x27;&#125;, &#123;&#x27;authors__name&#x27;: &#x27;jack&#x27;&#125;, &#123;&#x27;authors__name&#x27;: &#x27;ross&#x27;&#125;]&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 反向查询</span></span><br><span class="line">    res = models.Author.objects.filter(book__id=<span class="number">1</span>).values(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    print(res)</span><br><span class="line">    <span class="comment"># &lt;QuerySet [&#123;&#x27;name&#x27;: &#x27;tank&#x27;&#125;, &#123;&#x27;name&#x27;: &#x27;jack&#x27;&#125;, &#123;&#x27;name&#x27;: &#x27;ross&#x27;&#125;]&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 4、查询书籍主键=1的作者的手机号</span></span><br><span class="line">    res = models.Book.objects.filter(pk=<span class="number">1</span>).values(<span class="string">&#x27;authors__author_detail__phone&#x27;</span>)</span><br><span class="line">    print(res)</span><br><span class="line">    <span class="comment"># &lt;QuerySet [&#123;&#x27;authors__author_detail__phone&#x27;: 2312123&#125;, &#123;&#x27;authors__author_detail__phone&#x27;: 13212128888&#125;, &#123;&#x27;authors__author_detail__phone&#x27;: 13739008888&#125;]&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="8、聚合查询"><a href="#8、聚合查询" class="headerlink" title="8、聚合查询"></a>8、聚合查询</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 聚合查询(需要先导入)</span></span><br><span class="line"><span class="comment"># 只要是跟数据库相关的模块，基本上都在django.db.models里面，如果没有，应该在django.db里面</span></span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Min,Max,Sum,Count,Avg</span><br><span class="line"><span class="comment"># 聚合查询一般都是配合分组一起使用的</span></span><br><span class="line"><span class="comment"># 1、统计所有书的平均价格</span></span><br><span class="line">res = models.Book.objects.aggregate(Avg(<span class="string">&#x27;price&#x27;</span>))</span><br><span class="line">print(res)</span><br><span class="line"><span class="comment"># &#123;&#x27;price__avg&#x27;: 143.350769&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、五个聚合函数</span></span><br><span class="line">res = models.Book.objects.aggregate(Avg(<span class="string">&#x27;price&#x27;</span>),Max(<span class="string">&#x27;price&#x27;</span>),Min(<span class="string">&#x27;price&#x27;</span>),Count(<span class="string">&#x27;price&#x27;</span>),Sum(<span class="string">&#x27;price&#x27;</span>))</span><br><span class="line">print(res)</span><br><span class="line"><span class="comment"># &#123;&#x27;price__avg&#x27;: 143.350769, &#x27;price__max&#x27;: Decimal(&#x27;223.12&#x27;), &#x27;price__min&#x27;: Decimal(&#x27;23.12&#x27;), &#x27;price__count&#x27;: 13, &#x27;price__sum&#x27;: Decimal(&#x27;1863.56&#x27;)&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="9、分组查询"><a href="#9、分组查询" class="headerlink" title="9、分组查询"></a>9、分组查询</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">这里需要注意的是annotate分组依据就是他前面的值values，</span><br><span class="line">如果前面没有特点的字段，则默认按照ID分组，</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">关键字：annotate 和 values 连用 就是代表 group by 分组</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment"># 分组查询(annotate)</span></span><br><span class="line">   <span class="comment"># mysql分组查询特点：</span></span><br><span class="line">   <span class="comment"># 分组之后默认只能获取到分组的依据，组内其他字段都无法直接获取了。因为设置了严格模式，ONLY_FULL_GROUP_BY</span></span><br><span class="line"></span><br><span class="line">   <span class="keyword">from</span> django.db.models <span class="keyword">import</span> Min, Max, Sum, Count, Avg</span><br><span class="line">   <span class="comment"># 1、统计每一本书的作者个数</span></span><br><span class="line">   <span class="comment"># res = models.Book.objects.annotate()   # 默认按照models.后面的表来分组</span></span><br><span class="line">   <span class="comment"># res = models.Book.objects.annotate(author_num = Count(&#x27;authors__pk&#x27;))</span></span><br><span class="line">   res = models.Book.objects.annotate(author_num = Count(<span class="string">&#x27;authors&#x27;</span>)).values(<span class="string">&#x27;title&#x27;</span>,<span class="string">&#x27;author_num&#x27;</span>)</span><br><span class="line">   print(res)</span><br><span class="line">   <span class="comment"># &lt;QuerySet [&#123;&#x27;title&#x27;: &#x27;三国演义&#x27;, &#x27;author_num&#x27;: 3&#125;, &#123;&#x27;title&#x27;: &#x27;红楼梦&#x27;, &#x27;author_num&#x27;: 0&#125;, &#123;&#x27;title&#x27;: &#x27;三国演义&#x27;, &#x27;author_num&#x27;: 0&#125;, &#123;&#x27;title&#x27;: &#x27;红楼梦&#x27;, &#x27;author_num&#x27;: 0&#125;, &#123;&#x27;title&#x27;: &#x27;三国演义&#x27;, &#x27;author_num&#x27;: 0&#125;, &#123;&#x27;title&#x27;: &#x27;红楼梦&#x27;, &#x27;author_num&#x27;: 0&#125;, &#123;&#x27;title&#x27;: &#x27;三国演义&#x27;, &#x27;author_num&#x27;: 0&#125;, &#123;&#x27;title&#x27;: &#x27;红楼梦&#x27;, &#x27;author_num&#x27;: 0&#125;, &#123;&#x27;title&#x27;: &#x27;三国演义&#x27;, &#x27;author_num&#x27;: 0&#125;, &#123;&#x27;title&#x27;: &#x27;红楼梦&#x27;, &#x27;author_num&#x27;: 0&#125;, &#123;&#x27;title&#x27;: &#x27;你今天真好看&#x27;, &#x27;author_num&#x27;: 0&#125;, &#123;&#x27;title&#x27;: &#x27;人性的弱点&#x27;, &#x27;author_num&#x27;: 0&#125;, &#123;&#x27;title&#x27;: &#x27;次第花开&#x27;, &#x27;author_num&#x27;: 0&#125;]&gt;</span></span><br><span class="line">   </span><br><span class="line">   <span class="comment"># 按照书名进行分组，就不会有重复数据了：</span></span><br><span class="line">   res = models.Book.objects.values(<span class="string">&#x27;title&#x27;</span>).annotate(author_num = Count(<span class="string">&#x27;authors&#x27;</span>)).values(<span class="string">&#x27;title&#x27;</span>,<span class="string">&#x27;author_num&#x27;</span>)</span><br><span class="line">   print(res)</span><br><span class="line">   <span class="comment"># &lt;QuerySet [&#123;&#x27;title&#x27;: &#x27;三国演义&#x27;, &#x27;author_num&#x27;: 3&#125;, &#123;&#x27;title&#x27;: &#x27;红楼梦&#x27;, &#x27;author_num&#x27;: 0&#125;, &#123;&#x27;title&#x27;: &#x27;你今天真好看&#x27;, &#x27;author_num&#x27;: 0&#125;, &#123;&#x27;title&#x27;: &#x27;人性的弱点&#x27;, &#x27;author_num&#x27;: 0&#125;, &#123;&#x27;title&#x27;: &#x27;次第花开&#x27;, &#x27;author_num&#x27;: 0&#125;]&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment"># 2、统计每个出版社卖的最便宜的书的价格</span></span><br><span class="line">   <span class="comment"># 通过出版社查找书，是反向查询，</span></span><br><span class="line">   res = models.Publish.objects.annotate(book_min_price = Min(<span class="string">&#x27;book__price&#x27;</span>)).values(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;book_min_price&#x27;</span>)</span><br><span class="line">   print(res)</span><br><span class="line">   <span class="comment"># &lt;QuerySet [&#123;&#x27;name&#x27;: &#x27;东方出版社&#x27;, &#x27;book_min_price&#x27;: Decimal(&#x27;45.12&#x27;)&#125;, &#123;&#x27;name&#x27;: &#x27;人民出版社&#x27;, &#x27;book_min_price&#x27;: Decimal(&#x27;23.12&#x27;)&#125;]&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="comment"># 3、统计不止一个作者的图书</span></span><br><span class="line">   res = models.Book.objects.annotate(author_num = Count(<span class="string">&#x27;authors&#x27;</span>)).filter(author_num__gte = <span class="number">2</span>).values(<span class="string">&#x27;title&#x27;</span>,<span class="string">&#x27;author_num&#x27;</span>)</span><br><span class="line">   print(res)</span><br><span class="line">   <span class="comment"># &lt;QuerySet [&#123;&#x27;title&#x27;: &#x27;三国演义&#x27;, &#x27;author_num&#x27;: 3&#125;]&gt;</span></span><br><span class="line">   </span><br><span class="line">   <span class="comment"># 只要你的ORM语句得出的结果还是一个queryset对象，那么它就可以继续无限制的.queryset对象封装的方法</span></span><br><span class="line">   </span><br><span class="line">   <span class="comment"># 4、查询每个作者出的书的总价格</span></span><br><span class="line">   <span class="comment"># 反向查询</span></span><br><span class="line">   res = models.Author.objects.annotate(book_price_sum = Sum(<span class="string">&#x27;book__price&#x27;</span>)).values(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;book_price_sum&#x27;</span>)</span><br><span class="line">   print(res)</span><br><span class="line">   <span class="comment"># &lt;QuerySet [&#123;&#x27;name&#x27;: &#x27;tank&#x27;, &#x27;book_price_sum&#x27;: Decimal(&#x27;123.12&#x27;)&#125;, &#123;&#x27;name&#x27;: &#x27;jack&#x27;, &#x27;book_price_sum&#x27;: Decimal(&#x27;123.12&#x27;)&#125;, &#123;&#x27;name&#x27;: &#x27;ross&#x27;, &#x27;book_price_sum&#x27;: Decimal(&#x27;123.12&#x27;)&#125;]&gt;</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 按照指定的字段分组：</span></span><br><span class="line">   <span class="comment"># res = models.Book.objects.values(&#x27;title&#x27;).annotate()</span></span><br></pre></td></tr></table></figure>

<h1 id="10、F与Q查询"><a href="#10、F与Q查询" class="headerlink" title="10、F与Q查询"></a>10、F与Q查询</h1><p>我们先给Book表增加两个字段：库存量、卖出量</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span>(<span class="params">models.Model</span>):</span></span><br><span class="line">    title = models.CharField(max_length=<span class="number">32</span>)</span><br><span class="line">    price = models.DecimalField(max_digits=<span class="number">8</span>,decimal_places=<span class="number">2</span>)</span><br><span class="line">    publish_date = models.DateField(auto_now_add=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 库存</span></span><br><span class="line">    inventory = models.IntegerField(default=<span class="number">1000</span>)</span><br><span class="line">    <span class="comment"># 卖出</span></span><br><span class="line">    sale = models.IntegerField(default=<span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 书籍与出版社一对多的关系：</span></span><br><span class="line">    publish = models.ForeignKey(to=<span class="string">&#x27;Publish&#x27;</span>)</span><br><span class="line">    <span class="comment"># 书籍与作者多对多关系：</span></span><br><span class="line">    authors = models.ManyToManyField(to=<span class="string">&#x27;Author&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>然后同步到数据库中：</strong><br>makemigrations<br>migrate</p>
<blockquote>
<p><strong>F查询</strong></p>
<p><strong>当查询条件的左右两边都来自于表中则可以使用F查询，帮助你获取到表中某个字段对应的数据</strong></p>
<p><strong>F查询甚至还可以统一修改表中字段数据</strong></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、查询卖出数大于库存数的书籍</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> F</span><br><span class="line">res = models.Book.objects.filter(sale__gt=F(<span class="string">&#x27;inventory&#x27;</span>))</span><br><span class="line">print(res.values(<span class="string">&#x27;title&#x27;</span>))</span><br><span class="line"><span class="comment"># &lt;QuerySet [&#123;&#x27;title&#x27;: &#x27;红楼梦&#x27;&#125;]&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、将所有书的价格提升50元</span></span><br><span class="line">models.Book.objects.update(price = F(<span class="string">&#x27;price&#x27;</span>)+<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3、将所有书的名称后面加上爆款两个字</span></span><br><span class="line"><span class="comment"># 在操作字符类型数据的时候，需要导入以下两个模块</span></span><br><span class="line"><span class="keyword">from</span> django.db.models.functions <span class="keyword">import</span> Concat</span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Value</span><br><span class="line">models.Book.objects.update(title = Concat(F(<span class="string">&#x27;title&#x27;</span>),Value(<span class="string">&#x27;(爆款)&#x27;</span>)))</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>Q查询</strong></p>
<p><strong>filter默认支持and连接查询条件，如果需要修改多个查询条件之间的关系；可以使用Q  与或非</strong></p>
<p><strong>高阶用法：能够将查询条件的左边也变成字符串的形式，而不再是变量名的形式</strong></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Q查询</span></span><br><span class="line"><span class="comment"># 1、查询卖出数大于1000或者价格小于300的书籍</span></span><br><span class="line"><span class="comment"># filter括号内多个参数是and的关系</span></span><br><span class="line">res = models.Book.objects.filter(sale__gt=<span class="number">1000</span>,price__lt=<span class="number">300</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 我们需要借助于Q查询</span></span><br><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> Q</span><br><span class="line"><span class="comment"># 中间逗号隔开，是and的关系</span></span><br><span class="line">res = models.Book.objects.filter(Q(sale__gt=<span class="number">1000</span>),Q(price__lt=<span class="number">300</span>))</span><br><span class="line">print(res.values(<span class="string">&#x27;title&#x27;</span>))</span><br><span class="line"><span class="comment"># &lt;QuerySet []&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 中间竖杠|隔开，是or的关系</span></span><br><span class="line">res1 = models.Book.objects.filter(Q(sale__gt=<span class="number">1000</span>)|Q(price__lt=<span class="number">300</span>))</span><br><span class="line">print(res1.values(<span class="string">&#x27;title&#x27;</span>))</span><br><span class="line"><span class="comment"># &lt;QuerySet [&#123;&#x27;title&#x27;: &#x27;红楼梦(爆款)&#x27;&#125;, &#123;&#x27;title&#x27;: &#x27;你今天真好看(爆款)&#x27;&#125;, &#123;&#x27;title&#x27;: &#x27;次第花开(爆款)&#x27;&#125;]&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ~是not关系，表示卖出数&lt;=1000或者价格&gt;=300的书籍</span></span><br><span class="line">res2 = models.Book.objects.filter(~Q(sale__gt=<span class="number">1000</span>)|~Q(price__lt=<span class="number">300</span>))</span><br><span class="line">print(res2.values(<span class="string">&#x27;title&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Q的高阶用法：能够将查询条件的左边也变成字符串的形式，而不再是变量名的形式</span></span><br><span class="line">q=Q()                              <span class="comment"># 先生成一个Q对象</span></span><br><span class="line">q.connector = <span class="string">&#x27;or&#x27;</span>  <span class="comment"># 默认是and关系，通过connector修改关系。</span></span><br><span class="line">q.children.append((<span class="string">&#x27;sale__gt&#x27;</span>,<span class="number">1000</span>))</span><br><span class="line">q.children.append((<span class="string">&#x27;price__lt&#x27;</span>,<span class="number">300</span>))</span><br><span class="line">res = models.Book.objects.filter(q)</span><br><span class="line">print(res.values(<span class="string">&#x27;title&#x27;</span>))</span><br><span class="line"><span class="comment"># &lt;QuerySet [&#123;&#x27;title&#x27;: &#x27;红楼梦(爆款)&#x27;&#125;, &#123;&#x27;title&#x27;: &#x27;你今天真好看(爆款)&#x27;&#125;, &#123;&#x27;title&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>value里面的参数对应的是sql语句中的select要查找显示的字段，</p>
<p>filter里面的参数相当于where或者having里面的筛选条件</p>
<p>annotate本身表示group by的作用，前面找寻分组依据，内部放置显示可能用到的聚合运算式，后面跟filter来增加限制条件，最后的value来表示分组后想要查找的字段值</p>
<p><img src="https://cdn.jsdelivr.net/gh/Waylonwhynot/whatyouneed_blog_pic@main/pic/1342004-20180621160603196-86991215.png" alt="img"></p>
<h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><h4 id="从已有数据库中反向生成model类："><a href="#从已有数据库中反向生成model类：" class="headerlink" title="从已有数据库中反向生成model类："></a>从已有数据库中反向生成model类：</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py inspectdb &gt; all_models.py</span><br></pre></td></tr></table></figure>



<h3 id="原生SQL三种查询方式的示例："><a href="#原生SQL三种查询方式的示例：" class="headerlink" title="原生SQL三种查询方式的示例："></a>原生SQL三种查询方式的示例：</h3><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.cnblogs.com/fmgao-technology/p/10119671.html#_label0">https://www.cnblogs.com/fmgao-technology/p/10119671.html#_label0</a></p>
<h4 id="Raw执行原生SQL语句"><a href="#Raw执行原生SQL语句" class="headerlink" title="Raw执行原生SQL语句"></a>Raw执行原生SQL语句</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">res = models.Book.objects.raw(<span class="string">&#x27;select * from app01_book&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">    print(i)</span><br><span class="line">    </span><br><span class="line">这个 RawQuerySet 能像普通的 QuerySet 一样被迭代获取对象实例</span><br></pre></td></tr></table></figure>

<h4 id="Cursor-直接执行自定义SQL（raw无法满足需求的时候）"><a href="#Cursor-直接执行自定义SQL（raw无法满足需求的时候）" class="headerlink" title="Cursor 直接执行自定义SQL（raw无法满足需求的时候）"></a>Cursor 直接执行自定义SQL（raw无法满足需求的时候）</h4><p>官网链接：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.djangoproject.com/zh-hans/3.2/topics/db/sql/">https://docs.djangoproject.com/zh-hans/3.2/topics/db/sql/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from django.db import connection</span><br><span class="line"></span><br><span class="line">def my_custom_sql(self):</span><br><span class="line">    with connection.cursor() as cursor:</span><br><span class="line">        cursor.execute(&quot;UPDATE bar SET foo &#x3D; 1 WHERE baz &#x3D; %s&quot;, [self.baz])</span><br><span class="line">        cursor.execute(&quot;SELECT foo FROM bar WHERE baz &#x3D; %s&quot;, [self.baz])</span><br><span class="line">        row &#x3D; cursor.fetchone()</span><br><span class="line"></span><br><span class="line">    return row</span><br></pre></td></tr></table></figure>

<h4 id="extra-执行结果集的操作"><a href="#extra-执行结果集的操作" class="headerlink" title="extra 执行结果集的操作"></a>extra 执行结果集的操作</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">使用extra:</span><br><span class="line"><span class="number">1</span>:Book.objects.filter(publisher__name=<span class="string">&#x27;广东人员出版社&#x27;</span>).extra(where=[<span class="string">&#x27;price&gt;50&#x27;</span>])</span><br><span class="line">Book.objects.filter(publisher__name=<span class="string">&#x27;广东人员出版社&#x27;</span>,price__gt=<span class="number">50</span>)</span><br><span class="line"><span class="number">2</span>:Book.objects.extra(select=&#123;<span class="string">&#x27;count&#x27;</span>:<span class="string">&#x27;select count(*) from hello_Book&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure>



<p>数据库设计三大范式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">原子性（Atomicity）：不可分割的最小单位</span><br><span class="line">一致性（Consistency）：跟原子性相辅相成</span><br><span class="line">隔离性（Isolation）：事务之间互相不干扰</span><br><span class="line">持久性（Durability）：事务一旦确认永久生效</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined" rel="external nofollow noreferrer">Waylon Yan</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/posts/50472.html">http://yoursite.com/posts/50472.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener external nofollow noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ORM/">ORM</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/40409.html"><img class="prev-cover" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">11-Django进阶-模型-事务和查询优化</div></div></a></div><div class="next-post pull-right"><a href="/posts/63794.html"><img class="next-cover" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">08-Django进阶-模型-单表</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/posts/63794.html" title="08-Django进阶-模型-单表"><img class="cover" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-09</div><div class="title">08-Django进阶-模型-单表</div></div></a></div><div><a href="/posts/43887.html" title="09-Django进阶-模型-多表"><img class="cover" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-02</div><div class="title">09-Django进阶-模型-多表</div></div></a></div><div><a href="/posts/61909.html" title="10-Django进阶-模型-更多字段与参数"><img class="cover" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-09</div><div class="title">10-Django进阶-模型-更多字段与参数</div></div></a></div><div><a href="/posts/48247.html" title="12-Django进阶-模型-进阶操作"><img class="cover" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-09</div><div class="title">12-Django进阶-模型-进阶操作</div></div></a></div><div><a href="/posts/36762.html" title="13-Django进阶-模型-choices参数和多对多创建"><img class="cover" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-18</div><div class="title">13-Django进阶-模型-choices参数和多对多创建</div></div></a></div><div><a href="/posts/40409.html" title="11-Django进阶-模型-事务和查询优化"><img class="cover" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-09</div><div class="title">11-Django进阶-模型-事务和查询优化</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Waylon Yan</div><div class="author-info__description">tech life sharing</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">266</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">40</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">25</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Waylonwhynot" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:ywl1006@outlook.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">无止境</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80-%E8%A1%A8%E5%85%B3%E7%B3%BB%E5%9B%9E%E9%A1%BE"><span class="toc-number">1.</span> <span class="toc-text">一 表关系回顾</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B1%E3%80%81app01-book%E4%B8%8Eapp01-publish"><span class="toc-number">1.0.0.1.</span> <span class="toc-text">例1、app01_book与app01_publish</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B2%E3%80%81app01-author%E4%B8%8Eapp01-authordetail"><span class="toc-number">1.0.0.2.</span> <span class="toc-text">例2、app01_author与app01_authordetail</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B3%E3%80%81app01-book%E4%B8%8Eapp01-author"><span class="toc-number">1.0.0.3.</span> <span class="toc-text">例3、app01_book与app01_author</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C-%E5%88%9B%E5%BB%BA%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.</span> <span class="toc-text">二 创建模型</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1%E3%80%81%E5%8D%95%E8%A1%A8%E6%9F%A5%E8%AF%A2-%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5"><span class="toc-number">3.</span> <span class="toc-text">1、单表查询(增删改查)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E8%A1%A8%E6%9F%A5%E8%AF%A2-%E5%A2%9E%E5%88%A0%E6%94%B9"><span class="toc-number">3.0.1.</span> <span class="toc-text">单表查询-增删改</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2%E3%80%81%E5%B8%B8%E8%A7%81%E7%9A%84%E6%9F%A5%E8%AF%A2%E6%96%B9%E6%B3%95-%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A13%E6%9D%A1"><span class="toc-number">4.</span> <span class="toc-text">2、常见的查询方法(必知必会13条)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E7%9B%B8%E5%85%B3%E6%88%AA%E5%9B%BE%EF%BC%9A"><span class="toc-number">4.0.1.</span> <span class="toc-text">2.1.相关截图：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3%E3%80%81-%E5%A2%9E%E5%88%A0%E6%94%B9%E5%92%8C13%E4%B8%AA%E5%BF%85%E4%BC%9A%E6%9F%A5%E8%AF%A2%E6%93%8D%E4%BD%9C%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="toc-number">5.</span> <span class="toc-text">3、 增删改和13个必会查询操作总结：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Create%E8%BF%94%E5%9B%9E%E5%80%BC%E6%98%AF%E8%A2%AB%E5%88%9B%E5%BB%BA%E5%AF%B9%E8%B1%A1%E6%9C%AC%E8%BA%AB"><span class="toc-number">5.0.0.1.</span> <span class="toc-text">Create返回值是被创建对象本身</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#delete%E8%BF%94%E5%9B%9E%E5%80%BC%E6%98%AF%E6%93%8D%E4%BD%9C%E5%BD%B1%E5%93%8D%E7%9A%84%E8%A1%8C%E6%95%B0"><span class="toc-number">5.0.0.2.</span> <span class="toc-text">delete返回值是操作影响的行数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#update%E8%BF%94%E5%9B%9E%E5%80%BC%E4%B8%BA1"><span class="toc-number">5.0.0.3.</span> <span class="toc-text">update返回值为1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%94%E5%9B%9EQuerySet%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%96%B9%E6%B3%95%E6%9C%89"><span class="toc-number">5.0.0.4.</span> <span class="toc-text">返回QuerySet对象的方法有</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%B9%E6%AE%8A%E7%9A%84QuerySet"><span class="toc-number">5.0.0.5.</span> <span class="toc-text">特殊的QuerySet</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%85%B7%E4%BD%93%E5%AF%B9%E8%B1%A1%E7%9A%84"><span class="toc-number">5.0.0.6.</span> <span class="toc-text">返回具体对象的</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%B8%83%E5%B0%94%E5%80%BC%E7%9A%84%E6%96%B9%E6%B3%95%E6%9C%89%EF%BC%9A"><span class="toc-number">5.0.0.7.</span> <span class="toc-text">返回布尔值的方法有：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E6%95%B0%E5%AD%97%E7%9A%84%E6%96%B9%E6%B3%95%E6%9C%89"><span class="toc-number">5.0.0.8.</span> <span class="toc-text">返回数字的方法有</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3%E3%80%81%E7%A5%9E%E5%A5%87%E7%9A%84%E5%8F%8C%E4%B8%8B%E5%88%92%E7%BA%BF%E6%9F%A5%E8%AF%A2-filter%E4%B8%AD%E4%BD%BF%E7%94%A8%EF%BC%8C%E8%8C%83%E5%9B%B4%E6%A8%A1%E7%B3%8A%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.</span> <span class="toc-text">3、神奇的双下划线查询(filter中使用，范围模糊查询)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4%E3%80%81%E5%A4%9A%E8%A1%A8%E6%93%8D%E4%BD%9C-%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="toc-number">7.</span> <span class="toc-text">4、多表操作-创建表</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5%E3%80%81%E5%A4%96%E9%94%AE%E5%AD%97%E6%AE%B5%E7%9A%84%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5"><span class="toc-number">8.</span> <span class="toc-text">5、外键字段的增删改查</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E5%AF%B9%E5%A4%9A%E5%A4%96%E9%94%AE%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5-%E7%9B%B4%E6%8E%A5id%E6%88%96%E8%80%85%E5%AF%B9%E8%B1%A1"><span class="toc-number">8.1.</span> <span class="toc-text">一对多外键增删改查(直接id或者对象)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E5%AF%B9%E5%A4%9A%E5%A4%96%E9%94%AE%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5"><span class="toc-number">8.2.</span> <span class="toc-text">多对多外键增删改查</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6%E3%80%81%E6%AD%A3%E5%8F%8D%E5%90%91%E6%A6%82%E5%BF%B5"><span class="toc-number">9.</span> <span class="toc-text">6、正反向概念</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7%E3%80%81%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">10.</span> <span class="toc-text">7、多表查询</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8%E3%80%81%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-number">11.</span> <span class="toc-text">8、聚合查询</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9%E3%80%81%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2"><span class="toc-number">12.</span> <span class="toc-text">9、分组查询</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10%E3%80%81F%E4%B8%8EQ%E6%9F%A5%E8%AF%A2"><span class="toc-number">13.</span> <span class="toc-text">10、F与Q查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">13.0.1.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A5%E5%85%85"><span class="toc-number">13.0.2.</span> <span class="toc-text">补充</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%8E%E5%B7%B2%E6%9C%89%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E5%8F%8D%E5%90%91%E7%94%9F%E6%88%90model%E7%B1%BB%EF%BC%9A"><span class="toc-number">13.0.2.1.</span> <span class="toc-text">从已有数据库中反向生成model类：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%94%9FSQL%E4%B8%89%E7%A7%8D%E6%9F%A5%E8%AF%A2%E6%96%B9%E5%BC%8F%E7%9A%84%E7%A4%BA%E4%BE%8B%EF%BC%9A"><span class="toc-number">13.0.3.</span> <span class="toc-text">原生SQL三种查询方式的示例：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Raw%E6%89%A7%E8%A1%8C%E5%8E%9F%E7%94%9FSQL%E8%AF%AD%E5%8F%A5"><span class="toc-number">13.0.3.1.</span> <span class="toc-text">Raw执行原生SQL语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Cursor-%E7%9B%B4%E6%8E%A5%E6%89%A7%E8%A1%8C%E8%87%AA%E5%AE%9A%E4%B9%89SQL%EF%BC%88raw%E6%97%A0%E6%B3%95%E6%BB%A1%E8%B6%B3%E9%9C%80%E6%B1%82%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%89"><span class="toc-number">13.0.3.2.</span> <span class="toc-text">Cursor 直接执行自定义SQL（raw无法满足需求的时候）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#extra-%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%E9%9B%86%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-number">13.0.3.3.</span> <span class="toc-text">extra 执行结果集的操作</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/5677.html" title="AI-08-A2A"><img src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI-08-A2A"/></a><div class="content"><a class="title" href="/posts/5677.html" title="AI-08-A2A">AI-08-A2A</a><time datetime="2025-06-21T07:22:33.000Z" title="Created 2025-06-21 15:22:33">2025-06-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/18525.html" title="AI-07-MCP"><img src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI-07-MCP"/></a><div class="content"><a class="title" href="/posts/18525.html" title="AI-07-MCP">AI-07-MCP</a><time datetime="2025-06-08T06:19:30.000Z" title="Created 2025-06-08 14:19:30">2025-06-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/65143.html" title="AI-06-dify"><img src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI-06-dify"/></a><div class="content"><a class="title" href="/posts/65143.html" title="AI-06-dify">AI-06-dify</a><time datetime="2025-06-08T06:19:08.000Z" title="Created 2025-06-08 14:19:08">2025-06-08</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/45471.html" title="AI-05-coze"><img src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI-05-coze"/></a><div class="content"><a class="title" href="/posts/45471.html" title="AI-05-coze">AI-05-coze</a><time datetime="2025-05-17T15:16:48.000Z" title="Created 2025-05-17 23:16:48">2025-05-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/34613.html" title="AI-04-提示词工程"><img src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI-04-提示词工程"/></a><div class="content"><a class="title" href="/posts/34613.html" title="AI-04-提示词工程">AI-04-提示词工程</a><time datetime="2025-05-17T15:15:51.000Z" title="Created 2025-05-17 23:15:51">2025-05-17</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By Waylon Yan</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Local search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>