<!DOCTYPE html><html lang="zh-Hans" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>HTTPS通信过程 | YouNeed</title><meta name="keywords" content="网络"><meta name="author" content="Waylon Yan"><meta name="copyright" content="Waylon Yan"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="HTTPS">
<meta property="og:type" content="article">
<meta property="og:title" content="HTTPS通信过程">
<meta property="og:url" content="http://example.com/posts/17917.html">
<meta property="og:site_name" content="YouNeed">
<meta property="og:description" content="HTTPS">
<meta property="og:locale">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png">
<meta property="article:published_time" content="2022-04-27T11:35:29.000Z">
<meta property="article:modified_time" content="2025-08-04T15:41:26.899Z">
<meta property="article:author" content="Waylon Yan">
<meta property="article:tag" content="网络">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/posts/17917"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'HTTPS通信过程',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-08-04 23:41:26'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.2"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">271</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">42</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">26</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Catagroires</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">YouNeed</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Catagroires</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">HTTPS通信过程</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-04-27T11:35:29.000Z" title="Created 2022-04-27 19:35:29">2022-04-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-08-04T15:41:26.899Z" title="Updated 2025-08-04 23:41:26">2025-08-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%BD%91%E7%BB%9C/">网络</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="HTTPS通信过程"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>HTTPS</p>
<span id="more"></span>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">https://www.cnblogs.com/haimishasha/p/11373034.html</span><br><span class="line">简言：</span><br><span class="line">1. 客户端与服务端使用非对称加密将一个秘钥传递给对方。</span><br><span class="line">2. 双方使用此秘钥通过对称加密通信。</span><br><span class="line">https = http + ssl/sls = http + 数据加密 + 网站认证 + 完整性验证</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">问题：公钥如何发给客户端</span><br><span class="line">答案：CA（机构） 和 CA证书（证书包含：颁发机构，服务端地址，公钥，数字签名）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">验证证书流程：</span><br><span class="line">C以https方式访问S</span><br><span class="line">S返回其证书SngCer给C</span><br><span class="line">C使用内置CA根证书验证SngCer。 验证过程如下：</span><br><span class="line">（将SngCer中明文信息使用相同摘要算法生成摘要得到 digest1；</span><br><span class="line">使用CA根证书中的CA的公钥对SngCer中的数字签名解密得到digest2；</span><br><span class="line">对比digest1与digest2，如果相同则说明SngCer没有被篡改过，而且是CA颁发出去的，可以放心使用其明文信息。)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">自签证书：</span><br><span class="line">  - 生成CA证书</span><br><span class="line">  - 利用私钥生成csr证书请求</span><br><span class="line">  - 利用请求生成证书crt（公钥）</span><br></pre></td></tr></table></figure>



<h1 id="HTTPS通信过程"><a href="#HTTPS通信过程" class="headerlink" title="HTTPS通信过程"></a>HTTPS通信过程</h1><p>HTTPS其实是有两部分组成：HTTP + SSL / TLS，也就是在HTTP上又加了一层处理加密信息的模块。服务端和客户端的信息传输都会通过TLS进行加密，所以传输的数据都是加密后的数据。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Waylonwhynot/whatyouneed_blog_pic@main/pic/728328-20190818203102447-188416934.png" alt="img"></p>
<blockquote>
<p>一个HTTPS请求实际上包含了两次HTTP传输，可以细分为8步。</p>
</blockquote>
<h2 id="1-客户端发起HTTPS请求"><a href="#1-客户端发起HTTPS请求" class="headerlink" title="1. 客户端发起HTTPS请求"></a>1. 客户端发起HTTPS请求</h2><p><strong>客户端向服务器发起HTTPS请求，连接到服务器的443端口,，请求携带了浏览器支持的加密算法和哈希算法。</strong></p>
<h2 id="2-服务端的配置"><a href="#2-服务端的配置" class="headerlink" title="2. 服务端的配置"></a>2. 服务端的配置</h2><p><strong>服务器端有一个密钥对，即公钥和私钥，是用来进行非对称加密使用的，服务器端保存着私钥，不能将其泄露，公钥可以发送给任何人。</strong></p>
<p><strong>服务器收到请求，选择浏览器支持的加密算法和哈希算法。</strong></p>
<p>采用HTTPS协议的服务器必须要有一套数字证书，可以自己制作，也可以向组织申请。区别就是自己颁发的证书需要客户端验证通过，才可以继续访问，而使用受信任的公司申请的证书则不会弹出提示页面(startssl就是个不错的选择，有1年的免费服务)。这套证书其实就是一对公钥和私钥。公钥给别人加密使用，私钥给自己解密使用。如果对公钥和私钥不太理解，可以想象成一把钥匙和一个锁头，只是全世界只有你一个人有这把钥匙，你可以把锁头给别人，别人可以用这个锁把重要的东西锁起来，然后发给你，因为只有你一个人有这把钥匙，所以只有你才能看到被这把锁锁起来的东西。</p>
<h2 id="3-传送证书"><a href="#3-传送证书" class="headerlink" title="3. 传送证书"></a>3. 传送证书</h2><p><strong>服务器将自己的<code>CA</code> 证书(公钥)发送给客户端。</strong></p>
<p>这个证书其实就是公钥，只是包含了很多信息，如证书的颁发机构，过期时间等等。</p>
<h2 id="4-客户端解析证书"><a href="#4-客户端解析证书" class="headerlink" title="4. 客户端解析证书"></a>4. 客户端解析证书</h2><p><strong>客户端收到服务器端的公钥之后，会对公钥进行检查，验证其合法性，如果发现发现公钥有问题，那么HTTPS传输就无法继续。如果公钥合格，那么客户端会生成一个随机值，这个随机值就是用于进行对称加密的密钥，我们将该密钥称之为client key，即客户端密钥，这样在概念上和服务器端的密钥容易进行区分。然后用服务器的公钥对客户端密钥进行非对称加密，这样客户端密钥就变成密文了，至此，HTTPS中的第一次HTTP请求结束。</strong></p>
<p>这部分工作是有客户端的TLS来完成的，首先会验证公钥是否有效，比如颁发机构，过期时间等等，如果发现异常，则会弹出一个警告框，提示证书存在问题。如果证书没有问题，那么就生成一个随即值。然后用证书对该随机值进行加密。就好像上面说的，把随机值用锁头锁起来，这样除非有钥匙，不然看不到被锁住的内容。</p>
<p>证书真伪进行校验</p>
<p>（1）首先浏览器读取证书中的证书所有者、有效期等信息进行一一校验</p>
<p>（2）浏览器开始查找操作系统中已内置的受信任的证书发布机构CA，与服务器发来的证书中的颁发者CA比对，用于校验证书是否为合法机构颁发</p>
<p>（3）如果找不到，浏览器就会报错，说明服务器发来的证书是不可信任的。</p>
<p>（4）如果找到，那么浏览器就会从操作系统中取出 颁发者CA 的公钥，然后对服务器发来的证书里面的签名进行解密得到服务端的公钥和证书的数字签名，数字签名经过CA公钥解密得到证书信息摘要。</p>
<p>（5）浏览器使用相同的hash算法计算出服务器发来的证书的hash值，将这个计算的hash值与证书中签名做对比</p>
<p>（6）对比结果一致，则证明服务器发来的证书合法，没有被冒充</p>
<p>（7）此时浏览器就可以读取证书中的公钥，用于后续加密了</p>
<h2 id="5-传送加密信息"><a href="#5-传送加密信息" class="headerlink" title="5. 传送加密信息"></a>5. 传送加密信息</h2><p><strong>客户端会发起HTTPS中的第二个HTTP请求，将加密之后的客户端密钥发送给服务器。</strong></p>
<p>这部分传送的是用证书加密后的随机值R(私钥)，目的就是让服务端得到这个随机值R，以后客户端和服务端的通信就可以通过这个随机值R来进行加密解密了。</p>
<h2 id="6-服务端解密信息"><a href="#6-服务端解密信息" class="headerlink" title="6. 服务端解密信息"></a>6. 服务端解密信息</h2><p><strong>服务器接收到客户端发来的密文之后，会用自己的私钥对其进行非对称解密，解密之后的明文就是客户端密钥(\</strong>随机数 <code>R</code>*<em>)，然后把内容用客户端密钥*</em>随机数 <code>R</code>**进行对称加密，这样数据就变成了密文。**</p>
<p>服务端用私钥解密后，得到了客户端传过来的随机值(私钥)，然后把内容通过该值进行对称加密。所谓对称加密就是，将信息和私钥通过某种算法混合在一起，这样除非知道私钥，不然无法获取内容，而正好客户端和服务端都知道这个私钥，所以只要加密算法够彪悍，私钥够复杂，数据就够安全。</p>
<h2 id="7-传输加密后的信息"><a href="#7-传输加密后的信息" class="headerlink" title="7. 传输加密后的信息"></a>7. 传输加密后的信息</h2><p>**然后服务器将加密后的密文发送给客户端。(服务器以随机数 <code>R</code> 为密钥把传输内容使用对称加密算法加密并传输给浏览器)**。</p>
<p>这部分信息是服务端用私钥加密后的信息，可以在客户端被还原</p>
<h2 id="8-客户端解密信息"><a href="#8-客户端解密信息" class="headerlink" title="8. 客户端解密信息"></a>8. 客户端解密信息</h2><p><strong>客户端收到服务器发送来的密文，用客户端密钥\</strong>(**随机数 <code>R</code>**)**对其进行对称解密，得到服务器发送的数据。这样HTTPS中的第二个HTTP请求结束，整个HTTPS传输完成。**</p>
<p>客户端用之前生成的私钥解密服务段传过来的信息，于是获取了解密后的内容。整个过程第三方即使监听到了数据，也束手无策。</p>
<hr>
<h1 id="什么是证书卸载？"><a href="#什么是证书卸载？" class="headerlink" title="什么是证书卸载？"></a>什么是证书卸载？</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">证书卸载指的就是 LB 在接受请求之后内部由https-&gt;http 的过程</span><br></pre></td></tr></table></figure>









<h1 id="自签证书"><a href="#自签证书" class="headerlink" title="自签证书"></a>自签证书</h1><h2 id="1-cfssl-是什么"><a href="#1-cfssl-是什么" class="headerlink" title="1. cfssl 是什么"></a>1. cfssl 是什么</h2><p>部署分布式系统服务场景下，如etcd、kubernetes、grpc servers集群时，常用的安全策略除了用户名密码策略外，经常要用到TLS加密和认证策略。一种好用的签名CA证书工具是cfssl工具集。本文讲述以cfssl自签CA证书用于TLS认证技术实践方法。</p>
<p>cfssl的官网地址是：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://link.segmentfault.com/?enc=IdUGbP8qH9jOhGbWXOj9Ig==.l/2Pt46P3szlr4VDb6wypZZaCLWUPQ+2pfvCFm/DlQE=">https://cfssl.org</a>。简单来说，它是美国的一个叫CloudFlare的公司开发的一款开源的工具包，它在CloudFlare公司内部被用来捆绑TLS/SSL证书链，并作为内部证书颁发机构基础架构。</p>
<h2 id="2-安装cfssl软件工具包"><a href="#2-安装cfssl软件工具包" class="headerlink" title="2. 安装cfssl软件工具包"></a>2. 安装cfssl软件工具包</h2><p>cfssl自签证书工具集包含3个软件：</p>
<ul>
<li>cfssl: 用于签发证书；</li>
<li>cfssljson: 将cfssl签发生成的证书(json格式)变成文件承载式文件；</li>
<li>cfssl-certinfo: 验证查看证书信息。</li>
</ul>
<p>其官网下载地址是：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://link.segmentfault.com/?enc=I5UVgWT8jpDgsc7cHxgwxg==.fahF4Pb3vWOzeyCkkrsvqGSQ42EfOnlHnmCIXoAqg+A=">https://pkg.cfssl.org</a></p>
<p>本文讲述的是CentOS Linux release 7.5.1804 系统下的构建TLS/SSL证书。因此下载linux-amd64版本即可。对应下载1.2版本的如下3个文件即可。<br>直接执行以下3个命令即可瞬间完成下载3个可执行程序文件：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https:<span class="regexp">//</span>pkg.cfssl.org<span class="regexp">/R1.2/</span>cfssl_linux-amd64</span><br><span class="line">wget https:<span class="regexp">//</span>pkg.cfssl.org<span class="regexp">/R1.2/</span>cfssljson_linux-amd64</span><br><span class="line">wget https:<span class="regexp">//</span>pkg.cfssl.org<span class="regexp">/R1.2/</span>cfssl-certinfo_linux-amd64</span><br></pre></td></tr></table></figure>

<p>由于都是linux64系统下可执行程序包，直接重命名后放到/usr/local/bin下,并添加可执行权限即可，如下图所示：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo cp cfssl_linux-amd64  <span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>cfssl</span><br><span class="line">sudo chmod +x <span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>cfssl</span><br><span class="line">sudo cp cfssljson_linux-amd64 <span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>cfssljson</span><br><span class="line">sudo chmod +x <span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>cfssljson</span><br><span class="line">sudo cp cfssl-certinfo_linux-amd64  <span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>cfssl-certinfo</span><br><span class="line">sudo chmod +x <span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>cfssl-certinfo</span><br><span class="line"></span><br><span class="line">which cfssl</span><br><span class="line">which cfssljson</span><br><span class="line">which cfssl-certinfo</span><br></pre></td></tr></table></figure>

<p><img src="https://segmentfault.com/img/bVcKLzx" alt="image"><br>至此cfssl工具包安装完毕。本文同时提供1.2版本的linux-amd64架构的cfssl工具包同时提供下载地址如下：</p>
<p>下载链接见: <a target="_blank" rel="noopener external nofollow noreferrer" href="https://link.segmentfault.com/?enc=ZOVwJGnRLWb+wYK8BjsCjw==.slQR0skVnViEiIfGAuT1OCGTni1ZTheGxvaSy9d2HnkNJQ2xA2MJhL9W//jyw7fk">https://pan.baidu.com/s/19RXgEUVBci-QFavfMMNHFQ</a> 提取码: nj8k。<br><img src="https://segmentfault.com/img/bVcKLzO" alt="image"></p>
<h2 id="2-使用cfssl创建证书实操指南"><a href="#2-使用cfssl创建证书实操指南" class="headerlink" title="2. 使用cfssl创建证书实操指南"></a>2. 使用cfssl创建证书实操指南</h2><p>用cfssl创建我们需要的证书文件的过程分一下3个步骤：</p>
<h3 id="2-1-创建CA根证书及其私钥"><a href="#2-1-创建CA根证书及其私钥" class="headerlink" title="2.1 创建CA根证书及其私钥"></a>2.1 创建CA根证书及其私钥</h3><p>根证书及其私钥，也即CA证书和CA证书的私钥，是集群所有节点共享的，只需要创建一个 CA 证书即其私钥，后续创建的所有证书都由它签名。CA根证书创建后一般命名是ca.pem。 CA根证书私钥创建后一般命名是ca-key.pem。</p>
<blockquote>
<p>注意：</p>
<p><strong>CA根证书及其私钥，只需要创建一次即可。后续其他证书都由它签名，CA根证书及其私钥一旦改变，其它证书也就无效了。</strong></p>
</blockquote>
<p>创建CA根证书及其私钥过程可依照以下2个步骤：</p>
<h4 id="2-1-1-创建CA根证书签名请求文件ca-csr-json"><a href="#2-1-1-创建CA根证书签名请求文件ca-csr-json" class="headerlink" title="2.1.1 创建CA根证书签名请求文件ca-csr.json"></a>2.1.1 创建CA根证书签名请求文件ca-csr.json</h4><p>注意ca-csr.json中csr含义是：Certificate Signing Request，证书签名请求，因此看到 xx-csr.json，你就要知道该文件是证书签名请求文件，有了它，cfssl就可以生成证书和证书私钥了。</p>
<p>ca-csr.json该如何配置呢？ 其实很简单，下图是截取的cfssl官网上给出的一个xx-csr.json的示例：<br><img src="https://cdn.jsdelivr.net/gh/Waylonwhynot/whatyouneed_blog_pic@main/pic/bVcKLAk.png" alt="image"></p>
<p>对csr文件内容解释如下：</p>
<ul>
<li><p>CN：Common Name，所有csr文件都必须有字段，对于 SSL 证书，一般为网站域名；而对于代码签名证书则为申请单位名称；而对于客户端证书则为证书申请者的姓名。</p>
</li>
<li><p>hosts: 网络请求url中的合法主机名或域名集合。</p>
<p>下面给出2个hosts的例子：(都包含127.0.0.1,并且都使用的是域名或主机名，并且都预留了额外3个host名带extra字样的为预留host,以备后期扩容只用)</p>
</li>
</ul>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> <span class="string">&quot;hosts&quot;</span>:[</span><br><span class="line"> <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line"> <span class="string">&quot;baseserver1.online-etcd.freedom.org&quot;</span>,</span><br><span class="line"> <span class="string">&quot;baseserver2.online-etcd.freedom.org&quot;</span>,</span><br><span class="line"> <span class="string">&quot;baseserver3.online-etcd.freedom.org&quot;</span>,</span><br><span class="line"> <span class="string">&quot;baseserver-extra1.online-etcd.freedom.org&quot;</span>,</span><br><span class="line"> <span class="string">&quot;baseserver-extra2.online-etcd.freedom.org&quot;</span>,</span><br><span class="line"> <span class="string">&quot;baseserver-extra3.online-etcd.freedom.org&quot;</span></span><br><span class="line"> ]</span><br><span class="line"> <span class="string">&quot;hosts&quot;</span>:[</span><br><span class="line"> <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line"> <span class="string">&quot;cent7ax&quot;</span>,</span><br><span class="line"> <span class="string">&quot;cent7bx&quot;</span>,</span><br><span class="line"> <span class="string">&quot;cent7cx&quot;</span>,</span><br><span class="line"> <span class="string">&quot;extra-cent7ax&quot;</span>,</span><br><span class="line"> <span class="string">&quot;extra-cent7bx&quot;</span>,</span><br><span class="line"> <span class="string">&quot;extra-cent7cx&quot;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<blockquote>
<ol>
<li>超过该集合范围的任何请求都不会被支持认证通过。</li>
<li>CA根证书及其私钥创建过程不需要甚至该字段。其它服务证书创建必须有该字段。</li>
<li>hosts设置技巧：<strong>一般都把”127.0.0.1”包含进去；推荐使用域名或vip,尽量不要用ip地址，否则后期遇到某个服务所在机器宕机要重新更换某1台或多台机器时会面临证书认证不通过的毁灭性尴尬情况，导致扩容失败，集群服务面临毁灭性灾难。这里强烈推荐用域名或vip地址，另外，如果有条件，配置之处建议多预留1-3个host地址，防止后期扩容困难。</strong></li>
</ol>
</blockquote>
<ul>
<li>key: key字段是必须有的字段，其内容一般也比较固定就是：{“algo”:”rsa”,”size”:2048}，表示使用的加密算法rsa,密文长度2048。</li>
<li>names字段：也是必须有字段，是证书对外公开显示的一些字段，常见的有如下：</li>
</ul>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">C:   (Country)所在国家简称，只能是国家字母缩写，如中国：CN</span><br><span class="line">L：  (Locality) 所在地区<span class="regexp">/城市简称，如Beijing/</span>San Francisco</span><br><span class="line">ST： (State<span class="regexp">/Provice)所在州/</span>省份简称,如Beijing/California</span><br><span class="line">O：  (Organization Name) 单位名称，对于 SSL 证书，一般为网站域名；而对于代码签名证书则为申请单位名称；而对于客户端单位证书则为证书申请者所在单位名称</span><br><span class="line">OU： (other)显示其他内容,常见的内容值有“System<span class="string">&quot;、&quot;</span>Website<span class="string">&quot;等</span></span><br><span class="line"><span class="string">电子邮件 (Email)：    简称E 字段 </span></span><br><span class="line"><span class="string">多个姓名字段 ：        简称G 字段 </span></span><br><span class="line"><span class="string">介绍Description ：   介绍字段 </span></span><br><span class="line"><span class="string">电话号码：            Phone 字段，格式要求 + 国家区号 城市区号 电话号码，如： +86 732 88888888 </span></span><br><span class="line"><span class="string">地址：               STREET  字段 </span></span><br><span class="line"><span class="string">邮政编码:            PostalCode 字段 </span></span><br><span class="line"><span class="string">显示其他内容：        简称OU 字段</span></span><br></pre></td></tr></table></figure>

<p>综合上述，最终我们生成的ca-csr.json如下图所示：</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   <span class="string">&quot;CN&quot;</span>:<span class="string">&quot;etcd.freedom.com&quot;</span>,</span><br><span class="line">   <span class="string">&quot;key&quot;</span>:&#123;</span><br><span class="line">     <span class="string">&quot;algo&quot;</span>:<span class="string">&quot;rsa&quot;</span>,</span><br><span class="line">     <span class="string">&quot;size&quot;</span>:<span class="number">2048</span></span><br><span class="line">   &#125;,</span><br><span class="line">   <span class="string">&quot;names&quot;</span>:[</span><br><span class="line">     &#123;</span><br><span class="line">       <span class="string">&quot;C&quot;</span>:<span class="string">&quot;CN&quot;</span>,</span><br><span class="line">       <span class="string">&quot;ST&quot;</span>:<span class="string">&quot;BeiJing&quot;</span>,</span><br><span class="line">       <span class="string">&quot;L&quot;</span>:<span class="string">&quot;BeiJing&quot;</span>,</span><br><span class="line">       <span class="string">&quot;O&quot;</span>:<span class="string">&quot;etcd-op&quot;</span>,</span><br><span class="line">       <span class="string">&quot;OU&quot;</span>:<span class="string">&quot;System&quot;</span></span><br><span class="line">     &#125;</span><br><span class="line">   ]</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>根据该根证书签名请求文件就可以直接通过cfssl工具包生成CA根证书及其私钥了。</p>
<h4 id="2-1-2-根据CA根证书签名请求文件生成CA根证书及其私钥"><a href="#2-1-2-根据CA根证书签名请求文件生成CA根证书及其私钥" class="headerlink" title="2.1.2 根据CA根证书签名请求文件生成CA根证书及其私钥"></a>2.1.2 根据CA根证书签名请求文件生成CA根证书及其私钥</h4><p>直接执行命令：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cfssl gencert -initca <span class="keyword">ca</span>-csr.json | cfssljson -bare <span class="keyword">ca</span></span><br></pre></td></tr></table></figure>

<p>注意：cfssljson -bare + 命名文件名，如本例中的ca，表示生成ca.pem和ca-key.pem,分别为证书和私钥文件。<br><img src="https://segmentfault.com/img/bVcKLBB" alt="image"><br>生成的ca.pem是CA根证书文件，ca-key.pem是其私钥文件。其内容大体如下样式：<br><img src="https://cdn.jsdelivr.net/gh/Waylonwhynot/whatyouneed_blog_pic@main/pic/bVcKLBF.png" alt="image"><br>至此，CA根证书及其私钥文件已经生成，便可以用它们来签发其他认证文件了。</p>
<h3 id="2-2-根据CA根证书及其私钥签名生成其它证书及其私钥"><a href="#2-2-根据CA根证书及其私钥签名生成其它证书及其私钥" class="headerlink" title="2.2 根据CA根证书及其私钥签名生成其它证书及其私钥"></a>2.2 根据CA根证书及其私钥签名生成其它证书及其私钥</h3><p>利用CA根证书及其私钥文件签发生成其它证书及其私钥，分为以下3个步骤执行操作：</p>
<h4 id="2-2-1-创建CA根证书配置文件"><a href="#2-2-1-创建CA根证书配置文件" class="headerlink" title="2.2.1 创建CA根证书配置文件"></a>2.2.1 创建CA根证书配置文件</h4><p>CA根证书配置文件，一般命名为ca-config.json,它用于配置根证书的使用场景 (profile) 和具体参数 (usage，过期时间、服务端认证、客户端认证、加密等)，后续在签名其它证书时需要指定特定场景 (profile)。</p>
<p>一个ca-config.json例子如下：</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;signing&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;default&quot;</span>:&#123;</span><br><span class="line">      <span class="string">&quot;expiry&quot;</span>:<span class="string">&quot;175200h&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;profiles&quot;</span>:&#123;</span><br><span class="line">      <span class="string">&quot;etcd-op&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;expiry&quot;</span>:<span class="string">&quot;175200h&quot;</span>,</span><br><span class="line">        <span class="string">&quot;usages&quot;</span>:[</span><br><span class="line">          <span class="string">&quot;signing&quot;</span>,</span><br><span class="line">          <span class="string">&quot;key encipherment&quot;</span>,</span><br><span class="line">          <span class="string">&quot;server auth&quot;</span>,</span><br><span class="line">          <span class="string">&quot;client auth&quot;</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">expiry: <span class="number">175200</span>h表示<span class="number">20</span>年有效期</span><br><span class="line">profiles: 指定证书使用场景，下面的etcd-op是一个场景名称，后续签名生成证书及其私钥时需要指定该场景(profile)名称</span><br><span class="line">signing：表示该证书可用于签名其它证书，生成的 ca.pem 证书中 <span class="symbol">CA</span>=<span class="symbol">TRUE</span></span><br><span class="line">server auth：表示 client 可以用该该证书对 server 提供的证书进行验证</span><br><span class="line">client auth：表示 server 可以用该该证书对 client 提供的证书进行验证</span><br></pre></td></tr></table></figure>

<h4 id="2-2-2-创建目标证书签名请求文件"><a href="#2-2-2-创建目标证书签名请求文件" class="headerlink" title="2.2.2 创建目标证书签名请求文件"></a>2.2.2 创建目标证书签名请求文件</h4><p>签名生成证书及其私钥，首先需要创建csr即证书签名请求文件，如下所示为一个csr证书签名请求文件的示例：</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;CN&quot;</span>:<span class="string">&quot;etcd.freedom.com&quot;</span>,</span><br><span class="line">  <span class="string">&quot;key&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;algo&quot;</span>:<span class="string">&quot;rsa&quot;</span>,</span><br><span class="line">    <span class="string">&quot;size&quot;</span>:<span class="number">2048</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;hosts&quot;</span>:[</span><br><span class="line">    <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;cent7ax&quot;</span>,</span><br><span class="line">    <span class="string">&quot;cent7bx&quot;</span>,</span><br><span class="line">    <span class="string">&quot;cent7cx&quot;</span>,</span><br><span class="line">    <span class="string">&quot;extra-cent7ax&quot;</span>,</span><br><span class="line">    <span class="string">&quot;extra-cent7bx&quot;</span>,</span><br><span class="line">    <span class="string">&quot;extra-cent7cx&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;names&quot;</span>:[</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;C&quot;</span>:<span class="string">&quot;CN&quot;</span>,</span><br><span class="line">      <span class="string">&quot;ST&quot;</span>:<span class="string">&quot;BeiJing&quot;</span>,</span><br><span class="line">      <span class="string">&quot;L&quot;</span>:<span class="string">&quot;BeiJing&quot;</span>,</span><br><span class="line">      <span class="string">&quot;O&quot;</span>:<span class="string">&quot;etcd-op&quot;</span>,</span><br><span class="line">      <span class="string">&quot;OU&quot;</span>:<span class="string">&quot;System&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将上述内容内存为签名请求文件，比如etcd-csr.json。</p>
<h4 id="2-2-3-根据CA根证书及其私钥签名生成目标证书和私钥"><a href="#2-2-3-根据CA根证书及其私钥签名生成目标证书和私钥" class="headerlink" title="2.2.3 根据CA根证书及其私钥签名生成目标证书和私钥"></a>2.2.3 根据CA根证书及其私钥签名生成目标证书和私钥</h4><p>执行命令：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cfssl gencert <span class="attribute">-ca</span>=ca.pem <span class="attribute">-ca-key</span>=ca-key.pem <span class="attribute">-config</span>=ca-config.json <span class="attribute">-profile</span>=etcd-op etcd-csr.json | cfssljson -bare etcd</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Waylonwhynot/whatyouneed_blog_pic@main/pic/bVcKLB9.png" alt="image"><br>如上图，其中的报错可以忽略。<br><img src="https://cdn.jsdelivr.net/gh/Waylonwhynot/whatyouneed_blog_pic@main/pic/bVcKLCg.png" alt="image"><br>上图所示为最终签名生成的证书及其私钥文件，其中etcd.pem为证书文件，etcd-key.pem为私钥文件。其格式大体与前文提及的ca.pem和ca-key.pem相同。都是一个证书文件，一个是私钥文件，二者配成生成。</p>
<h3 id="2-3-校验证书"><a href="#2-3-校验证书" class="headerlink" title="2.3 校验证书"></a>2.3 校验证书</h3><h4 id="2-3-1-使用openssl命令校验证书"><a href="#2-3-1-使用openssl命令校验证书" class="headerlink" title="2.3.1 使用openssl命令校验证书"></a>2.3.1 使用openssl命令校验证书</h4><p>执行命令：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">openssl x509  -noout -<span class="built_in">text</span> -<span class="keyword">in</span>  etcd.pem</span><br><span class="line">[root@cent7ax cfssl_dir.bak]<span class="comment"># openssl x509  -noout -text -in  etcd.pem </span></span><br><span class="line">Certificate:</span><br><span class="line">    Data:</span><br><span class="line">        Version: <span class="number">3</span> (<span class="number">0x2</span>)</span><br><span class="line">        Serial Number:</span><br><span class="line">            <span class="number">28</span>:fd:f7:a1:e9:f2:<span class="number">03</span>:<span class="number">0</span>b:<span class="number">51</span>:<span class="number">16</span>:<span class="number">18</span>:<span class="number">37</span>:<span class="number">8</span>f:<span class="number">64</span>:<span class="number">46</span>:a9:b6:<span class="number">72</span>:<span class="number">95</span>:<span class="number">67</span></span><br><span class="line">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class="line">        Issuer: C=CN, ST=BeiJing, L=BeiJing, O=etcd-op, OU=System, CN=etcd.freedom.com</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Nov <span class="number">25</span> <span class="number">01</span>:<span class="number">47</span>:<span class="number">00</span> <span class="number">2020</span> GMT</span><br><span class="line">            Not After : Nov <span class="number">20</span> <span class="number">01</span>:<span class="number">47</span>:<span class="number">00</span> <span class="number">2040</span> GMT</span><br><span class="line">        Subject: C=CN, ST=BeiJing, L=BeiJing, O=etcd-op, OU=System, CN=etcd.freedom.com</span><br><span class="line">        Subject Public Key Info:</span><br><span class="line">            Public Key Algorithm: rsaEncryption</span><br><span class="line">                Public-Key: (<span class="number">2048</span> bit)</span><br><span class="line">                Modulus:</span><br><span class="line">                    <span class="number">00</span>:ca:<span class="number">4</span>f:a2:<span class="number">09</span>:<span class="number">9</span>f:<span class="number">12</span>:<span class="number">7</span>c:<span class="number">81</span>:a8:<span class="number">09</span>:<span class="number">4</span>d:<span class="number">6</span>f:c3:<span class="number">96</span>:</span><br><span class="line">                    c0:<span class="number">69</span>:da:fc:<span class="number">9</span>d:<span class="number">10</span>:<span class="number">33</span>:<span class="number">4</span>c:<span class="number">2</span>a:<span class="number">56</span>:ba:<span class="number">06</span>:<span class="number">20</span>:<span class="number">3</span>e:<span class="number">2</span>f:</span><br><span class="line">                    <span class="number">52</span>:<span class="number">2</span>f:<span class="number">15</span>:<span class="number">36</span>:a1:<span class="number">11</span>:<span class="number">89</span>:f7:<span class="number">98</span>:<span class="number">56</span>:b6:<span class="number">8</span>f:<span class="number">38</span>:<span class="number">85</span>:<span class="number">82</span>:</span><br><span class="line">                    <span class="number">02</span>:<span class="number">2</span>c:ac:a8:b1:<span class="number">9</span>e:<span class="number">71</span>:<span class="number">6</span>d:fe:e5:<span class="number">06</span>:<span class="number">1</span>f:a7:<span class="number">7</span>a:<span class="number">3</span>e:</span><br><span class="line">                    <span class="number">9</span>c:be:e2:<span class="number">9</span>d:<span class="number">75</span>:<span class="number">3</span>e:<span class="number">69</span>:<span class="number">1</span>b:<span class="number">9</span>e:<span class="number">06</span>:eb:<span class="number">00</span>:<span class="number">1</span>b:<span class="number">74</span>:<span class="number">60</span>:</span><br><span class="line">                    c3:<span class="number">6</span>c:cc:f8:f4:c9:<span class="number">2</span>c:<span class="number">12</span>:d1:aa:<span class="number">2</span>a:<span class="number">72</span>:<span class="number">3</span>f:<span class="number">5</span>b:e0:</span><br><span class="line">                    d0:<span class="number">45</span>:<span class="number">57</span>:f0:ad:<span class="number">88</span>:<span class="number">6</span>e:a0:<span class="number">59</span>:c4:e4:<span class="number">5</span>d:<span class="number">53</span>:cb:<span class="number">6</span>f:</span><br><span class="line">                    ec:<span class="number">8</span>e:fe:<span class="number">33</span>:<span class="number">32</span>:<span class="number">9</span>f:<span class="number">99</span>:ad:e6:<span class="number">3</span>b:ca:ad:<span class="number">7</span>d:<span class="number">4</span>b:<span class="number">19</span>:</span><br><span class="line">                    <span class="number">8</span>c:eb:<span class="number">7</span>d:<span class="number">92</span>:<span class="number">8</span>e:<span class="number">8</span>e:<span class="number">09</span>:<span class="number">8</span>b:a7:<span class="number">49</span>:<span class="number">2</span>a:<span class="number">1</span>e:<span class="number">73</span>:<span class="number">35</span>:eb:</span><br><span class="line">                    e3:<span class="number">59</span>:<span class="number">4</span>f:<span class="number">87</span>:be:<span class="number">8</span>d:<span class="number">12</span>:cb:<span class="number">23</span>:<span class="number">41</span>:f5:<span class="number">34</span>:bf:<span class="number">1</span>a:<span class="number">4</span>d:</span><br><span class="line">                    <span class="number">04</span>:c0:<span class="number">7</span>c:<span class="number">70</span>:<span class="number">99</span>:<span class="number">8</span>f:ce:<span class="number">51</span>:ca:<span class="number">1</span>c:<span class="number">7</span>c:<span class="number">99</span>:<span class="number">45</span>:<span class="number">0</span>e:b1:</span><br><span class="line">                    d7:<span class="number">91</span>:<span class="number">63</span>:<span class="number">58</span>:<span class="number">4</span>c:a3:<span class="number">73</span>:<span class="number">55</span>:cb:d1:<span class="number">8</span>e:eb:de:cd:<span class="number">5</span>b:</span><br><span class="line">                    <span class="number">89</span>:<span class="number">35</span>:<span class="number">30</span>:<span class="number">4</span>d:<span class="number">45</span>:<span class="number">08</span>:c6:<span class="number">09</span>:de:e2:b0:de:<span class="number">56</span>:aa:<span class="number">13</span>:</span><br><span class="line">                    ac:<span class="number">39</span>:cb:e5:<span class="number">2</span>d:<span class="number">06</span>:<span class="number">06</span>:<span class="number">24</span>:<span class="number">63</span>:fa:eb:c8:<span class="number">20</span>:e0:b8:</span><br><span class="line">                    bb:<span class="number">55</span>:bf:d1:<span class="number">83</span>:<span class="number">4</span>a:<span class="number">9</span>a:dc:<span class="number">2</span>c:<span class="number">56</span>:<span class="number">6</span>c:<span class="number">16</span>:<span class="number">7</span>b:e3:<span class="number">06</span>:</span><br><span class="line">                    <span class="number">53</span>:<span class="number">55</span>:d8:d3:<span class="number">57</span>:e3:<span class="number">82</span>:<span class="number">09</span>:<span class="number">3</span>f:<span class="number">8</span>b:<span class="number">91</span>:<span class="number">1</span>b:b8:<span class="number">68</span>:d1:</span><br><span class="line">                    <span class="number">0</span>f:<span class="number">8</span>f:<span class="number">98</span>:<span class="number">4</span>e:<span class="number">07</span>:fc:<span class="number">94</span>:<span class="number">65</span>:<span class="number">69</span>:<span class="number">6</span>f:bd:<span class="number">59</span>:a7:<span class="number">38</span>:<span class="number">08</span>:</span><br><span class="line">                    <span class="number">79</span>:<span class="number">27</span></span><br><span class="line">                Exponent: <span class="number">65537</span> (<span class="number">0x10001</span>)</span><br><span class="line">        X509v3 extensions:</span><br><span class="line">            X509v3 Key Usage: critical</span><br><span class="line">                Digital Signature, Key Encipherment</span><br><span class="line">            X509v3 Extended Key Usage: </span><br><span class="line">                TLS Web Server Authentication, TLS Web Client Authentication</span><br><span class="line">            X509v3 Basic Constraints: critical</span><br><span class="line">                CA:FALSE</span><br><span class="line">            X509v3 Subject Key Identifier: </span><br><span class="line">                F0:<span class="number">73</span>:FD:<span class="number">7</span>B:<span class="number">11</span>:AF:<span class="number">96</span>:CF:C7:BF:<span class="number">65</span>:FE:BD:<span class="number">27</span>:<span class="number">5</span>C:<span class="number">39</span>:<span class="number">44</span>:D0:<span class="number">04</span>:CC</span><br><span class="line">            X509v3 Authority Key Identifier: </span><br><span class="line">                keyid:<span class="number">0</span>F:D9:<span class="number">11</span>:F9:<span class="number">9</span>F:B8:<span class="number">72</span>:B3:<span class="number">25</span>:<span class="number">01</span>:F2:<span class="number">3</span>E:<span class="number">0</span>A:D0:<span class="number">0</span>E:<span class="number">7</span>F:<span class="number">65</span>:D2:<span class="number">91</span>:<span class="number">0</span>A</span><br><span class="line"></span><br><span class="line">        X509v3 Subject Alternative Name: </span><br><span class="line">            DNS:cent7ax, DNS:cent7bx, DNS:cent7cx, DNS:extra-cent7ax, DNS:extra-cent7bx, DNS:extra-cent7cx, IP Address:<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">Signature Algorithm: sha256WithRSAEncryption</span><br><span class="line">     <span class="number">83</span>:ce:<span class="number">62</span>:<span class="number">56</span>:<span class="number">62</span>:<span class="number">1</span>c:<span class="number">71</span>:cd:<span class="number">9</span>f:<span class="number">83</span>:<span class="number">44</span>:<span class="number">76</span>:<span class="number">7</span>a:<span class="number">7</span>b:<span class="number">44</span>:<span class="number">60</span>:c2:<span class="number">6</span>c:</span><br><span class="line">     <span class="number">78</span>:ff:<span class="number">91</span>:<span class="number">62</span>:<span class="number">6</span>c:<span class="number">8</span>e:<span class="number">39</span>:<span class="number">61</span>:d4:d3:f8:<span class="number">74</span>:c0:<span class="number">71</span>:<span class="number">65</span>:c3:<span class="number">80</span>:<span class="number">50</span>:</span><br><span class="line">     d1:<span class="number">2</span>c:f3:d6:<span class="number">40</span>:bc:<span class="number">1</span>f:<span class="number">7</span>e:<span class="number">3</span>b:f6:e0:<span class="number">2</span>c:<span class="number">82</span>:<span class="number">4</span>f:<span class="number">6</span>b:<span class="number">8</span>c:<span class="number">09</span>:<span class="number">48</span>:</span><br><span class="line">     <span class="number">22</span>:d7:ea:<span class="number">96</span>:ba:<span class="number">94</span>:<span class="number">99</span>:<span class="number">72</span>:<span class="number">9</span>d:ae:c2:<span class="number">06</span>:<span class="number">15</span>:<span class="number">37</span>:<span class="number">7</span>f:<span class="number">9</span>b:<span class="number">20</span>:<span class="number">02</span>:</span><br><span class="line">     a7:d7:<span class="number">62</span>:eb:<span class="number">7</span>d:<span class="number">7</span>e:<span class="number">93</span>:<span class="number">53</span>:<span class="number">5</span>f:<span class="number">21</span>:<span class="number">80</span>:f8:b6:<span class="number">1</span>c:<span class="number">8</span>d:<span class="number">40</span>:<span class="number">2</span>f:<span class="number">09</span>:</span><br><span class="line">     <span class="number">75</span>:<span class="number">16</span>:db:<span class="number">3</span>f:<span class="number">4</span>e:<span class="number">01</span>:<span class="number">22</span>:d2:<span class="number">7</span>d:a7:eb:e2:<span class="number">49</span>:d6:<span class="number">06</span>:<span class="number">7</span>b:<span class="number">3</span>c:<span class="number">07</span>:</span><br><span class="line">     <span class="number">1</span>c:<span class="number">90</span>:b0:ae:bc:<span class="number">9</span>d:<span class="number">77</span>:<span class="number">8</span>b:a2:a9:<span class="number">5</span>d:<span class="number">57</span>:d9:<span class="number">1</span>a:e8:<span class="number">0</span>a:<span class="number">2</span>a:<span class="number">1</span>d:</span><br><span class="line">     <span class="number">62</span>:<span class="number">86</span>:d8:dd:b8:<span class="number">9</span>f:<span class="number">14</span>:a4:cd:<span class="number">23</span>:<span class="number">36</span>:a9:c4:c6:<span class="number">40</span>:ec:<span class="number">1</span>a:<span class="number">58</span>:</span><br><span class="line">     f5:a1:<span class="number">6</span>e:d3:<span class="number">37</span>:<span class="number">7</span>f:<span class="number">68</span>:<span class="number">36</span>:<span class="number">90</span>:d5:<span class="number">9</span>f:<span class="number">17</span>:ea:a5:<span class="number">4</span>d:<span class="number">47</span>:<span class="number">71</span>:<span class="number">89</span>:</span><br><span class="line">     <span class="number">5</span>a:c9:bc:<span class="number">48</span>:d2:<span class="number">77</span>:<span class="number">54</span>:e4:<span class="number">9</span>e:cd:<span class="number">51</span>:af:de:f2:d9:e4:<span class="number">53</span>:<span class="number">95</span>:</span><br><span class="line">     <span class="number">46</span>:<span class="number">07</span>:a7:<span class="number">73</span>:<span class="number">6</span>a:<span class="number">8</span>b:b1:e5:<span class="number">51</span>:b5:fd:<span class="number">82</span>:c1:<span class="number">73</span>:<span class="number">1</span>e:<span class="number">62</span>:b6:<span class="number">0</span>d:</span><br><span class="line">     <span class="number">8</span>b:<span class="number">30</span>:e6:<span class="number">12</span>:f2:<span class="number">11</span>:d7:<span class="number">0</span>b:<span class="number">97</span>:<span class="number">2</span>c:<span class="number">97</span>:c3:b9:<span class="number">3</span>b:be:<span class="number">31</span>:<span class="number">4</span>a:a3:</span><br><span class="line">     <span class="number">89</span>:<span class="number">18</span>:<span class="number">8</span>b:ed:<span class="number">76</span>:<span class="number">95</span>:<span class="number">67</span>:e3:b5:<span class="number">53</span>:f4:<span class="number">33</span>:a1:<span class="number">0</span>a:aa:<span class="number">1</span>e:<span class="number">88</span>:<span class="number">37</span>:</span><br><span class="line">     f2:f4:d2:<span class="number">56</span>:<span class="number">18</span>:<span class="number">0</span>c:<span class="number">79</span>:<span class="number">84</span>:dd:<span class="number">7</span>a:<span class="number">9</span>a:<span class="number">2</span>f:<span class="number">99</span>:<span class="number">2</span>f:e5:fa:f6:<span class="number">9</span>a:</span><br><span class="line">     d5:ea:<span class="number">09</span>:b8</span><br></pre></td></tr></table></figure>

<ul>
<li>确认 <code>Issuer</code> 字段的内容和 <code>ca-csr.json</code> 一致；</li>
<li>确认 <code>Subject</code> 字段的内容和 <code>etcd-csr.json</code> 一致；</li>
<li>确认 <code>X509v3 Subject Alternative Name</code> 字段的内容和 <code>etcd-csr.json</code> 一致；</li>
<li>确认 <code>X509v3 Key Usage、Extended Key Usage</code> 字段的内容和 <code>ca-config.json</code> 中 <code>etcd-op</code>profile 一致；</li>
</ul>
<h4 id="2-3-2-使用cfssl-certinfo命令校验证书"><a href="#2-3-2-使用cfssl-certinfo命令校验证书" class="headerlink" title="2.3.2 使用cfssl-certinfo命令校验证书"></a>2.3.2 使用cfssl-certinfo命令校验证书</h4><p>执行命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">cfssl-certinfo -cert etcd.pem</span><br><span class="line">[root@cent7ax cfssl_dir.bak]# cfssl-certinfo -cert etcd.pem </span><br><span class="line">&#123;</span><br><span class="line"> &quot;subject&quot;: &#123;</span><br><span class="line"> &quot;common_name&quot;: &quot;etcd.freedom.com&quot;,</span><br><span class="line"> &quot;country&quot;: &quot;CN&quot;,</span><br><span class="line"> &quot;organization&quot;: &quot;etcd-op&quot;,</span><br><span class="line"> &quot;organizational_unit&quot;: &quot;System&quot;,</span><br><span class="line"> &quot;locality&quot;: &quot;BeiJing&quot;,</span><br><span class="line"> &quot;province&quot;: &quot;BeiJing&quot;,</span><br><span class="line"> &quot;names&quot;: [</span><br><span class="line"> &quot;CN&quot;,</span><br><span class="line"> &quot;BeiJing&quot;,</span><br><span class="line"> &quot;BeiJing&quot;,</span><br><span class="line"> &quot;etcd-op&quot;,</span><br><span class="line"> &quot;System&quot;,</span><br><span class="line"> &quot;etcd.freedom.com&quot;</span><br><span class="line"> ]</span><br><span class="line"> &#125;,</span><br><span class="line"> &quot;issuer&quot;: &#123;</span><br><span class="line"> &quot;common_name&quot;: &quot;etcd.freedom.com&quot;,</span><br><span class="line"> &quot;country&quot;: &quot;CN&quot;,</span><br><span class="line"> &quot;organization&quot;: &quot;etcd-op&quot;,</span><br><span class="line"> &quot;organizational_unit&quot;: &quot;System&quot;,</span><br><span class="line"> &quot;locality&quot;: &quot;BeiJing&quot;,</span><br><span class="line"> &quot;province&quot;: &quot;BeiJing&quot;,</span><br><span class="line"> &quot;names&quot;: [</span><br><span class="line"> &quot;CN&quot;,</span><br><span class="line"> &quot;BeiJing&quot;,</span><br><span class="line"> &quot;BeiJing&quot;,</span><br><span class="line"> &quot;etcd-op&quot;,</span><br><span class="line"> &quot;System&quot;,</span><br><span class="line"> &quot;etcd.freedom.com&quot;</span><br><span class="line"> ]</span><br><span class="line"> &#125;,</span><br><span class="line"> &quot;serial_number&quot;: &quot;234023291199234768277633047351258036366090605927&quot;,</span><br><span class="line"> &quot;sans&quot;: [</span><br><span class="line"> &quot;cent7ax&quot;,</span><br><span class="line"> &quot;cent7bx&quot;,</span><br><span class="line"> &quot;cent7cx&quot;,</span><br><span class="line"> &quot;extra-cent7ax&quot;,</span><br><span class="line"> &quot;extra-cent7bx&quot;,</span><br><span class="line"> &quot;extra-cent7cx&quot;,</span><br><span class="line"> &quot;127.0.0.1&quot;</span><br><span class="line"> ],</span><br><span class="line"> &quot;not_before&quot;: &quot;2020-11-25T01:47:00Z&quot;,</span><br><span class="line"> &quot;not_after&quot;: &quot;2040-11-20T01:47:00Z&quot;,</span><br><span class="line"> &quot;sigalg&quot;: &quot;SHA256WithRSA&quot;,</span><br><span class="line"> &quot;authority_key_id&quot;: &quot;F:D9:11:F9:9F:B8:72:B3:25:1:F2:3E:A:D0:E:7F:65:D2:91:A&quot;,</span><br><span class="line"> &quot;subject_key_id&quot;: &quot;F0:73:FD:7B:11:AF:96:CF:C7:BF:65:FE:BD:27:5C:39:44:D0:4:CC&quot;,</span><br><span class="line"> &quot;pem&quot;: &quot;-----BEGIN CERTIFICATE-----nMIIERjCCAy6gAwIBAgIUKP33oenyAwtRFhg3j2RGqbZylWcwDQYJKoZIhvcNAQELnBQAwbzELMAkGA1UEBhMCQ04xEDAOBgNVBAgTB0JlaUppbmcxEDAOBgNVBAcTB0JlnaUppbmcxEDAOBgNVBAoTB2V0Y2Qtb3AxDzANBgNVBAsTBlN5c3RlbTEZMBcGA1UEnAxMQZXRjZC5mcmVlZG9tLmNvbTAeFw0yMDExMjUwMTQ3MDBaFw00MDExMjAwMTQ3nMDBaMG8xCzAJBgNVBAYTAkNOMRAwDgYDVQQIEwdCZWlKaW5nMRAwDgYDVQQHEwdCnZWlKaW5nMRAwDgYDVQQKEwdldGNkLW9wMQ8wDQYDVQQLEwZTeXN0ZW0xGTAXBgNVnBAMTEGV0Y2QuZnJlZWRvbS5jb20wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKnAoIBAQDKT6IJnxJ8gagJTW/DlsBp2vydEDNMKla6BiA+L1IvFTahEYn3mFa2jziFnggIsrKixnnFt/uUGH6d6Ppy+4p11PmkbngbrABt0YMNszPj0ySwS0aoqcj9b4NBFnV/CtiG6gWcTkXVPLb+yO/jMyn5mt5jvKrX1LGYzrfZKOjgmLp0kqHnM16+NZT4e+njRLLI0H1NL8aTQTAfHCZj85Ryhx8mUUOsdeRY1hMo3NVy9GO697NW4k1ME1FCMYJn3uKw3laqE6w5y+UtBgYkY/rryCDguLtVv9GDSprcLFZsFnvjBlNV2NNX44IJP4uRnG7ho0Q+PmE4H/JRlaW+9Wac4CHknAgMBAAGjgdkwgdYwDgYDVR0PAQH/BAQDAgWgnMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjAMBgNVHRMBAf8EAjAAMB0GnA1UdDgQWBBTwc/17Ea+Wz8e/Zf69J1w5RNAEzDAfBgNVHSMEGDAWgBQP2RH5n7hynsyUB8j4K0A5/ZdKRCjBXBgNVHREEUDBOggdjZW50N2F4ggdjZW50N2J4ggdjZW50nN2N4gg1leHRyYS1jZW50N2F4gg1leHRyYS1jZW50N2J4gg1leHRyYS1jZW50N2N4nhwR/AAABMA0GCSqGSIb3DQEBCwUAA4IBAQCDzmJWYhxxzZ+DRHZ6e0Rgwmx4/5FinbI45YdTT+HTAcWXDgFDRLPPWQLwffjv24CyCT2uMCUgi1+qWupSZcp2uwgYVN3+bnIAKn12LrfX6TU18hgPi2HI1ALwl1Fts/TgEi0n2n6+JJ1gZ7PAcckLCuvJ13i6KpnXVfZGugKKh1ihtjduJ8UpM0jNqnExkDsGlj1oW7TN39oNpDVnxfqpU1HcYlaybxIn0ndU5J7NUa/e8tnkU5VGB6dzaoux5VG1/YLBcx5itg2LMOYS8hHXC5csl8O5O74xnSqOJGIvtdpVn47VT9DOhCqoeiDfy9NJWGAx5hN16mi+ZL+X69prV6gm4n-----END CERTIFICATE-----n&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-4-分发证书"><a href="#2-4-分发证书" class="headerlink" title="2.4 分发证书"></a>2.4 分发证书</h3><p>最后将上面签名生成的证书文件etcd.pem及其私钥文件etcd-key.pem 拷贝到集群所有需要的地方，即分发证书。典型使用场景有：</p>
<ul>
<li>etcd-server集群的安装部署</li>
<li>grpc servers集群的安装部署</li>
<li>kubernetes集群的安装部署</li>
</ul>
<p>等场景都需要使用证书认证。</p>
<hr>
<h2 id="k8s自签证书"><a href="#k8s自签证书" class="headerlink" title="k8s自签证书"></a>k8s自签证书</h2><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.modb.pro/db/50751">https://www.modb.pro/db/50751</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined" rel="external nofollow noreferrer">Waylon Yan</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://example.com/posts/17917.html">http://example.com/posts/17917.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener external nofollow noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%BD%91%E7%BB%9C/">网络</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/21999.html"><img class="prev-cover" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">Promethues01</div></div></a></div><div class="next-post pull-right"><a href="/posts/60060.html"><img class="next-cover" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">Kubernetes22-CICD相关</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://i.loli.net/2021/02/24/5O1day2nriDzjSu.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Waylon Yan</div><div class="author-info__description">tech life sharing</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">271</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">42</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">26</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Waylonwhynot" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:ywl1006@outlook.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">无止境</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#HTTPS%E9%80%9A%E4%BF%A1%E8%BF%87%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text">HTTPS通信过程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%8F%91%E8%B5%B7HTTPS%E8%AF%B7%E6%B1%82"><span class="toc-number">1.1.</span> <span class="toc-text">1. 客户端发起HTTPS请求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.</span> <span class="toc-text">2. 服务端的配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E4%BC%A0%E9%80%81%E8%AF%81%E4%B9%A6"><span class="toc-number">1.3.</span> <span class="toc-text">3. 传送证书</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%A7%A3%E6%9E%90%E8%AF%81%E4%B9%A6"><span class="toc-number">1.4.</span> <span class="toc-text">4. 客户端解析证书</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E4%BC%A0%E9%80%81%E5%8A%A0%E5%AF%86%E4%BF%A1%E6%81%AF"><span class="toc-number">1.5.</span> <span class="toc-text">5. 传送加密信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E6%9C%8D%E5%8A%A1%E7%AB%AF%E8%A7%A3%E5%AF%86%E4%BF%A1%E6%81%AF"><span class="toc-number">1.6.</span> <span class="toc-text">6. 服务端解密信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E4%BC%A0%E8%BE%93%E5%8A%A0%E5%AF%86%E5%90%8E%E7%9A%84%E4%BF%A1%E6%81%AF"><span class="toc-number">1.7.</span> <span class="toc-text">7. 传输加密后的信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%A7%A3%E5%AF%86%E4%BF%A1%E6%81%AF"><span class="toc-number">1.8.</span> <span class="toc-text">8. 客户端解密信息</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E8%AF%81%E4%B9%A6%E5%8D%B8%E8%BD%BD%EF%BC%9F"><span class="toc-number">2.</span> <span class="toc-text">什么是证书卸载？</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%87%AA%E7%AD%BE%E8%AF%81%E4%B9%A6"><span class="toc-number">3.</span> <span class="toc-text">自签证书</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-cfssl-%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">3.1.</span> <span class="toc-text">1. cfssl 是什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%AE%89%E8%A3%85cfssl%E8%BD%AF%E4%BB%B6%E5%B7%A5%E5%85%B7%E5%8C%85"><span class="toc-number">3.2.</span> <span class="toc-text">2. 安装cfssl软件工具包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%BD%BF%E7%94%A8cfssl%E5%88%9B%E5%BB%BA%E8%AF%81%E4%B9%A6%E5%AE%9E%E6%93%8D%E6%8C%87%E5%8D%97"><span class="toc-number">3.3.</span> <span class="toc-text">2. 使用cfssl创建证书实操指南</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%88%9B%E5%BB%BACA%E6%A0%B9%E8%AF%81%E4%B9%A6%E5%8F%8A%E5%85%B6%E7%A7%81%E9%92%A5"><span class="toc-number">3.3.1.</span> <span class="toc-text">2.1 创建CA根证书及其私钥</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-%E5%88%9B%E5%BB%BACA%E6%A0%B9%E8%AF%81%E4%B9%A6%E7%AD%BE%E5%90%8D%E8%AF%B7%E6%B1%82%E6%96%87%E4%BB%B6ca-csr-json"><span class="toc-number">3.3.1.1.</span> <span class="toc-text">2.1.1 创建CA根证书签名请求文件ca-csr.json</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-%E6%A0%B9%E6%8D%AECA%E6%A0%B9%E8%AF%81%E4%B9%A6%E7%AD%BE%E5%90%8D%E8%AF%B7%E6%B1%82%E6%96%87%E4%BB%B6%E7%94%9F%E6%88%90CA%E6%A0%B9%E8%AF%81%E4%B9%A6%E5%8F%8A%E5%85%B6%E7%A7%81%E9%92%A5"><span class="toc-number">3.3.1.2.</span> <span class="toc-text">2.1.2 根据CA根证书签名请求文件生成CA根证书及其私钥</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E6%A0%B9%E6%8D%AECA%E6%A0%B9%E8%AF%81%E4%B9%A6%E5%8F%8A%E5%85%B6%E7%A7%81%E9%92%A5%E7%AD%BE%E5%90%8D%E7%94%9F%E6%88%90%E5%85%B6%E5%AE%83%E8%AF%81%E4%B9%A6%E5%8F%8A%E5%85%B6%E7%A7%81%E9%92%A5"><span class="toc-number">3.3.2.</span> <span class="toc-text">2.2 根据CA根证书及其私钥签名生成其它证书及其私钥</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-%E5%88%9B%E5%BB%BACA%E6%A0%B9%E8%AF%81%E4%B9%A6%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">3.3.2.1.</span> <span class="toc-text">2.2.1 创建CA根证书配置文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-%E5%88%9B%E5%BB%BA%E7%9B%AE%E6%A0%87%E8%AF%81%E4%B9%A6%E7%AD%BE%E5%90%8D%E8%AF%B7%E6%B1%82%E6%96%87%E4%BB%B6"><span class="toc-number">3.3.2.2.</span> <span class="toc-text">2.2.2 创建目标证书签名请求文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-3-%E6%A0%B9%E6%8D%AECA%E6%A0%B9%E8%AF%81%E4%B9%A6%E5%8F%8A%E5%85%B6%E7%A7%81%E9%92%A5%E7%AD%BE%E5%90%8D%E7%94%9F%E6%88%90%E7%9B%AE%E6%A0%87%E8%AF%81%E4%B9%A6%E5%92%8C%E7%A7%81%E9%92%A5"><span class="toc-number">3.3.2.3.</span> <span class="toc-text">2.2.3 根据CA根证书及其私钥签名生成目标证书和私钥</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E6%A0%A1%E9%AA%8C%E8%AF%81%E4%B9%A6"><span class="toc-number">3.3.3.</span> <span class="toc-text">2.3 校验证书</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-%E4%BD%BF%E7%94%A8openssl%E5%91%BD%E4%BB%A4%E6%A0%A1%E9%AA%8C%E8%AF%81%E4%B9%A6"><span class="toc-number">3.3.3.1.</span> <span class="toc-text">2.3.1 使用openssl命令校验证书</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-%E4%BD%BF%E7%94%A8cfssl-certinfo%E5%91%BD%E4%BB%A4%E6%A0%A1%E9%AA%8C%E8%AF%81%E4%B9%A6"><span class="toc-number">3.3.3.2.</span> <span class="toc-text">2.3.2 使用cfssl-certinfo命令校验证书</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E5%88%86%E5%8F%91%E8%AF%81%E4%B9%A6"><span class="toc-number">3.3.4.</span> <span class="toc-text">2.4 分发证书</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#k8s%E8%87%AA%E7%AD%BE%E8%AF%81%E4%B9%A6"><span class="toc-number">3.4.</span> <span class="toc-text">k8s自签证书</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/3616160428.html" title="GO-37-常用标准库"><img src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="GO-37-常用标准库"/></a><div class="content"><a class="title" href="/posts/3616160428.html" title="GO-37-常用标准库">GO-37-常用标准库</a><time datetime="2025-08-25T18:47:50.000Z" title="Created 2025-08-26 02:47:50">2025-08-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/164398045.html" title="GO-36-包与工程化"><img src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="GO-36-包与工程化"/></a><div class="content"><a class="title" href="/posts/164398045.html" title="GO-36-包与工程化">GO-36-包与工程化</a><time datetime="2025-08-24T10:01:30.000Z" title="Created 2025-08-24 18:01:30">2025-08-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/2170744928.html" title="AI-09-Context-Engineering"><img src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI-09-Context-Engineering"/></a><div class="content"><a class="title" href="/posts/2170744928.html" title="AI-09-Context-Engineering">AI-09-Context-Engineering</a><time datetime="2025-08-12T17:34:58.000Z" title="Created 2025-08-13 01:34:58">2025-08-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/5677.html" title="AI-08-A2A"><img src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI-08-A2A"/></a><div class="content"><a class="title" href="/posts/5677.html" title="AI-08-A2A">AI-08-A2A</a><time datetime="2025-06-21T07:22:33.000Z" title="Created 2025-06-21 15:22:33">2025-06-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/18525.html" title="AI-07-MCP"><img src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AI-07-MCP"/></a><div class="content"><a class="title" href="/posts/18525.html" title="AI-07-MCP">AI-07-MCP</a><time datetime="2025-06-08T06:19:30.000Z" title="Created 2025-06-08 14:19:30">2025-06-08</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By Waylon Yan</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Local search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>