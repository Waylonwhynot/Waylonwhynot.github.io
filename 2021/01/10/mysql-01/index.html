<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"waylon.whatyouneed.site","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="sql 库表操作">
<meta property="og:type" content="article">
<meta property="og:title" content="mysql-01">
<meta property="og:url" content="https://waylon.whatyouneed.site/2021/01/10/mysql-01/index.html">
<meta property="og:site_name" content="YouNeed">
<meta property="og:description" content="sql 库表操作">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/waylon1006/blog_pic/raw/master/pic/image-20210423085136177.png">
<meta property="og:image" content="https://gitee.com/waylon1006/blog_pic/raw/master/pic/image-20210426172326630.png">
<meta property="og:image" content="https://gitee.com/waylon1006/blog_pic/raw/master/pic/image-20210426172403230.png">
<meta property="article:published_time" content="2021-01-10T06:10:53.000Z">
<meta property="article:modified_time" content="2021-04-26T12:19:03.637Z">
<meta property="article:author" content="Waylon Yan">
<meta property="article:tag" content="note">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/waylon1006/blog_pic/raw/master/pic/image-20210423085136177.png">

<link rel="canonical" href="https://waylon.whatyouneed.site/2021/01/10/mysql-01/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>mysql-01 | YouNeed</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
    <a target="_blank" rel="noopener" href="https://github.com/Waylonwhynot" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#FD6C6C; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">YouNeed</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">what</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://waylon.whatyouneed.site/2021/01/10/mysql-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/timg.jpeg">
      <meta itemprop="name" content="Waylon Yan">
      <meta itemprop="description" content="tech life sharing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YouNeed">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          mysql-01
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-01-10 14:10:53" itemprop="dateCreated datePublished" datetime="2021-01-10T14:10:53+08:00">2021-01-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-26 20:19:03" itemprop="dateModified" datetime="2021-04-26T20:19:03+08:00">2021-04-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index"><span itemprop="name">mysql</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>39k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1:04</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>sql 库表操作</p>
<a id="more"></a>

<h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SQL语言主要用于存取数据、查询数据、更新数据和管理关系数据库系统,SQL语言由IBM开发。SQL语言分为3种类型：</span><br><span class="line"><span class="meta">#</span><span class="bash">1、DDL语句    数据库定义语言： 数据库、表、视图、索引、存储过程，例如CREATE DROP ALTER</span></span><br><span class="line"><span class="meta">#</span><span class="bash">2、DML语句    数据库操纵语言： 插入数据INSERT、删除数据DELETE、更新数据UPDATE、查询数据SELECT</span></span><br><span class="line"><span class="meta">#</span><span class="bash">3、DCL语句    数据库控制语言： 例如控制用户的访问权限GRANT、REVOKE</span></span><br></pre></td></tr></table></figure>



<h2 id="基本库表语句"><a href="#基本库表语句" class="headerlink" title="基本库表语句"></a>基本库表语句</h2><p>1、mysql是什么？<br>    mysql本质就是一个c/s架构的套接字软件</p>
<p>2、数据库基本概念<br>    数据库服务器： 运行有数据库管理软件的计算机<br>    数据库管理软件：mysql<br>    库：文件夹<br>    表：文件<br>    记录：文件中的一行的内容</p>
<p>3、针对库、表、记录的操作</p>
<blockquote>
<p>库</p>
</blockquote>
<p>数据库命名规则：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">可以由字母、数字、下划线、＠、＃、＄</span><br><span class="line">区分大小写</span><br><span class="line">唯一性</span><br><span class="line">不能使用关键字如 create select</span><br><span class="line">不能单独使用数字</span><br><span class="line">最长128位</span><br></pre></td></tr></table></figure>

<p>数据库相关操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">增</span><br><span class="line">    create database db12 charset utf8;</span><br><span class="line">改</span><br><span class="line">    alter database db12 charset gbk;</span><br><span class="line">查</span><br><span class="line">    show databases;</span><br><span class="line">    show create database db12;</span><br><span class="line">    select database();</span><br><span class="line">删</span><br><span class="line">    drop database db12;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>表</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">文件：</span><br><span class="line">    use db1; # 切换文件夹</span><br><span class="line"></span><br><span class="line">    增</span><br><span class="line">        create table t1(id int,name char(16));</span><br><span class="line">    改</span><br><span class="line">        alter table db1.t1 modify name char(15);</span><br><span class="line">        alter table db1.t1 change name NAME char(10);</span><br><span class="line">        alter table db1.t1 rename db1.t2;</span><br><span class="line">    查</span><br><span class="line">        show tables;</span><br><span class="line">        show create table t1; # 查看创表语句</span><br><span class="line">        desc t1;</span><br><span class="line">        desc db1.t1;</span><br><span class="line"></span><br><span class="line">    删</span><br><span class="line">        drop table db1.t1;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>记录</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">文件中一行行内容</span><br><span class="line">    增</span><br><span class="line">        insert into db1.t1(id,name) values</span><br><span class="line">        (1,&#39;egon&#39;),</span><br><span class="line">        (2,&#39;alexdsb&#39;),</span><br><span class="line">        (3,&#39;wxxsb&#39;);</span><br><span class="line"></span><br><span class="line">        insert into db1.t1(name) values</span><br><span class="line">        (&#39;egon&#39;),</span><br><span class="line">        (&#39;alexdsb&#39;),</span><br><span class="line">        (&#39;wxxsb&#39;);</span><br><span class="line">    改</span><br><span class="line">        update db1.t1 set name&#x3D;&#39;SB&#39; where id&#x3D;3;</span><br><span class="line">    查</span><br><span class="line">        select id,name from db1.t1;</span><br><span class="line"></span><br><span class="line">    删</span><br><span class="line">        delete from db1.t1 where id &gt;&#x3D; 2;</span><br><span class="line"></span><br><span class="line">        # delete 只能用于删除符合条件的某几条记录，不能用于清空表</span><br><span class="line">        delete from t1;</span><br><span class="line"></span><br><span class="line">        # 清空表应该使用truncate,不仅删除所有记录，而且将自增字段的值归0</span><br><span class="line">        truncate t1;</span><br></pre></td></tr></table></figure>



<h2 id="存储引擎"><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h2><p>存储引擎就是表的类型(例如文件类型txt pdf)<br> 不同的类型会对应不同处理机制</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"># 查看存储引擎</span><br><span class="line">show engines;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">* myisam</span><br><span class="line"># 5.5之前默认</span><br><span class="line">      create table t4(id int)engine&#x3D;&#39;myisam&#39;;</span><br><span class="line">      特点: 速度比innodb快, 但是我们更加注重数据的安全</span><br><span class="line">      文件特点: t4.frm 表结构 </span><br><span class="line">               t4.MYD 表数据</span><br><span class="line">               t4.MYI 索引</span><br><span class="line">      存数据特点: insert into t4 values(1);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">* innodb</span><br><span class="line"># 5.5之后默认</span><br><span class="line">      create table t3(id int)engine&#x3D;&#39;innodb&#39;;</span><br><span class="line">      特点: 存储数据更加安全; 支持事务(数据安全),行级锁(数据安全), 外键(数据与数据之间的联系)</span><br><span class="line">      文件特点: t3.frm 表结构 </span><br><span class="line">               t3.MYD 表数据</span><br><span class="line">      存数据特点: insert into t3 values(1);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">* blackhole</span><br><span class="line"># 黑洞  无论存什么，都立刻消失</span><br><span class="line">      create table t5(id int)engine&#x3D;&#39;blackhole&#39;;</span><br><span class="line">      文件特点: t5.frm  只有表结构 </span><br><span class="line">      存数据特点: insert into t5 values(1); 数据没有</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">* memory</span><br><span class="line"># 内存引擎(全部存在内存中) 断电数据丢失</span><br><span class="line">      create table t6(id int)engine&#x3D;&#39;memory&#39;;</span><br><span class="line">      文件特点: t6.frm 只有表结构 </span><br><span class="line">      存数据特点: insert into t6 values(1); 重启数据丢失</span><br></pre></td></tr></table></figure>

<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><p>建表的完整语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create table 表名(</span><br><span class="line"> 字段名1 类型[(宽度) 约束条件],</span><br><span class="line"> 字段名2 类型[(宽度) 约束条件],</span><br><span class="line"> 字段名3 类型[(宽度) 约束条件]</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：</p>
<ul>
<li><p>同一张表字段名不能重复</p>
</li>
<li><p>宽度和约束条件是可选的；字段名必须的；</p>
<ul>
<li>约束条件支持多个<ul>
<li>字段名1 类型[(宽度) 约束条件1 约束条件2….</li>
</ul>
</li>
</ul>
</li>
<li><p>建表时最后一个字段后一定不要加逗号</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">补充：</span><br><span class="line">    宽度一般是对存储数据的限制，</span><br><span class="line">    create table t7(name char); 默认宽度<span class="number">1</span></span><br><span class="line">    insert into t7 values(<span class="string">&#x27;jason&#x27;</span>);</span><br><span class="line">    5.6 --&gt; 默认没有开启严格模式 规定只能存一个字符 你给了多个字符，那么自动截取</span><br><span class="line">    5.7 --&gt; 默认开启了严格模式，那么规定只能存几个，就不能超，否则报错 Data too long for column &#x27;name&#x27; at row 1</span><br><span class="line">    </span><br><span class="line"><span class="string">&quot;&quot;&quot;严格模式到底开否？&quot;&quot;&quot;</span></span><br><span class="line">MySQL <span class="number">5.7</span>以后默认开启；要开，少让DB干活。</span><br><span class="line"></span><br><span class="line"><span class="comment"># 约束条件 null not null</span></span><br><span class="line">create table t8（id int, name char <span class="keyword">not</span> null）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">宽度：限制数据存储</span></span><br><span class="line"><span class="string">约束条件：在宽度的基础之上增加额外的约束</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">设置sql模式为严格模式</span><br><span class="line">show variables like <span class="string">&quot;%mode&quot;</span>;</span><br><span class="line"><span class="comment"># 全局设置</span></span><br><span class="line">set <span class="keyword">global</span> sql_mode=<span class="string">&quot;strict_trans_tables&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者修改配置文件</span></span><br><span class="line">sql_mode=STRICT_TRANS_TABLES</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">需要重启客户端，会重新加载sql_mode</span><br></pre></td></tr></table></figure>



<h3 id="数字类型"><a href="#数字类型" class="headerlink" title="数字类型"></a>数字类型</h3><ul>
<li>整型（默认有符号）  int占用4字节<ul>
<li>TINYINT SMALLINT MEDUIMINT INT BIGINT</li>
<li>年龄，等级，id，号码</li>
</ul>
</li>
<li>浮点型                        float占用4字节<ul>
<li>FLOAT DOUBLE DECIMAL</li>
<li>身高，体重，薪资</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">1.1 整型</span><br><span class="line">    强调：对于整型类型来说，无序指定宽度，默认宽度足够显示。</span><br><span class="line">         数据类型的宽度限制的是显示宽度而非存储宽度</span><br><span class="line">         id int(8)</span><br><span class="line">            如果数字没有超出8位，那么默认用空格填充至8位</span><br><span class="line">            超出，有几位存几位（遵守最大范围）</span><br><span class="line">         </span><br><span class="line">    </span><br><span class="line"># tinyint</span><br><span class="line">    create table t7(id tinyint);</span><br><span class="line">    insert into t7 values(-129),(256);</span><br><span class="line">    结论：默认有符号，超出限制只存最大值</span><br><span class="line">    </span><br><span class="line"># tinyint 无符号</span><br><span class="line">    create table t8(id tinyint unsigned);</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"># int</span><br><span class="line">    create table t1(id int);</span><br><span class="line">    insert into t1 values(-1),(256);</span><br><span class="line">    结论：默认有符号，可以存负数</span><br><span class="line"></span><br><span class="line"># int 无符号</span><br><span class="line">    create table t2(id int unsigned);</span><br><span class="line">    insert into t2 values(4294967295);</span><br><span class="line">    # 用0 填充</span><br><span class="line">    create table t10(id int(3) unsigned zerofill);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">1.2 浮点型（数的宽度-包含小数，小数位)</span><br><span class="line"></span><br><span class="line">    create table t14(x float(255,30));   # 总共255位，小数30位，整数位就是225</span><br><span class="line">    create table t15(x double(255,30));  # 总共255位，小数30位，整数位就是225</span><br><span class="line">    create table t16(x decimal(65,30));  # 总共65位，小数30位，整数位就是35</span><br><span class="line"></span><br><span class="line">    insert into t14 values(1.111111111111111111111111111111);</span><br><span class="line">    insert into t15 values(1.111111111111111111111111111111);</span><br><span class="line">    insert into t16 values(1.111111111111111111111111111111);</span><br><span class="line">    </span><br><span class="line">    float &lt; double &lt; decimal </span><br><span class="line">    # 要结合实际场景  三者都能用</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/waylon1006/blog_pic/raw/master/pic/image-20210423085136177.png" alt="image-20210423085136177"></p>
<h3 id="字符类型：char-定长-，varchar-变长"><a href="#字符类型：char-定长-，varchar-变长" class="headerlink" title="字符类型：char(定长)，varchar(变长)"></a>字符类型：char(定长)，varchar(变长)</h3><p><strong>ps</strong>: 现在用vachar比较多</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">varchar不一定更省内存，当存储额数据刚好到达限制的时候,varchar刚好大一个头部信息1-2bytes    varchar(4) char(4) 存储&#39;abcd&#39;</span><br><span class="line"></span><br><span class="line">char(5)</span><br><span class="line">    优点： 存取都很简单，直接按照固定的字符存取数据即可</span><br><span class="line">    缺点： 浪费空间</span><br><span class="line">    相同点：最大能存放5个字符</span><br><span class="line">    不同点：char 定长</span><br><span class="line">        传入3个字符，那么用空格补全两个空格</span><br><span class="line">        </span><br><span class="line">varchar(5)</span><br><span class="line">    优点: 节省空间</span><br><span class="line">    缺点: 存取较为麻烦（存的时候需要制作报头，取的时候也需要先读取报头，之后才能读取真实数据）</span><br><span class="line">    相同点:最大能存放5个字符</span><br><span class="line">    不同点：</span><br><span class="line">        varchar变长</span><br><span class="line">        传入3个字符，就存3个字符</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">create table t22(x char(5));</span><br><span class="line">create table t23(x varchar(5));</span><br><span class="line"></span><br><span class="line">insert into t22 values(&#39;a&#39;);</span><br><span class="line">insert into t23 values(&#39;a&#39;);</span><br><span class="line"></span><br><span class="line"># 统计字段长度</span><br><span class="line">select char_length(x) from t22;</span><br><span class="line">select char_length(x) from t23;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">注意:</span><br><span class="line">1.</span><br><span class="line">    针对char类型，在存放时会将字符补全为5个，然后在查询时又会将末尾补全的空格去掉，如果不想让mysql</span><br><span class="line">    去掉末尾的空格，应该修改sql模式</span><br><span class="line">    set global sql_mode&#x3D;&quot;strict_trans_tables,PAD_CHAR_TO_FULL_LENGTH&quot;</span><br><span class="line"></span><br><span class="line">2.</span><br><span class="line">    查询语句中where  字段&#x3D;“值    ”，会将值右面的空格去掉后再做比较</span><br><span class="line">egon</span><br><span class="line">alex</span><br><span class="line">lxx</span><br><span class="line"></span><br><span class="line">char(5)</span><br><span class="line">egon |alex |lxx  |</span><br><span class="line"></span><br><span class="line">varchar(5)</span><br><span class="line">1bytes+egon|1bytes+alex|1bytes+lxx|</span><br><span class="line"> </span><br></pre></td></tr></table></figure>



<h3 id="日期类型：time，date，datetime，timestamp，year"><a href="#日期类型：time，date，datetime，timestamp，year" class="headerlink" title="日期类型：time，date，datetime，timestamp，year"></a>日期类型：time，date，datetime，timestamp，year</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">date:     年月日      2020-5-4</span><br><span class="line">datetime: 年月日时分秒 2020-5-4 11:12:32</span><br><span class="line">time:     时分秒      11:12:32</span><br><span class="line">timestamp:</span><br><span class="line">year:     2020</span><br><span class="line"></span><br><span class="line">create table student(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    name char(16),</span><br><span class="line">    born_year year,</span><br><span class="line">    class_time time,</span><br><span class="line">    birth date,</span><br><span class="line">    reg_time datetime</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">create table stu(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    name char(16),</span><br><span class="line">    born_year year,</span><br><span class="line">    class_time time,</span><br><span class="line">    birth date,</span><br><span class="line">    reg_time datetime</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">insert into student(name,born_year,class_time,birth,reg_time) values</span><br><span class="line">(&#39;egon1&#39;,now(),now(),now(),now());</span><br><span class="line"></span><br><span class="line">create table t17(x datetime);</span><br><span class="line">create table t18(x timestamp);</span><br><span class="line">create table t19(x datetime not null default now());</span><br></pre></td></tr></table></figure>



<h3 id="枚举类型enum与集合类型set"><a href="#枚举类型enum与集合类型set" class="headerlink" title="枚举类型enum与集合类型set"></a>枚举类型enum与集合类型set</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">enum:多选一</span><br><span class="line">set：多选多</span><br><span class="line"></span><br><span class="line">create table emp(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    name char(16),</span><br><span class="line">    sex enum(&#39;male&#39;,&#39;female&#39;,&#39;unknow&#39;),</span><br><span class="line">    hobbies set(&#39;play&#39;,&#39;read&#39;,&#39;sleep&#39;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">insert into emp(name,sex,hobbies) values</span><br><span class="line">(&#39;egon&#39;,&#39;male&#39;,&#39;play,read&#39;);</span><br></pre></td></tr></table></figure>




<h2 id="表操作之约束条件"><a href="#表操作之约束条件" class="headerlink" title="表操作之约束条件"></a>表操作之约束条件</h2><p><strong>约束条件：约束条件是在类型之外为字段附加的限制</strong></p>
<h3 id="default"><a href="#default" class="headerlink" title="default"></a>default</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">create table t2(</span><br><span class="line">    id int,</span><br><span class="line">    name char(16),</span><br><span class="line">    gender enum(&#39;male&#39;, &#39;female&#39;, &#39;others&#39;) default &#39;male&#39;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">insert into t2(id, name) values(1, &#39;alex&#39;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="not-null"><a href="#not-null" class="headerlink" title="not null"></a>not null</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">非空</span><br></pre></td></tr></table></figure>

<h3 id="zerofill"><a href="#zerofill" class="headerlink" title="zerofill"></a>zerofill</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 用0 填充</span><br><span class="line">create table t10(id int(3) unsigned zerofill);</span><br></pre></td></tr></table></figure>

<h3 id="unsigned"><a href="#unsigned" class="headerlink" title="unsigned"></a>unsigned</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># int 无符号</span><br><span class="line">    create table t2(id int unsigned);</span><br><span class="line">    insert into t2 values(4294967295);</span><br></pre></td></tr></table></figure>



<p>###unique key（单列唯一，联合唯一）</p>
<h4 id="单列唯一"><a href="#单列唯一" class="headerlink" title="单列唯一"></a>单列唯一</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;设置唯一约束 UNIQUE&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">方法一：</span><br><span class="line">create table department1(</span><br><span class="line">id int,</span><br><span class="line">name varchar(20) unique,</span><br><span class="line">comment varchar(100)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">方法二：</span><br><span class="line">create table department2(</span><br><span class="line">id int,</span><br><span class="line">name varchar(20),</span><br><span class="line">comment varchar(100),</span><br><span class="line">constraint uk_name unique(name)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; insert into department1 values(1,&#39;IT&#39;,&#39;技术&#39;);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">mysql&gt; insert into department1 values(1,&#39;IT&#39;,&#39;技术&#39;);</span><br><span class="line">ERROR 1062 (23000): Duplicate entry &#39;IT&#39; for key &#39;name&#39;</span><br><span class="line"></span><br><span class="line">create table t25(x char(5) unique);</span><br><span class="line">create table t26(</span><br><span class="line">    x int,</span><br><span class="line">    y char(5),</span><br><span class="line">    constraint uni_x unique key(x)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="联合唯一"><a href="#联合唯一" class="headerlink" title="联合唯一"></a>联合唯一</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table services(</span><br><span class="line">    id int,</span><br><span class="line">    name char(16),</span><br><span class="line">    ip char(15),</span><br><span class="line">    port int,</span><br><span class="line">    unique key(ip,port)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="not-null-unqiue-化学反应"><a href="#not-null-unqiue-化学反应" class="headerlink" title="not null +  unqiue 化学反应"></a>not null +  unqiue 化学反应</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table t1(id int not null unique);</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; desc t1;</span><br><span class="line">+-------+---------+------+-----+---------+-------+</span><br><span class="line">| Field | Type    | Null | Key | Default | Extra |</span><br><span class="line">+-------+---------+------+-----+---------+-------+</span><br><span class="line">| id    | int(11) | NO   | PRI | NULL    |       |</span><br><span class="line">+-------+---------+------+-----+---------+-------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">not null+unique的化学反应</span><br><span class="line">create table service(</span><br><span class="line">id int primary key auto_increment,</span><br><span class="line">name varchar(20),</span><br><span class="line">host varchar(15) not null,</span><br><span class="line">port int not null,</span><br><span class="line">unique(host,port) #联合唯一</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into service values</span><br><span class="line">    -&gt; (1,&#39;nginx&#39;,&#39;192.168.0.10&#39;,80),</span><br><span class="line">    -&gt; (2,&#39;haproxy&#39;,&#39;192.168.0.20&#39;,80),</span><br><span class="line">    -&gt; (3,&#39;mysql&#39;,&#39;192.168.0.30&#39;,3306)</span><br><span class="line">    -&gt; ;</span><br><span class="line">Query OK, 3 rows affected (0.01 sec)</span><br><span class="line">Records: 3  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into service(name,host,port) values(&#39;nginx&#39;,&#39;192.168.0.10&#39;,80);</span><br><span class="line">ERROR 1062 (23000): Duplicate entry &#39;192.168.0.10-80&#39; for key &#39;host&#39;</span><br></pre></td></tr></table></figure>

<h3 id="primary-key"><a href="#primary-key" class="headerlink" title="primary key"></a>primary key</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">create table t5(id int primary key);</span><br><span class="line">insert into t5 values(null);</span><br><span class="line">insert into t5 values(1),(2);</span><br><span class="line"></span><br><span class="line">强调：</span><br><span class="line">1. 约束效果上看  primary key =  not null + unique</span><br><span class="line"></span><br><span class="line">2. primary key是innodb存储引擎组织数据的一句</span><br><span class="line">   (1).那么在创建表时，必须定义一个主键且只有一个主键</span><br><span class="line">   (2).没有设置主键时</span><br><span class="line">       1.innodb存储引擎会自上而下寻找一个 不为空且唯一的字段 自动当做主键</span><br><span class="line">       2. 如果不指定并且也没有not null+unique的字段，那么innodb存储引擎会生成一个隐藏的字段当做主键。原因是innodb存储引擎会以主键为准创建聚集索引</span><br><span class="line">       3. 一张表中通常应该有一个id字段并且该字段应该是主键</span><br><span class="line"></span><br><span class="line">3. auto_increment 自增</span><br><span class="line">   注意 auto_increment 通常是加在设置成key键的字段上,不能给普通字段加. 并且一般跟主键一起使用。</span><br><span class="line">     eg: id int primary_key auto_increment;</span><br><span class="line"></span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">age 会自动成为主键</span><br><span class="line">create table t3 (</span><br><span class="line">   id int,</span><br><span class="line">   name char(16),</span><br><span class="line">   age int not null unique,</span><br><span class="line">   addr char(32) not null unique</span><br><span class="line">);</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 联合主键(多个字段联合起来作为表的主键，本质还是一个主键)（用的不多）</span></span><br><span class="line">create table t4(</span><br><span class="line">   ip char(16),</span><br><span class="line">   port int,</span><br><span class="line">   primary key(ip,port)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 必须由主键的原因</span></span><br><span class="line">原因:</span><br><span class="line">    为什么一定要有主键,因为MySQL考虑到,你以后要查询的时候会用到。总需要有一个字段作为依据，这个字段就是主键,以这个字段为基础，建立B+tree索引结构，意义是按照主键字段查询的时候可以加速查询。Innodb存储引擎建表的时候一定要有主键，Mysql就会以ID字段为基准造索引，以ID字段查的时候就会用到。</span><br></pre></td></tr></table></figure>

<blockquote>
<p>补充</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">delete from 在删除表中数据的时候，主键的自增并不会停止</span><br><span class="line">truncate t1 清空表数据并且重置主键</span><br></pre></td></tr></table></figure>

<p>###foreign key(帮助建立表与表关系的字段)</p>
<p>背景：</p>
<p>假设我们要描述所有公司的员工，需要描述的属性有这些 ： 工号 姓名 部门</p>
<p>公司有3个部门，但是有1个亿的员工，那意味着部门这个字段需要重复存储，部门名字越长，越浪费</p>
<p>问题: </p>
<ol>
<li><p>一张表组织结构不是很清晰</p>
</li>
<li><p>浪费硬盘空间</p>
</li>
<li><p>数据的扩展性极差(无法忽视)</p>
</li>
</ol>
<p>解决方法： 我们完全可以定义一个部门表 然后让员工信息表关联该表，如何关联，即foreign key</p>
<blockquote>
<p>表与表关系</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">一对多（**外键建在多的一方**）</span><br><span class="line">多对多（**单独一张表存储关系**）</span><br><span class="line">一对一（**外键建在任意一方，通常航建立在查询较多的表中**）</span><br><span class="line">没有</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如何找出两张表的关系</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">分析步骤：必须双向对比</span><br><span class="line">#1、先站在左表的角度去找</span><br><span class="line">是否左表的多条记录可以对应右表的一条记录，如果是，则证明左表的一个字段foreign key 右表一个字段（通常是id）</span><br><span class="line"></span><br><span class="line">#2、再站在右表的角度去找</span><br><span class="line">是否右表的多条记录可以对应左表的一条记录，如果是，则证明右表的一个字段foreign key 左表一个字段（通常是id）</span><br><span class="line"></span><br><span class="line">#3、总结：</span><br><span class="line">#多对一：</span><br><span class="line">如果只有步骤1成立，则是左表多对一右表</span><br><span class="line">如果只有步骤2成立，则是右表多对一左表</span><br><span class="line"></span><br><span class="line">#多对多</span><br><span class="line">如果步骤1和2同时成立，则证明这两张表时一个双向的多对一，即多对多,需要定义一个这两张表的关系表来专门存放二者的关系</span><br><span class="line"></span><br><span class="line">#一对一:</span><br><span class="line">如果1和2都不成立，而是左表的一条记录唯一对应右表的一条记录，反之亦然。这种情况很简单，就是在左表foreign key右表的基础上，将左表的外键字段设置成unique即可</span><br></pre></td></tr></table></figure>

<h4 id="一对多（外键建在多的一方）-级联"><a href="#一对多（外键建在多的一方）-级联" class="headerlink" title="一对多（外键建在多的一方）  级联"></a>一对多（<strong>外键建在多的一方</strong>）  级联</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">create table dep(</span><br><span class="line">   id int primary key auto_increment,</span><br><span class="line">   dep_name char(16),</span><br><span class="line">   dep_desc char(32)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">create table emp(</span><br><span class="line">   id int primary key auto_increment,</span><br><span class="line">   name char(16),</span><br><span class="line">   gender enum(&#39;male&#39;,&#39;female&#39;,&#39;others&#39;) default &#39;male&#39;,</span><br><span class="line">   dep_id int,</span><br><span class="line">   foreign key(dep_id) references dep(id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">insert into dep values</span><br><span class="line">(1,&#39;欧德博爱技术有限事业部&#39;,&#39;教书育人&#39;),</span><br><span class="line">(2,&#39;艾利克斯人力资源部&#39;, &#39;不做人&#39;),</span><br><span class="line">(3,&#39;销售部&#39;, &#39;忽悠人&#39;);</span><br><span class="line"></span><br><span class="line">insert into emp (id,name,dep_id) values</span><br><span class="line">(1,&#39;egon&#39;,1),</span><br><span class="line">(2,&#39;alex1&#39;,2),</span><br><span class="line">(3,&#39;alex2&#39;,2),</span><br><span class="line">(4,&#39;alex3&#39;,2),</span><br><span class="line">(5,&#39;李坦克&#39;,3),</span><br><span class="line">(6,&#39;刘飞机&#39;,3),</span><br><span class="line">(7,&#39;张火箭&#39;,3),</span><br><span class="line">(8,&#39;林子弹&#39;,3),</span><br><span class="line">(9,&#39;加特林&#39;,3)</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"># 修改dep表里面的id字段</span><br><span class="line">update dep set id&#x3D;200 where id&#x3D;2; 不行</span><br><span class="line"># 删除dep表里面的数据</span><br><span class="line">delete from dep;  不行</span><br><span class="line"># 1. 先删除销售部对应的员工数据 之后删除部门</span><br><span class="line">  操作太过繁琐</span><br><span class="line"># 2. 真正做到数据之间有关系</span><br><span class="line">  更新就同步更新-级联更新</span><br><span class="line">  删除就同步删除-级联删除</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">create table dep(</span><br><span class="line">   id int primary key auto_increment,</span><br><span class="line">   dep_name char(16),</span><br><span class="line">   dep_desc char(32)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">create table emp(</span><br><span class="line">   id int primary key auto_increment,</span><br><span class="line">   name char(16),</span><br><span class="line">   gender enum(&#39;male&#39;,&#39;female&#39;,&#39;others&#39;) default &#39;male&#39;,</span><br><span class="line">   dep_id int,</span><br><span class="line">   foreign key(dep_id) references dep(id)</span><br><span class="line">   on update cascade  # 级联更新</span><br><span class="line">   on delete cascade  # 级联删除</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a>多对多</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">create table book(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    title varchar(32),</span><br><span class="line">    price int</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">create table author(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    name varchar(32),</span><br><span class="line">    age int</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">create table book2author(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    author_id int,</span><br><span class="line">    book_id int,</span><br><span class="line">    foreign key(author_id) references author(id)</span><br><span class="line">    on update cascade  # 级联更新</span><br><span class="line">    on delete cascade,  # 级联删除</span><br><span class="line">    foreign key(book_id) references book(id)</span><br><span class="line">    on update cascade  # 级联更新</span><br><span class="line">    on delete cascade</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 插入数据</span><br><span class="line">insert into author(name,age) values(&#39;jason&#39;,18),(&#39;egon&#39;,73);</span><br><span class="line">insert into book(title,price) values(&#39;jpm&#39;, 555),(&#39;xxx&#39;,123),(&#39;qwe&#39;,456);</span><br><span class="line">insert into book2author(author_id, book_id) values(1,1),(1,2),(1,3),(2,1),(2,3);</span><br></pre></td></tr></table></figure>

<h4 id="一对一-外键字段在任何一方都可以，建议建在查询频率比较高的表中"><a href="#一对一-外键字段在任何一方都可以，建议建在查询频率比较高的表中" class="headerlink" title="一对一: 外键字段在任何一方都可以，建议建在查询频率比较高的表中"></a>一对一: <strong>外键字段在任何一方都可以，建议建在查询频率比较高的表中</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">如果一个表的字段特别多 每次查询又不是所有的字段都能用的到</span><br><span class="line">将表一分为二</span><br><span class="line"># 示例1</span><br><span class="line">用户表</span><br><span class="line">     用户表</span><br><span class="line">     id name age</span><br><span class="line">     用户详情表</span><br><span class="line">     id addr phone hobby email.....</span><br><span class="line">关联方式：foreign key+unique</span><br><span class="line"></span><br><span class="line">create table authordetail(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    phone int,</span><br><span class="line">    addr varchar(64)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">create table authors(</span><br><span class="line">    id int primary key auto_increment,</span><br><span class="line">    name varchar(32),</span><br><span class="line">    age int,</span><br><span class="line">    authordetail_id int unique,</span><br><span class="line">    foreign key(authordetail_id) references authordetail(id)</span><br><span class="line">    on update cascade  # 级联更新</span><br><span class="line">    on delete cascade</span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<h4 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;&quot;</span><br><span class="line">表与表如果有关系的话，可以有两种建立联系的方式</span><br><span class="line">    1.通过外键强制性的建立关系</span><br><span class="line">    2.通过sql语句逻辑层面上建立联系，必须多写几条sql语句，动一条数据，相关联数据也通过sql删除</span><br><span class="line">      delete from emp where id&#x3D;1;</span><br><span class="line">      delete from dep where id&#x3D;1;</span><br><span class="line"></span><br><span class="line">创建外键需要消耗一定的资源 并且增加了表与表之间的耦合度</span><br><span class="line">在实际项目中，如果表特别多  其实可以不做任何外键处理，直接通过sql语句来建立逻辑层面上的关系</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>引用其他博客：</p>
</blockquote>
<h4 id="创造外键的条件"><a href="#创造外键的条件" class="headerlink" title="创造外键的条件"></a>创造外键的条件</h4><pre><code>mysql&gt; create table departments (dep_id int(4),dep_name varchar(11));
Query OK, 0 rows affected (0.02 sec)

mysql&gt; desc departments;
+----------+-------------+------+-----+---------+-------+
| Field    | Type        | Null | Key | Default | Extra |
+----------+-------------+------+-----+---------+-------+
| dep_id   | int(4)      | YES  |     | NULL    |       |
| dep_name | varchar(11) | YES  |     | NULL    |       |
+----------+-------------+------+-----+---------+-------+
rows in set (0.00 sec)

# 创建外键不成功
mysql&gt; create table staff_info (s_id int,name varchar(20),dep_id int,foreign key(dep_id) references departments(dep_id));
ERROR 1215 (HY000): Cannot add foreign key 

# 设置dep_id非空，仍然不能成功创建外键
mysql&gt; alter table departments modify dep_id int(4) not null;
Query OK, 0 rows affected (0.02 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql&gt; desc departments;
+----------+-------------+------+-----+---------+-------+
| Field    | Type        | Null | Key | Default | Extra |
+----------+-------------+------+-----+---------+-------+
| dep_id   | int(4)      | NO   |     | NULL    |       |
| dep_name | varchar(11) | YES  |     | NULL    |       |
+----------+-------------+------+-----+---------+-------+
rows in set (0.00 sec)

mysql&gt; create table staff_info (s_id int,name varchar(20),dep_id int,foreign key(dep_id) references departments(dep_id));
ERROR 1215 (HY000): Cannot add foreign key constraint

# 当设置字段为unique唯一字段时，设置该字段为外键成功
mysql&gt; alter table departments modify dep_id int(4) unique;
Query OK, 0 rows affected (0.01 sec)
Records: 0  Duplicates: 0  Warnings: 0

mysql&gt; desc departments;                                                                                                       +----------+-------------+------+-----+---------+-------+
| Field    | Type        | Null | Key | Default | Extra |
+----------+-------------+------+-----+---------+-------+
| dep_id   | int(4)      | YES  | UNI | NULL    |       |
| dep_name | varchar(11) | YES  |     | NULL    |       |
+----------+-------------+------+-----+---------+-------+
rows in set (0.01 sec)

mysql&gt; create table staff_info (s_id int,name varchar(20),dep_id int,foreign key(dep_id) references departments(dep_id));
Query OK, 0 rows affected (0.02 sec)
多对一：单向的多对一
多对多：双向的多对一
一对一：</code></pre>
<h4 id="外键操作示例"><a href="#外键操作示例" class="headerlink" title="外键操作示例"></a>外键操作示例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">#表类型必须是innodb存储引擎，且被关联的字段，即references指定的另外一个表的字段，必须保证唯一</span><br><span class="line">create table department(</span><br><span class="line">id int primary key,</span><br><span class="line">name varchar(20) not null</span><br><span class="line">)engine&#x3D;innodb;</span><br><span class="line"></span><br><span class="line">#dpt_id外键，关联父表（department主键id），同步更新，同步删除</span><br><span class="line">create table employee(</span><br><span class="line">id int primary key,</span><br><span class="line">name varchar(20) not null,</span><br><span class="line">dpt_id int,</span><br><span class="line">foreign key(dpt_id)</span><br><span class="line">references department(id)</span><br><span class="line">on delete cascade  # 级连删除</span><br><span class="line">on update cascade # 级连更新</span><br><span class="line">)engine&#x3D;innodb;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#先往父表department中插入记录</span><br><span class="line">insert into department values</span><br><span class="line">(1,&#39;教质部&#39;),</span><br><span class="line">(2,&#39;技术部&#39;),</span><br><span class="line">(3,&#39;人力资源部&#39;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#再往子表employee中插入记录</span><br><span class="line">insert into employee values</span><br><span class="line">(1,&#39;jason&#39;,1),</span><br><span class="line">(2,&#39;oscar&#39;,2),</span><br><span class="line">(3,&#39;lqz&#39;,2),</span><br><span class="line">(4,&#39;tank&#39;,2),</span><br><span class="line">(5,&#39;mac&#39;,3),</span><br><span class="line">(6,&#39;李沁洋&#39;,3),</span><br><span class="line">(7,&#39;皮卡丘&#39;,3),</span><br><span class="line">(8,&#39;程咬金&#39;,3),</span><br><span class="line">(9,&#39;程咬银&#39;,3)</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#删父表department，子表employee中对应的记录跟着删</span><br><span class="line">mysql&gt; delete from department where id&#x3D;2;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from employee;</span><br><span class="line">+----+-----------+--------+</span><br><span class="line">| id | name      | dpt_id |</span><br><span class="line">+----+-----------+--------+</span><br><span class="line">|  1 | jason      |      1 |</span><br><span class="line">|  5 | mac     |      3 |</span><br><span class="line">|  6 | 李沁洋    |      3 |</span><br><span class="line">|  7 | 皮卡丘    |      3 |</span><br><span class="line">|  8 | 程咬金    |      3 |</span><br><span class="line">|  9 | 程咬银    |      3 |</span><br><span class="line">+----+-----------+--------+</span><br><span class="line">rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#更新父表department，子表employee中对应的记录跟着改</span><br><span class="line">mysql&gt; update department set id&#x3D;2 where id&#x3D;3;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from employee;</span><br><span class="line">+----+-----------+--------+</span><br><span class="line">| id | name      | dpt_id |</span><br><span class="line">+----+-----------+--------+</span><br><span class="line">|  1 | jason      |      1 |</span><br><span class="line">|  5 | mac     |      2 |</span><br><span class="line">|  6 | 李沁洋    |      2 |</span><br><span class="line">|  7 | 皮卡丘    |      2 |</span><br><span class="line">|  8 | 程咬金    |      2 |</span><br><span class="line">|  9 | 程咬银    |      2 |</span><br><span class="line">+----+-----------+--------+</span><br><span class="line">rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<h4 id="on-delete"><a href="#on-delete" class="headerlink" title="on delete"></a>on delete</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#  cascade方式</span><br><span class="line">在父表上update&#x2F;delete记录时，同步update&#x2F;delete掉子表的匹配记录 </span><br><span class="line"></span><br><span class="line">#  set null方式</span><br><span class="line">在父表上update&#x2F;delete记录时，将子表上匹配记录的列设为null</span><br><span class="line">要注意子表的外键列不能为not null  </span><br><span class="line"></span><br><span class="line">#  No action方式</span><br><span class="line">如果子表中有匹配的记录,则不允许对父表对应候选键进行update&#x2F;delete操作  </span><br><span class="line"></span><br><span class="line">#  Restrict方式</span><br><span class="line">同no action, 都是立即检查外键约束</span><br><span class="line"></span><br><span class="line">#  Set default方式</span><br><span class="line">父表有变更时,子表将外键列设置成一个默认的值 但Innodb不能识别</span><br></pre></td></tr></table></figure>

<h3 id="修改表"><a href="#修改表" class="headerlink" title="修改表"></a>修改表</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># MySQL对大小写不敏感</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">1. 修改表名</span></span><br><span class="line"><span class="string">    alter table 表名 rename 新表名</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">2. 增加字段</span></span><br><span class="line"><span class="string">    alter table 表名 add 字段名 字段类型(宽度)  约束条件; # 默认在最后</span></span><br><span class="line"><span class="string">    alter table 表名 add 字段名 字段类型(宽度)  约束条件 first;</span></span><br><span class="line"><span class="string">    alter table 表名 add 字段名 字段类型(宽度)  约束条件 after 字段名;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">3. 删除字段</span></span><br><span class="line"><span class="string">        alter table 表名 drop 字段名</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">4. 修改字段</span></span><br><span class="line"><span class="string">    alter table 表名 modify 字段名 字段类型(宽度) 约束条件;</span></span><br><span class="line"><span class="string">    alter table 表名 change 旧字段名 新字段名 字段类型(宽度) 约束条件;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="复制表"><a href="#复制表" class="headerlink" title="复制表"></a>复制表</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;&quot;</span><br><span class="line">sql查询结果就是一张虚拟表</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">create table 表名 select * from 旧表;   不能复制表结构，主键 外键。。。</span><br></pre></td></tr></table></figure>



<h2 id="记录相关操作"><a href="#记录相关操作" class="headerlink" title="记录相关操作"></a>记录相关操作</h2><h3 id="插入数据INSERT"><a href="#插入数据INSERT" class="headerlink" title="插入数据INSERT"></a>插入数据INSERT</h3><h3 id="更新数据UPDATE"><a href="#更新数据UPDATE" class="headerlink" title="更新数据UPDATE"></a>更新数据UPDATE</h3><h3 id="删除数据DELETE"><a href="#删除数据DELETE" class="headerlink" title="删除数据DELETE"></a>删除数据DELETE</h3><h3 id="查询数据SELECT"><a href="#查询数据SELECT" class="headerlink" title="查询数据SELECT"></a>查询数据SELECT</h3><h4 id="单表查询"><a href="#单表查询" class="headerlink" title="单表查询"></a>单表查询</h4><ul>
<li>单表查询语法:<ul>
<li>select distinct 字段1,字段2,字段3,… from 表名</li>
<li>where 条件</li>
<li>group by 分组的字段</li>
<li>having 条件</li>
<li>order by 排序字段</li>
<li>limit 限制显示的条数;</li>
</ul>
</li>
</ul>
<p>创建表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">company.employee</span><br><span class="line">    员工id      id                  int             </span><br><span class="line">    姓名        emp_name            varchar</span><br><span class="line">    性别        sex                 enum</span><br><span class="line">    年龄        age                 int</span><br><span class="line">    入职日期     hire_date           date</span><br><span class="line">    岗位        post                varchar</span><br><span class="line">    职位描述     post_comment        varchar</span><br><span class="line">    薪水        salary              double</span><br><span class="line">    办公室       office              int</span><br><span class="line">    部门编号     depart_id           int</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#创建表</span><br><span class="line">create table employee(</span><br><span class="line">id int not null unique auto_increment,</span><br><span class="line">name varchar(20) not null,</span><br><span class="line">sex enum(&#39;male&#39;,&#39;female&#39;) not null default &#39;male&#39;, #大部分是男的</span><br><span class="line">age int(3) unsigned not null default 28,</span><br><span class="line">hire_date date not null,</span><br><span class="line">post varchar(50),</span><br><span class="line">post_comment varchar(100),</span><br><span class="line">salary double(15,2),</span><br><span class="line">office int, #一个部门一个屋子</span><br><span class="line">depart_id int</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#查看表结构</span><br><span class="line">mysql&gt; desc employee;</span><br><span class="line">+--------------+-----------------------+------+-----+---------+----------------+</span><br><span class="line">| Field        | Type                  | Null | Key | Default | Extra          |</span><br><span class="line">+--------------+-----------------------+------+-----+---------+----------------+</span><br><span class="line">| id           | int(11)               | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| name         | varchar(20)           | NO   |     | NULL    |                |</span><br><span class="line">| sex          | enum(&#39;male&#39;,&#39;female&#39;) | NO   |     | male    |                |</span><br><span class="line">| age          | int(3) unsigned       | NO   |     | 28      |                |</span><br><span class="line">| hire_date    | date                  | NO   |     | NULL    |                |</span><br><span class="line">| post         | varchar(50)           | YES  |     | NULL    |                |</span><br><span class="line">| post_comment | varchar(100)          | YES  |     | NULL    |                |</span><br><span class="line">| salary       | double(15,2)          | YES  |     | NULL    |                |</span><br><span class="line">| office       | int(11)               | YES  |     | NULL    |                |</span><br><span class="line">| depart_id    | int(11)               | YES  |     | NULL    |                |</span><br><span class="line">+--------------+-----------------------+------+-----+---------+----------------+</span><br><span class="line"></span><br><span class="line">#插入记录</span><br><span class="line">#三个部门：教学，销售，运营</span><br><span class="line">insert into employee(name,sex,age,hire_date,post,salary,office,depart_id) values</span><br><span class="line">(&#39;egon&#39;,&#39;male&#39;,18,&#39;20170301&#39;,&#39;老男孩驻沙河办事处外交大使&#39;,7300.33,401,1), #以下是教学部</span><br><span class="line">(&#39;alex&#39;,&#39;male&#39;,78,&#39;20150302&#39;,&#39;teacher&#39;,1000000.31,401,1),</span><br><span class="line">(&#39;wupeiqi&#39;,&#39;male&#39;,81,&#39;20130305&#39;,&#39;teacher&#39;,8300,401,1),</span><br><span class="line">(&#39;yuanhao&#39;,&#39;male&#39;,73,&#39;20140701&#39;,&#39;teacher&#39;,3500,401,1),</span><br><span class="line">(&#39;liwenzhou&#39;,&#39;male&#39;,28,&#39;20121101&#39;,&#39;teacher&#39;,2100,401,1),</span><br><span class="line">(&#39;jingliyang&#39;,&#39;female&#39;,18,&#39;20110211&#39;,&#39;teacher&#39;,9000,401,1),</span><br><span class="line">(&#39;jinxin&#39;,&#39;male&#39;,18,&#39;19000301&#39;,&#39;teacher&#39;,30000,401,1),</span><br><span class="line">(&#39;成龙&#39;,&#39;male&#39;,48,&#39;20101111&#39;,&#39;teacher&#39;,10000,401,1),</span><br><span class="line"></span><br><span class="line">(&#39;歪歪&#39;,&#39;female&#39;,48,&#39;20150311&#39;,&#39;sale&#39;,3000.13,402,2),#以下是销售部门</span><br><span class="line">(&#39;丫丫&#39;,&#39;female&#39;,38,&#39;20101101&#39;,&#39;sale&#39;,2000.35,402,2),</span><br><span class="line">(&#39;丁丁&#39;,&#39;female&#39;,18,&#39;20110312&#39;,&#39;sale&#39;,1000.37,402,2),</span><br><span class="line">(&#39;星星&#39;,&#39;female&#39;,18,&#39;20160513&#39;,&#39;sale&#39;,3000.29,402,2),</span><br><span class="line">(&#39;格格&#39;,&#39;female&#39;,28,&#39;20170127&#39;,&#39;sale&#39;,4000.33,402,2),</span><br><span class="line"></span><br><span class="line">(&#39;张野&#39;,&#39;male&#39;,28,&#39;20160311&#39;,&#39;operation&#39;,10000.13,403,3), #以下是运营部门</span><br><span class="line">(&#39;程咬金&#39;,&#39;male&#39;,18,&#39;19970312&#39;,&#39;operation&#39;,20000,403,3),</span><br><span class="line">(&#39;程咬银&#39;,&#39;female&#39;,18,&#39;20130311&#39;,&#39;operation&#39;,19000,403,3),</span><br><span class="line">(&#39;程咬铜&#39;,&#39;male&#39;,18,&#39;20150411&#39;,&#39;operation&#39;,18000,403,3),</span><br><span class="line">(&#39;程咬铁&#39;,&#39;female&#39;,18,&#39;20140512&#39;,&#39;operation&#39;,17000,403,3)</span><br><span class="line">;</span><br><span class="line"></span><br><span class="line">#ps：如果在windows系统中，插入中文字符，select的结果为空白，可以将所有字符编码统一设置成gbk</span><br><span class="line"></span><br><span class="line">准备表和记录</span><br></pre></td></tr></table></figure>

<h5 id="书写建议"><a href="#书写建议" class="headerlink" title="书写建议"></a>书写建议</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 书写</span><br><span class="line">select id,name from emp where id &gt; 3;</span><br><span class="line"># 执行顺序</span><br><span class="line">from</span><br><span class="line">where</span><br><span class="line">select</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">虽然执行顺序和书写顺序不一致 你在写sql语句的时候可能不知道怎么写</span><br><span class="line">你就按照书写顺序的方式写sql</span><br><span class="line">    select * 占位</span><br><span class="line">    补全sql语句</span><br><span class="line">    * 替换成想要的具体字段</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<h5 id="几个重要关键字的执行顺序"><a href="#几个重要关键字的执行顺序" class="headerlink" title="几个重要关键字的执行顺序"></a>几个重要关键字的执行顺序</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">执行优先级</span><br><span class="line"><span class="number">1.</span>找到表:<span class="keyword">from</span></span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>拿着where指定的约束条件，去文件/表中取出一条条记录</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span>将取出的一条条记录进行分组group by，如果没有group by，则整体作为一组</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span>将分组的结果进行having过滤</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span>执行select</span><br><span class="line"></span><br><span class="line"><span class="number">6.</span>去重</span><br><span class="line"></span><br><span class="line"><span class="number">7.</span>将结果按条件排序：order by</span><br><span class="line"></span><br><span class="line"><span class="number">8.</span>限制结果的显示条数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">from</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">where</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">group</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">having</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">distinct</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">order</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">limit</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">select</span>():</span></span><br><span class="line">    f=<span class="keyword">from</span>()</span><br><span class="line">    vt1=where(f,条件)</span><br><span class="line">    vt2=group(v1,分组字段)</span><br><span class="line">    vt3=having(vt2,条件)</span><br><span class="line">    vt4=distinct(vt3)</span><br><span class="line">    vt5=order(vt4,排序的字段)</span><br><span class="line">    vt6=limit(vt5,限制显示的条数)</span><br><span class="line">    print(vt6)</span><br></pre></td></tr></table></figure>

<h5 id="where约束条件"><a href="#where约束条件" class="headerlink" title="where约束条件"></a>where约束条件</h5><p>where字句中可以使用：</p>
<ol>
<li>比较运算符：&gt; &lt; &gt;= &lt;= &lt;&gt; !=</li>
<li>between 80 and 100 值在10到20之间</li>
<li>in(80,90,100) 值是10或20或30</li>
<li>like ‘egon%’<br>  pattern可以是%或_，<br>  %表示任意多字符<br>  _表示一个字符</li>
<li>逻辑运算符：在多个条件直接可以使用逻辑运算符 and or not</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">#1:单条件查询</span><br><span class="line">    SELECT name FROM employee</span><br><span class="line">        WHERE post&#x3D;&#39;sale&#39;;</span><br><span class="line">        </span><br><span class="line">#2:多条件查询</span><br><span class="line">    SELECT name,salary FROM employee</span><br><span class="line">        WHERE post&#x3D;&#39;teacher&#39; AND salary&gt;10000;</span><br><span class="line"></span><br><span class="line">#3:关键字BETWEEN AND</span><br><span class="line">    SELECT name,salary FROM employee </span><br><span class="line">        WHERE salary BETWEEN 10000 AND 20000;</span><br><span class="line"></span><br><span class="line">    SELECT name,salary FROM employee </span><br><span class="line">        WHERE salary NOT BETWEEN 10000 AND 20000;</span><br><span class="line">    </span><br><span class="line">#4:关键字IS NULL(判断某个字段是否为NULL不能用等号，需要用IS)</span><br><span class="line">    SELECT name,post_comment FROM employee </span><br><span class="line">        WHERE post_comment IS NULL;</span><br><span class="line"></span><br><span class="line">    SELECT name,post_comment FROM employee </span><br><span class="line">        WHERE post_comment IS NOT NULL;</span><br><span class="line">        </span><br><span class="line">    SELECT name,post_comment FROM employee </span><br><span class="line">        WHERE post_comment&#x3D;&#39;&#39;; 注意&#39;&#39;是空字符串，不是null</span><br><span class="line">    ps：</span><br><span class="line">        执行</span><br><span class="line">        update employee set post_comment&#x3D;&#39;&#39; where id&#x3D;2;</span><br><span class="line">        再用上条查看，就会有结果了</span><br><span class="line"></span><br><span class="line">#5:关键字IN集合查询</span><br><span class="line">    SELECT name,salary FROM employee </span><br><span class="line">        WHERE salary&#x3D;3000 OR salary&#x3D;3500 OR salary&#x3D;4000 OR salary&#x3D;9000 ;</span><br><span class="line">    </span><br><span class="line">    SELECT name,salary FROM employee </span><br><span class="line">        WHERE salary IN (3000,3500,4000,9000) ;</span><br><span class="line"></span><br><span class="line">    SELECT name,salary FROM employee </span><br><span class="line">        WHERE salary NOT IN (3000,3500,4000,9000) ;</span><br><span class="line"></span><br><span class="line">#6:关键字LIKE模糊查询</span><br><span class="line">    通配符’%’</span><br><span class="line">    SELECT * FROM employee </span><br><span class="line">            WHERE name LIKE &#39;eg%&#39;;</span><br><span class="line"></span><br><span class="line">    通配符’_’</span><br><span class="line">    SELECT * FROM employee </span><br><span class="line">            WHERE name LIKE &#39;al__&#39;;</span><br></pre></td></tr></table></figure>

<h5 id="分组查询-GROUP-BY"><a href="#分组查询-GROUP-BY" class="headerlink" title="分组查询:GROUP BY"></a>分组查询:GROUP BY</h5><p><strong>什么是分组？为什么要分组？</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#1、首先明确一点：分组发生在where之后，即分组是基于where之后得到的记录而进行的</span><br><span class="line"></span><br><span class="line">#2、分组指的是：将所有记录按照某个相同字段进行归类，比如针对员工信息表的职位分组，或者按照性别进行分组等</span><br><span class="line"></span><br><span class="line">#3、为何要分组呢？</span><br><span class="line">    取每个部门的最高工资</span><br><span class="line">    取每个部门的员工数</span><br><span class="line">    取男人数和女人数</span><br><span class="line"></span><br><span class="line">小窍门：‘每’这个字后面的字段，就是我们分组的依据</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#4、大前提：</span><br><span class="line">    可以按照任意字段分组，但是分组完毕后，比如group by post，只能查看post字段，如果想查看组内信息，需要借助于聚合函数</span><br></pre></td></tr></table></figure>

<p><strong>ONLY_FULL_GROUP_BY</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#查看MySQL 5.7默认的sql_mode如下：</span><br><span class="line">mysql&gt; select @@global.sql_mode;</span><br><span class="line">ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION</span><br><span class="line"></span><br><span class="line">#！！！注意</span><br><span class="line">ONLY_FULL_GROUP_BY的语义就是确定select target list中的所有列的值都是明确语义，简单的说来，在ONLY_FULL_GROUP_BY模式下，target list中的值要么是来自于聚集函数的结果，要么是来自于group by list中的表达式的值。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#设置sql_mole如下操作(我们可以去掉ONLY_FULL_GROUP_BY模式)：</span><br><span class="line">mysql&gt; set global sql_mode&#x3D;&#39;STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION&#39;;</span><br><span class="line"></span><br><span class="line">！！！SQL_MODE设置！！！</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select @@global.sql_mode;</span><br><span class="line">+-------------------+</span><br><span class="line">| @@global.sql_mode |</span><br><span class="line">+-------------------+</span><br><span class="line">|                   |</span><br><span class="line">+-------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from emp group by post; </span><br><span class="line">+----+------+--------+-----+------------+----------------------------+--------------+------------+--------+-----------+</span><br><span class="line">| id | name | sex    | age | hire_date  | post                       | post_comment | salary     | office | depart_id |</span><br><span class="line">+----+------+--------+-----+------------+----------------------------+--------------+------------+--------+-----------+</span><br><span class="line">| 14 | 张野 | male   |  28 | 2016-03-11 | operation                  | NULL         |   10000.13 |    403 |         3 |</span><br><span class="line">|  9 | 歪歪 | female |  48 | 2015-03-11 | sale                       | NULL         |    3000.13 |    402 |         2 |</span><br><span class="line">|  2 | alex | male   |  78 | 2015-03-02 | teacher                    | NULL         | 1000000.31 |    401 |         1 |</span><br><span class="line">|  1 | egon | male   |  18 | 2017-03-01 | 老男孩驻沙河办事处外交大使 | NULL         |    7300.33 |    401 |         1 |</span><br><span class="line">+----+------+--------+-----+------------+----------------------------+--------------+------------+--------+-----------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#由于没有设置ONLY_FULL_GROUP_BY,于是也可以有结果，默认都是组内的第一条记录，但其实这是没有意义的</span><br><span class="line"></span><br><span class="line">mysql&gt; set global sql_mode&#x3D;&#39;ONLY_FULL_GROUP_BY&#39;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; quit #设置成功后，一定要退出，然后重新登录方可生效</span><br><span class="line">Bye</span><br><span class="line"></span><br><span class="line">mysql&gt; use db1;</span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; select * from emp group by post; #报错</span><br><span class="line">ERROR 1055 (42000): &#39;db1.emp.id&#39; isn&#39;t in GROUP BY</span><br><span class="line">mysql&gt; select post,count(id) from emp group by post; #只能查看分组依据和使用聚合函数</span><br><span class="line">+----------------------------+-----------+</span><br><span class="line">| post                       | count(id) |</span><br><span class="line">+----------------------------+-----------+</span><br><span class="line">| operation                  |         5 |</span><br><span class="line">| sale                       |         5 |</span><br><span class="line">| teacher                    |         7 |</span><br><span class="line">| 老男孩驻沙河办事处外交大使 |         1 |</span><br><span class="line">+----------------------------+-----------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>GROUP BY</strong>（GROUP_CONCAT，CONCAT）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"># 碰到的关键字一般使用group by</span><br><span class="line">每个 最高 最低 平均</span><br><span class="line"></span><br><span class="line">单独使用GROUP BY关键字分组</span><br><span class="line">    SELECT post FROM employee GROUP BY post;</span><br><span class="line">    注意：我们按照post字段分组，那么select查询的字段只能是post，想要获取组内的其他相关信息，需要借助函数</span><br><span class="line"></span><br><span class="line"># GROUP_CONCAT 获取分组之后的其他字段的值，还可以拼接操作</span><br><span class="line">GROUP BY关键字和GROUP_CONCAT()函数一起使用</span><br><span class="line">    SELECT post,GROUP_CONCAT(name) FROM employee GROUP BY post;#按照岗位分组，并查看组内成员名</span><br><span class="line">    SELECT post,GROUP_CONCAT(name) as emp_members FROM employee GROUP BY post;</span><br><span class="line">    # 还可以拼接</span><br><span class="line">    SELECT post,GROUP_CONCAT(name,&#39;_DSB&#39;) as emp_members FROM employee GROUP BY post;</span><br><span class="line">    SELECT post,GROUP_CONCAT(name,&#39;,&#39;,salary) as emp_members FROM employee GROUP BY post;</span><br><span class="line"></span><br><span class="line"># CONCAT 不分组的时候 拼接操作用</span><br><span class="line">    select concat(&#39;NAME:&#39;, name),concat(&#39;SAL:&#39;,salary) from emp;</span><br><span class="line"># CONCAT_WS 如果多个字段之间的连接符号是相同的情况下，可以直接使用concat_ws来完成</span><br><span class="line">    select concat_ws(&#39;:&#39;,name,age,sex) from emp;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GROUP BY与聚合函数一起使用</span><br><span class="line">    select post,count(id) as count from employee group by post;#按照岗位分组，并查看每个组有多少人</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"># 补充: as 不单单可以给字段起别名，还可以临时给表起别名</span><br><span class="line">select emp.id,emp.name from employee;</span><br><span class="line">select emp.id,emp.name from employee as t1; 报错</span><br><span class="line">select t1.id,t1.name from employee as t1;</span><br><span class="line"></span><br><span class="line"># 查询每个人的年薪</span><br><span class="line">select name,salary*12 from employee group by name;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>强调</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">如果我们用unique的字段作为分组的依据，则每一条记录自成一组，这种分组没有意义</span><br><span class="line">多条记录之间的某个字段值相同，该字段通常用来作为分组的依据</span><br></pre></td></tr></table></figure>

<p><strong>聚合函数</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#强调：聚合函数聚合的是组的内容，若是没有分组，则默认一组</span><br><span class="line"></span><br><span class="line">示例：</span><br><span class="line">    SELECT COUNT(*) FROM employee; # 计数，id最常用</span><br><span class="line">    SELECT COUNT(*) FROM employee WHERE depart_id&#x3D;1;</span><br><span class="line">    SELECT MAX(salary) FROM employee;</span><br><span class="line">    SELECT MIN(salary) FROM employee;</span><br><span class="line">    SELECT AVG(salary) FROM employee;</span><br><span class="line">    SELECT SUM(salary) FROM employee;</span><br><span class="line">    SELECT SUM(salary) FROM employee WHERE depart_id&#x3D;3;</span><br></pre></td></tr></table></figure>

<p><strong>注意事项</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 关键字where 和 group by同时出现的时候group by必须在where 后面</span><br><span class="line">where 先对整体数据进行过滤之后再分组操作</span><br><span class="line">where 筛选条件不能使用聚合函数</span><br><span class="line">select id,name,age from employee where max(salary) &gt; 3000;</span><br><span class="line"></span><br><span class="line">select max(salary) from emp;</span><br><span class="line"></span><br><span class="line"># 统计各部门年龄在30岁以上的员工平均薪资</span><br><span class="line">select post, AVG(salary),group_concat(name) from employee where age &gt; 30 group by post;</span><br></pre></td></tr></table></figure>

<h5 id="HAVING过滤-分组之后的筛选条件"><a href="#HAVING过滤-分组之后的筛选条件" class="headerlink" title="HAVING过滤,分组之后的筛选条件"></a><strong>HAVING过滤</strong>,分组之后的筛选条件</h5><p>“””</p>
<p>Having 的语法和where 是一致的</p>
<p>只不过having是在分组之后进行的过滤操作</p>
<p>即having是可以直接使用聚合函数的</p>
<p>“””</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 统计各部门年龄在30以上的平均工资并且保留平均薪资大于10000的部门</span><br><span class="line">select post,avg(salary) from employee where age&gt;30 group by psot having avg(salary) &gt; 10000;</span><br></pre></td></tr></table></figure>

<h5 id="distinct-去重"><a href="#distinct-去重" class="headerlink" title="distinct 去重"></a>distinct 去重</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;&quot;</span><br><span class="line">一定要注意 必须是完全一样的数据才可以去重！！！</span><br><span class="line">一定不要将主键忽视，有主键的情况下，是不可能去重复的；</span><br><span class="line"></span><br><span class="line">[</span><br><span class="line">  &#123;&#39;id&#39;:1,&#39;name&#39;:&#39;Jason&#39;,&#39;age&#39;:18&#125;,</span><br><span class="line">  &#123;&#39;id&#39;:2,&#39;name&#39;:&#39;Jason&#39;,&#39;age&#39;:18&#125;,</span><br><span class="line">  &#123;&#39;id&#39;:3,&#39;name&#39;:&#39;Egon&#39;,&#39;age&#39;:18&#125;,</span><br><span class="line">]</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">select distinct id,age from employee;</span><br><span class="line">select distinct age from employee;</span><br></pre></td></tr></table></figure>

<p><strong>查询排序:ORDER BY</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 按单列排序</span><br><span class="line">    SELECT * FROM employee ORDER BY salary;</span><br><span class="line">    SELECT * FROM employee ORDER BY salary ASC;</span><br><span class="line">    SELECT * FROM employee ORDER BY salary DESC;</span><br><span class="line"></span><br><span class="line"># 按多列排序:先按照age降序排序，如果年纪相同，则按照薪资排序(升序)</span><br><span class="line">    SELECT * from employee</span><br><span class="line">        ORDER BY age,</span><br><span class="line">        salary DESC;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 统计各部门年龄唉10岁以上的员工平均工资并且保留平均薪资大于1000的部门，然后对平均工资进行降序。</span><br><span class="line">select post,avg(salary) from employee where age&gt;10 group by post Having avg(salary)&gt;10000 order by avg(salary) Desc;</span><br></pre></td></tr></table></figure>

<p><strong>限制查询的记录数:LIMIT</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">示例：</span><br><span class="line">    SELECT * FROM employee ORDER BY salary DESC </span><br><span class="line">        LIMIT 3;                    #默认初始位置为0 </span><br><span class="line">    </span><br><span class="line">    SELECT * FROM employee ORDER BY salary DESC</span><br><span class="line">        LIMIT 0,5; #从第0开始，即先查询出第一条，然后包含这一条在内往后查5条</span><br><span class="line"></span><br><span class="line">    SELECT * FROM employee ORDER BY salary DESC</span><br><span class="line">        LIMIT 5,5; #从第5开始，即先查询出第6条，然后包含这一条在内往后查5条</span><br></pre></td></tr></table></figure>

<p><strong>正则</strong>（REGEXP）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM employee WHERE name REGEXP &#39;^ale&#39;;</span><br><span class="line"></span><br><span class="line">SELECT * FROM employee WHERE name REGEXP &#39;on$&#39;;</span><br><span class="line"></span><br><span class="line">SELECT * FROM employee WHERE name REGEXP &#39;m&#123;2&#125;&#39;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">小结：对字符串匹配的方式</span><br><span class="line">WHERE name &#x3D; &#39;egon&#39;;</span><br><span class="line">WHERE name LIKE &#39;yua%&#39;;</span><br><span class="line">WHERE name REGEXP &#39;on$&#39;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1. re模块常用方法</span><br><span class="line">          match: 从头开始匹配</span><br><span class="line">          search: 从整体匹配</span><br><span class="line">          findall: 分组优先展示</span><br><span class="line">                   ^j.*(n|y)$</span><br><span class="line">                   不会展示所有正则表达式匹配到的内容</span><br><span class="line">                   而仅仅展示括号内的正则表达式匹配到的内容</span><br><span class="line">2. 贪婪非贪婪</span><br><span class="line">   正则表达式都是贪婪匹配的，</span><br><span class="line">   将贪婪变成非贪婪职业需要在正则表达式后面加？</span><br><span class="line">   .*  贪婪</span><br><span class="line">   .*? 非贪婪</span><br></pre></td></tr></table></figure>



<h4 id><a href="#" class="headerlink" title></a></h4><h4 id="连表操作-连表查询-子查询"><a href="#连表操作-连表查询-子查询" class="headerlink" title="连表操作(连表查询+子查询)"></a>连表操作(连表查询+子查询)</h4><p>连表查询</p>
<pre><code>#重点：外链接语法

SELECT 字段列表
    FROM 表1 INNER|LEFT|RIGHT JOIN 表2
    ON 表1.字段 = 表2.字段;


1、inner join：只取两张表有对应关系的部分(共有的数据部分)
select * from emp inner join dep
    on emp.dep_id = dep.id
    ;
2、left join:在inner join的基础上保留左表中的记录(没有则NULL顶着)
select * from emp left join dep
    on emp.dep_id = dep.id
    ;

3、right join:在inner join的基础上保留右表中的记录(没有则NULL顶着)
select * from emp right join dep
    on emp.dep_id = dep.id
    ;

4、full join：在内连接的基础上左右两边的记录都保留
select * from emp left join dep on emp.dep_id = dep.id
union
select * from emp right join dep on emp.dep_id = dep.id
    ;</code></pre>
<h4 id="知识点补充"><a href="#知识点补充" class="headerlink" title="知识点补充"></a>知识点补充</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#查询平均年龄在25岁以上的部门名</span><br><span class="line"></span><br><span class="line">只要是多表查询，就有两种思路； 连表  和  子查询</span><br><span class="line"># 连表操作</span><br><span class="line">  1 先拿到部门和员工表 拼接之后结果</span><br><span class="line">  2 需要分组</span><br><span class="line">select department.name from employee inner join department </span><br><span class="line">    on employee.dep_id&#x3D;department.id </span><br><span class="line">    group by department.name </span><br><span class="line">    having avg(age)&gt;25 ;</span><br><span class="line"># 子查询</span><br><span class="line">select name from department where id in (select dep_id from employee group by dep_id having avg(age)&gt;25);</span><br></pre></td></tr></table></figure>





<h4 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#1：子查询是将一个查询语句嵌套在另一个查询语句中。</span><br><span class="line">#2：内层查询语句的查询结果，可以为外层查询语句提供查询条件。</span><br><span class="line">#3：子查询中可以包含：IN、NOT IN、ANY、ALL、EXISTS 和 NOT EXISTS等关键字</span><br><span class="line">#4：还可以包含比较运算符：&#x3D; 、 !&#x3D;、&gt; 、&lt;等</span><br></pre></td></tr></table></figure>

<p><strong>1 带IN关键字的子查询</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#查询平均年龄在25岁以上的部门名</span><br><span class="line">select id,name from department</span><br><span class="line">    where id in </span><br><span class="line">        (select dep_id from employee group by dep_id having avg(age) &gt; 25);</span><br><span class="line"></span><br><span class="line">#查看技术部员工姓名</span><br><span class="line">select name from employee</span><br><span class="line">    where dep_id in </span><br><span class="line">        (select id from department where name&#x3D;&#39;技术&#39;);</span><br><span class="line"></span><br><span class="line">#查看不足1人的部门名(子查询得到的是有人的部门id)</span><br><span class="line">select name from department where id not in (select distinct dep_id from employee);</span><br></pre></td></tr></table></figure>

<blockquote>
<p> 注意not in </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">not in 无法处理null的值，即子查询中如果存在null的值，not in将无法处理，如下</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from emp;</span><br><span class="line">+----+------------+--------+------+--------+</span><br><span class="line">| id | name | sex | age | dep_id |</span><br><span class="line">+----+------------+--------+------+--------+</span><br><span class="line">| 1 | egon | male | 18 | 200 |</span><br><span class="line">| 2 | alex | female | 48 | 201 |</span><br><span class="line">| 3 | wupeiqi | male | 38 | 201 |</span><br><span class="line">| 4 | yuanhao | female | 28 | 202 |</span><br><span class="line">| 5 | liwenzhou | male | 18 | 200 |</span><br><span class="line">| 6 | jingliyang | female | 18 | 204 |</span><br><span class="line">| 7 | xxx | male | 19 | NULL |</span><br><span class="line">+----+------------+--------+------+--------+</span><br><span class="line">7 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from dep;</span><br><span class="line">+------+--------------+</span><br><span class="line">| id | name |</span><br><span class="line">+------+--------------+</span><br><span class="line">| 200 | 技术 |</span><br><span class="line">| 201 | 人力资源 |</span><br><span class="line">| 202 | 销售 |</span><br><span class="line">| 203 | 运营 |</span><br><span class="line">+------+--------------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"># 子查询中存在null</span><br><span class="line">mysql&gt; select * from dep where id not in (select distinct dep_id from emp);</span><br><span class="line">Empty set (0.00 sec)</span><br><span class="line"></span><br><span class="line"># 解决方案如下</span><br><span class="line">mysql&gt; select * from dep where id not in (select distinct dep_id from emp where dep_id is not null);</span><br><span class="line">+------+--------+</span><br><span class="line">| id | name |</span><br><span class="line">+------+--------+</span><br><span class="line">| 203 | 运营 |</span><br><span class="line">+------+--------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt;</span><br><span class="line"></span><br><span class="line">！！！注意not in</span><br></pre></td></tr></table></figure>

<p><strong>2 带ANY关键字的子查询</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#在 SQL 中 ANY 和 SOME 是同义词，SOME 的用法和功能和 ANY 一模一样。</span><br><span class="line"></span><br><span class="line"># ANY 和 IN 运算符不同之处1</span><br><span class="line">ANY 必须和其他的比较运算符共同使用，而且ANY必须将比较运算符放在 ANY 关键字之前，所比较的值需要匹配子查询中的任意一个值，这也就是 ANY 在英文中所表示的意义</span><br><span class="line"></span><br><span class="line">例如：使用 IN 和使用 ANY运算符得到的结果是一致的</span><br><span class="line">select * from employee where salary &#x3D; any (</span><br><span class="line">select max(salary) from employee group by depart_id);</span><br><span class="line"></span><br><span class="line">select * from employee where salary in (</span><br><span class="line">select max(salary) from employee group by depart_id);</span><br><span class="line"></span><br><span class="line">结论：也就是说“&#x3D;ANY”等价于 IN 运算符，而“&lt;&gt;ANY”则等价于 NOT IN 运算符</span><br><span class="line"></span><br><span class="line"># ANY和 IN 运算符不同之处2</span><br><span class="line">ANY 运算符不能与固定的集合相匹配，比如下面的 SQL 语句是错误的</span><br><span class="line"></span><br><span class="line">SELECT</span><br><span class="line">*</span><br><span class="line">FROM</span><br><span class="line">T_Book</span><br><span class="line">WHERE</span><br><span class="line">FYearPublished &lt; ANY (2001, 2003, 2005)</span><br></pre></td></tr></table></figure>

<p><strong>3 带ALL关键字的子查询</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># all同any类似，只不过all表示的是所有，any表示任一</span><br><span class="line">查询出那些薪资比所有部门的平均薪资都高的员工&#x3D;》薪资在所有部门平均线以上的狗币资本家</span><br><span class="line">select * from employee where salary &gt; all (</span><br><span class="line">select avg(salary) from employee group by depart_id);</span><br><span class="line">查询出那些薪资比所有部门的平均薪资都低的员工&#x3D;》薪资在所有部门平均线以下的无产阶级劳苦大众</span><br><span class="line">select * from employee where salary &lt; all (</span><br><span class="line">select avg(salary) from employee group by depart_id);</span><br><span class="line"></span><br><span class="line">查询出那些薪资比任意一个部门的平均薪资低的员工&#x3D;》薪资在任一部门平均线以下的员工select * from employee where salary &lt; any ( select avg(salary) from employee group by depart_id); </span><br><span class="line">查询出那些薪资比任意一个部门的平均薪资高的员工&#x3D;》薪资在任一部门平均线以上的员工</span><br><span class="line">select * from employee where salary &gt; any (</span><br><span class="line">select avg(salary) from employee group by depart_id);</span><br></pre></td></tr></table></figure>

<p><strong>4 带比较运算符的子查询</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#比较运算符：&#x3D;、!&#x3D;、&gt;、&gt;&#x3D;、&lt;、&lt;&#x3D;、&lt;&gt;</span><br><span class="line">#查询大于所有人平均年龄的员工名与年龄</span><br><span class="line">mysql&gt; select name,age from emp where age &gt; (select avg(age) from emp);</span><br><span class="line">+---------+------+</span><br><span class="line">| name | age |</span><br><span class="line">+---------+------+</span><br><span class="line">| alex | 48 |</span><br><span class="line">| wupeiqi | 38 |</span><br><span class="line">+---------+------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#查询大于部门内平均年龄的员工名、年龄</span><br><span class="line">select t1.name,t1.age from emp t1</span><br><span class="line">inner join </span><br><span class="line">(select dep_id,avg(age) avg_age from emp group by dep_id) t2</span><br><span class="line">on t1.dep_id &#x3D; t2.dep_id</span><br><span class="line">where t1.age &gt; t2.avg_age;</span><br></pre></td></tr></table></figure>

<p><strong>5 带EXISTS关键字的子查询</strong></p>
<p>EXISTS关字键字表示存在。在使用EXISTS关键字时，内层查询语句不返回查询的记录。<br>而是返回一个真假值。True或False<br>当返回<strong>True</strong>时，<strong>外层查询语句将进行查询</strong>；当返回值为<strong>False</strong>时，<strong>外层查询语句不进行查询</strong>;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#department表中存在dept_id&#x3D;203，Ture</span><br><span class="line">mysql&gt; select * from employee</span><br><span class="line">    -&gt;     where exists</span><br><span class="line">    -&gt;         (select id from department where id&#x3D;200);</span><br><span class="line">+----+------------+--------+------+--------+</span><br><span class="line">| id | name       | sex    | age  | dep_id |</span><br><span class="line">+----+------------+--------+------+--------+</span><br><span class="line">|  1 | egon       | male   |   18 |    200 |</span><br><span class="line">|  2 | alex       | female |   48 |    201 |</span><br><span class="line">|  3 | wupeiqi    | male   |   38 |    201 |</span><br><span class="line">|  4 | yuanhao    | female |   28 |    202 |</span><br><span class="line">|  5 | liwenzhou  | male   |   18 |    200 |</span><br><span class="line">|  6 | jingliyang | female |   18 |    204 |</span><br><span class="line">+----+------------+--------+------+--------+</span><br><span class="line"></span><br><span class="line">#department表中存在dept_id&#x3D;205，False</span><br><span class="line">mysql&gt; select * from employee</span><br><span class="line">    -&gt;     where exists</span><br><span class="line">    -&gt;         (select id from department where id&#x3D;204);</span><br><span class="line">Empty set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>5.1 in与exists</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">！！！！！！当in和exists在查询效率上比较时，in查询的效率快于exists的查询效率！！！！！！</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;exists&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"># exists</span><br><span class="line">exists后面一般都是子查询，后面的子查询被称做相关子查询（即与主语句相关），当子查询返回行数时，exists条件返回true，</span><br><span class="line">否则返回false，exists是不返回列表的值的，exists只在乎括号里的数据能不能查找出来，是否存在这样的记录。</span><br><span class="line"></span><br><span class="line"># 例</span><br><span class="line">查询出那些班级里有学生的班级</span><br><span class="line">select * from class where exists (select * from stu where stu.cid&#x3D;class.id)</span><br><span class="line"></span><br><span class="line"># exists的执行原理为：</span><br><span class="line">1、依次执行外部查询：即select * from class </span><br><span class="line">2、然后为外部查询返回的每一行分别执行一次子查询：即(select * from stu where stu.cid&#x3D;class.cid)</span><br><span class="line">3、子查询如果返回行，则exists条件成立，条件成立则输出外部查询取出的那条记录</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;in&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"># in</span><br><span class="line">in后跟的都是子查询，in()后面的子查询 是返回结果集的</span><br><span class="line"></span><br><span class="line"># 例</span><br><span class="line">查询和所有女生年龄相同的男生</span><br><span class="line">select * from stu where sex&#x3D;&#39;男&#39; and age in(select age from stu where sex&#x3D;&#39;女&#39;)</span><br><span class="line"></span><br><span class="line"># in的执行原理为：</span><br><span class="line">in()的执行次序和exists()不一样,in()的子查询会先产生结果集,</span><br><span class="line">然后主查询再去结果集里去找符合要求的字段列表去.符合要求的输出,反之则不输出.</span><br></pre></td></tr></table></figure>

<p><strong>5.2 not in与 not exists</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">!!!!!!not exists查询的效率远远高与not in查询的效率。!!!!!!</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;not in&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">not in()子查询的执行顺序是：</span><br><span class="line">为了证明not in成立，即找不到，需要一条一条地查询表，符合要求才返回子查询的结果集，不符合的就继续查询下一条记录，直到把表中的记录查询完，只能查询全部记录才能证明，并没有用到索引。</span><br><span class="line">                </span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;not exists&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">not exists：</span><br><span class="line">如果主查询表中记录少，子查询表中记录多，并有索引。</span><br><span class="line">例如:查询那些班级中没有学生的班级</span><br><span class="line">select * from class</span><br><span class="line"></span><br><span class="line">where not exists</span><br><span class="line"></span><br><span class="line">(select * from student where student.cid &#x3D; class.cid)</span><br><span class="line"></span><br><span class="line">not exists的执行顺序是：</span><br><span class="line">在表中查询，是根据索引查询的，如果存在就返回true，如果不存在就返回false，不会每条记录都去查询。</span><br></pre></td></tr></table></figure>











<p>示例1：找出年龄大于25岁的员工以及员工所在的部门</p>
<pre><code>select emp.name,dep.name from emp inner join dep
    on emp.dep_id = dep.id
    where age &gt; 25
    ;</code></pre>
<p>示例1：找出平均年龄&gt;=20的部门名</p>
<pre><code>select dep.name,avg(age) from emp inner join dep
    on emp.dep_id = dep.id
    group by dep.name
    having avg(age) &gt;= 20;


    select name from dep where id in
    (select  dep_id from emp group by dep_id having avg(age) &gt;= 20);



    select * from emp inner join dep
    on emp.dep_id = dep.id
    where dep.name = &#39;销售&#39;;


    select * from emp where dep_id =
    (select id from dep where name =&#39;销售&#39;);



    select * from t2 inner join

    (select * from emp inner join dep
    on emp.dep_id = dep.id) as t1

    on t2.xx = t1.yy


    练习：查询每个部门最新入职的那位员工</code></pre>
<p>select t1.name,t1.hire_date,t1.post,t2.post,t2.max_date from emp as t1<br>inner join<br>(select post,max(hire_date) as max_date from emp group by post) as t2<br>on t1.post = t2.post<br>where t1.hire_date = t2.max_date<br>;</p>
<h2 id="pymysql模块"><a href="#pymysql模块" class="headerlink" title="pymysql模块"></a>pymysql模块</h2><h3 id="一-链接、执行sql、关闭（游标）"><a href="#一-链接、执行sql、关闭（游标）" class="headerlink" title="一 链接、执行sql、关闭（游标）"></a><strong>一 链接、执行sql、关闭（游标）</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">user=input(<span class="string">&#x27;用户名: &#x27;</span>).strip()</span><br><span class="line">pwd=input(<span class="string">&#x27;密码: &#x27;</span>).strip()</span><br><span class="line"></span><br><span class="line"><span class="comment">#链接</span></span><br><span class="line">conn=pymysql.connect(host=<span class="string">&#x27;localhost&#x27;</span>,user=<span class="string">&#x27;root&#x27;</span>,password=<span class="string">&#x27;123&#x27;</span>,database=<span class="string">&#x27;egon&#x27;</span>,charset=<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line"><span class="comment">#游标</span></span><br><span class="line">cursor=conn.cursor() <span class="comment">#执行完毕返回的结果集默认以元组显示</span></span><br><span class="line">cursor=conn.cursor(cursor=pymysql.cursors.DictCursor) 以字典的方式返回</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#执行sql语句</span></span><br><span class="line">sql=<span class="string">&#x27;select * from userinfo where name=&quot;%s&quot; and password=&quot;%s&quot;&#x27;</span> %(user,pwd) <span class="comment">#注意%s需要加引号</span></span><br><span class="line">print(sql)</span><br><span class="line">res=cursor.execute(sql) <span class="comment">#执行sql语句，返回sql查询成功的记录数目</span></span><br><span class="line">print(res)</span><br><span class="line"></span><br><span class="line">cursor.close()</span><br><span class="line">conn.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> res:</span><br><span class="line">    print(<span class="string">&#x27;登录成功&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">&#x27;登录失败&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="二-execute-之sql注入"><a href="#二-execute-之sql注入" class="headerlink" title="二 execute()之sql注入"></a><strong>二 execute()之sql注入</strong></h3><p>注意：符号–会注释掉它之后的sql，正确的语法：–后至少有一个任意字符</p>
<p>根本原理：就根据程序的字符串拼接name=’%s’，我们输入一个<strong>xxx’ – haha</strong>,用我们输入的xxx加’在程序中拼接成一个判断条件name=<strong>‘xxx’ – haha’</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">最后那一个空格，在一条sql语句中如果遇到select * from t1 where id &gt; 3 -- and name&#x3D;&#39;egon&#39;;则--之后的条件被注释掉了</span><br><span class="line"></span><br><span class="line">#1、sql注入之：用户存在，绕过密码</span><br><span class="line">egon&#39; -- 任意字符</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">select * from user where name&#x3D;&#39;jason&#39; -- asdsad&#39; and password&#x3D;&#39;&#39;</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">#2、sql注入之：用户不存在，绕过用户与密码</span><br><span class="line">xxx&#39; or 1&#x3D;1 -- 任意字符</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">select * from user where name&#x3D;&#39;xxx&#39; or 1&#x3D;1 -- asdsadsad&#39; and password&#x3D;&#39;&#39;</span><br><span class="line">&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>

<p>![image-20210426172311389](/Users/waylonyan/Library/Application Support/typora-user-images/image-20210426172311389.png)</p>
<p><img src="https://gitee.com/waylon1006/blog_pic/raw/master/pic/image-20210426172326630.png" alt="image-20210426172326630"></p>
<p><img src="https://gitee.com/waylon1006/blog_pic/raw/master/pic/image-20210426172403230.png" alt="image-20210426172403230"></p>
<p>解决方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">如何解决上述问题？</span><br><span class="line">  日常软件在获取用户输入内容之后，都会限制一些特殊符号的输入；</span><br><span class="line">  所有敏感信息不要靠自己去做拼接操作，交互固定的模块帮你去过滤数据防止SQL注入。</span><br><span class="line">  在pymysql中 excute就能够帮你过滤</span><br><span class="line"></span><br><span class="line"># 原来是我们对sql进行字符串拼接</span><br><span class="line"># sql&#x3D;&quot;select * from userinfo where name&#x3D;&#39;%s&#39; and password&#x3D;&#39;%s&#39;&quot; %(user,pwd)</span><br><span class="line"># print(sql)</span><br><span class="line"># res&#x3D;cursor.execute(sql)</span><br><span class="line"></span><br><span class="line">#改写为（execute帮我们做字符串拼接，我们无需且一定不能再为%s加引号了,pymysql自动识别%s后面元祖里面数据进行替换）</span><br><span class="line">sql&#x3D;&quot;select * from userinfo where name&#x3D;%s and password&#x3D;%s&quot; #！！！注意%s需要去掉引号，因为pymysql会自动为我们加上</span><br><span class="line">res&#x3D;cursor.execute(sql,[user,pwd]) #pymysql模块自动帮我们解决sql注入的问题，只要我们按照pymysql的规矩来。</span><br></pre></td></tr></table></figure>

<h3 id="三-增、删、改：conn-commit"><a href="#三-增、删、改：conn-commit" class="headerlink" title="三 增、删、改：conn.commit()"></a><strong>三 增、删、改：conn.commit()</strong></h3><blockquote>
<p>重点是多行数据提交</p>
</blockquote>
<blockquote>
<p>可以直接设置autocommit =True</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"><span class="comment">#链接</span></span><br><span class="line">conn=pymysql.connect(host=<span class="string">&#x27;localhost&#x27;</span>,user=<span class="string">&#x27;root&#x27;</span>,password=<span class="string">&#x27;123&#x27;</span>,database=<span class="string">&#x27;egon&#x27;</span>)</span><br><span class="line"><span class="comment">#游标</span></span><br><span class="line">cursor=conn.cursor(pymysql.cursors.DictCursor)</span><br><span class="line"></span><br><span class="line"><span class="comment">#执行sql语句</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#part1</span></span><br><span class="line">sql=<span class="string">&#x27;insert into userinfo(name,password) values(%s,%s);&#x27;</span></span><br><span class="line">res=cursor.execute(sql,(<span class="string">&quot;root&quot;</span>,<span class="string">&quot;123456&quot;</span>)) <span class="comment">#执行sql语句，返回sql影响成功的行数</span></span><br><span class="line">print(res)</span><br><span class="line"></span><br><span class="line"><span class="comment">#part2 增加多条数据 （列表套元祖的形式）</span></span><br><span class="line">sql=<span class="string">&#x27;insert into userinfo(name,password) values(%s,%s);&#x27;</span></span><br><span class="line">res=cursor.executemany(sql,[(<span class="string">&quot;root&quot;</span>,<span class="string">&quot;123456&quot;</span>),(<span class="string">&quot;lhf&quot;</span>,<span class="string">&quot;12356&quot;</span>),(<span class="string">&quot;eee&quot;</span>,<span class="string">&quot;156&quot;</span>)]) <span class="comment">#执行sql语句，返回sql影响成功的行数</span></span><br><span class="line">print(res)</span><br><span class="line"></span><br><span class="line"><span class="comment">#part3   更新数据</span></span><br><span class="line">sql=<span class="string">&#x27;update user set name=&quot;jason111&quot; where id=1&#x27;</span></span><br><span class="line">rows = cursor.execute(sql)</span><br><span class="line"></span><br><span class="line"><span class="comment">#part4   删除数据</span></span><br><span class="line">sql = <span class="string">&#x27;delete from user where id=1&#x27;</span></span><br><span class="line">rows = cursor.execute(sql)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">conn.commit() <span class="comment">#提交后才发现表中插入记录成功</span></span><br><span class="line">cursor.close()</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>



<h3 id="四-查：fetchone，fetchmany，fetchall"><a href="#四-查：fetchone，fetchmany，fetchall" class="headerlink" title="四 查：fetchone，fetchmany，fetchall"></a><strong>四 查：fetchone，fetchmany，fetchall</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"><span class="comment">#链接</span></span><br><span class="line">conn=pymysql.connect(host=<span class="string">&#x27;localhost&#x27;</span>,user=<span class="string">&#x27;root&#x27;</span>,password=<span class="string">&#x27;123&#x27;</span>,database=<span class="string">&#x27;egon&#x27;</span>)</span><br><span class="line"><span class="comment">#游标</span></span><br><span class="line">cursor=conn.cursor()</span><br><span class="line"></span><br><span class="line"><span class="comment">#执行sql语句</span></span><br><span class="line">sql=<span class="string">&#x27;select * from userinfo;&#x27;</span></span><br><span class="line">rows=cursor.execute(sql) <span class="comment">#执行sql语句，返回sql影响成功的行数rows,将结果放入一个集合，等待被查询</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># cursor.scroll(3,mode=&#x27;absolute&#x27;) # 相对开头位置移动，</span></span><br><span class="line"><span class="comment"># cursor.scroll(3,mode=&#x27;relative&#x27;) # 相对当前位置移动</span></span><br><span class="line">res1=cursor.fetchone()</span><br><span class="line">res2=cursor.fetchone()</span><br><span class="line">res3=cursor.fetchone()</span><br><span class="line">res4=cursor.fetchmany(<span class="number">2</span>)</span><br><span class="line">res5=cursor.fetchall()</span><br><span class="line">print(res1)</span><br><span class="line">print(res2)</span><br><span class="line">print(res3)</span><br><span class="line">print(res4)</span><br><span class="line">print(res5)</span><br><span class="line">print(<span class="string">&#x27;%s rows in set (0.00 sec)&#x27;</span> %rows)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">conn.commit() <span class="comment">#提交后才发现表中插入记录成功</span></span><br><span class="line">cursor.close()</span><br><span class="line">conn.close()</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">(1, &#x27;root&#x27;, &#x27;123456&#x27;)</span></span><br><span class="line"><span class="string">(2, &#x27;root&#x27;, &#x27;123456&#x27;)</span></span><br><span class="line"><span class="string">(3, &#x27;root&#x27;, &#x27;123456&#x27;)</span></span><br><span class="line"><span class="string">((4, &#x27;root&#x27;, &#x27;123456&#x27;), (5, &#x27;root&#x27;, &#x27;123456&#x27;))</span></span><br><span class="line"><span class="string">((6, &#x27;root&#x27;, &#x27;123456&#x27;), (7, &#x27;lhf&#x27;, &#x27;12356&#x27;), (8, &#x27;eee&#x27;, &#x27;156&#x27;))</span></span><br><span class="line"><span class="string">rows in set (0.00 sec)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="五-获取插入的最后一条数据的自增ID"><a href="#五-获取插入的最后一条数据的自增ID" class="headerlink" title="五 获取插入的最后一条数据的自增ID"></a><strong>五 获取插入的最后一条数据的自增ID</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">conn=pymysql.connect(host=<span class="string">&#x27;localhost&#x27;</span>,user=<span class="string">&#x27;root&#x27;</span>,password=<span class="string">&#x27;123&#x27;</span>,database=<span class="string">&#x27;egon&#x27;</span>)</span><br><span class="line">cursor=conn.cursor()</span><br><span class="line"></span><br><span class="line">sql=<span class="string">&#x27;insert into userinfo(name,password) values(&quot;xxx&quot;,&quot;123&quot;);&#x27;</span></span><br><span class="line">rows=cursor.execute(sql)</span><br><span class="line">print(cursor.lastrowid) <span class="comment">#在插入语句后查看</span></span><br><span class="line"></span><br><span class="line">conn.commit()</span><br><span class="line"></span><br><span class="line">cursor.close()</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>




    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/note/" rel="tag"><i class="fas fa-cookie-bite"></i> note</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/12/28/py-drf-02/" rel="prev" title="py-drf-02">
      <i class="fa fa-chevron-left"></i> py-drf-02
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/03/24/py-day03-%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/" rel="next" title="py-day03-字符编码">
      py-day03-字符编码 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="nav-number">1.</span> <span class="nav-text">基本概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E5%BA%93%E8%A1%A8%E8%AF%AD%E5%8F%A5"><span class="nav-number">2.</span> <span class="nav-text">基本库表语句</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="nav-number">3.</span> <span class="nav-text">存储引擎</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">4.</span> <span class="nav-text">数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E5%AD%97%E7%B1%BB%E5%9E%8B"><span class="nav-number">4.1.</span> <span class="nav-text">数字类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E7%B1%BB%E5%9E%8B%EF%BC%9Achar-%E5%AE%9A%E9%95%BF-%EF%BC%8Cvarchar-%E5%8F%98%E9%95%BF"><span class="nav-number">4.2.</span> <span class="nav-text">字符类型：char(定长)，varchar(变长)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A5%E6%9C%9F%E7%B1%BB%E5%9E%8B%EF%BC%9Atime%EF%BC%8Cdate%EF%BC%8Cdatetime%EF%BC%8Ctimestamp%EF%BC%8Cyear"><span class="nav-number">4.3.</span> <span class="nav-text">日期类型：time，date，datetime，timestamp，year</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8Benum%E4%B8%8E%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8Bset"><span class="nav-number">4.4.</span> <span class="nav-text">枚举类型enum与集合类型set</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A1%A8%E6%93%8D%E4%BD%9C%E4%B9%8B%E7%BA%A6%E6%9D%9F%E6%9D%A1%E4%BB%B6"><span class="nav-number">5.</span> <span class="nav-text">表操作之约束条件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#default"><span class="nav-number">5.1.</span> <span class="nav-text">default</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#not-null"><span class="nav-number">5.2.</span> <span class="nav-text">not null</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#zerofill"><span class="nav-number">5.3.</span> <span class="nav-text">zerofill</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#unsigned"><span class="nav-number">5.4.</span> <span class="nav-text">unsigned</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%95%E5%88%97%E5%94%AF%E4%B8%80"><span class="nav-number">5.4.1.</span> <span class="nav-text">单列唯一</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%81%94%E5%90%88%E5%94%AF%E4%B8%80"><span class="nav-number">5.4.2.</span> <span class="nav-text">联合唯一</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#not-null-unqiue-%E5%8C%96%E5%AD%A6%E5%8F%8D%E5%BA%94"><span class="nav-number">5.4.3.</span> <span class="nav-text">not null +  unqiue 化学反应</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#primary-key"><span class="nav-number">5.5.</span> <span class="nav-text">primary key</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%80%E5%AF%B9%E5%A4%9A%EF%BC%88%E5%A4%96%E9%94%AE%E5%BB%BA%E5%9C%A8%E5%A4%9A%E7%9A%84%E4%B8%80%E6%96%B9%EF%BC%89-%E7%BA%A7%E8%81%94"><span class="nav-number">5.5.1.</span> <span class="nav-text">一对多（外键建在多的一方）  级联</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%9A%E5%AF%B9%E5%A4%9A"><span class="nav-number">5.5.2.</span> <span class="nav-text">多对多</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%80%E5%AF%B9%E4%B8%80-%E5%A4%96%E9%94%AE%E5%AD%97%E6%AE%B5%E5%9C%A8%E4%BB%BB%E4%BD%95%E4%B8%80%E6%96%B9%E9%83%BD%E5%8F%AF%E4%BB%A5%EF%BC%8C%E5%BB%BA%E8%AE%AE%E5%BB%BA%E5%9C%A8%E6%9F%A5%E8%AF%A2%E9%A2%91%E7%8E%87%E6%AF%94%E8%BE%83%E9%AB%98%E7%9A%84%E8%A1%A8%E4%B8%AD"><span class="nav-number">5.5.3.</span> <span class="nav-text">一对一: 外键字段在任何一方都可以，建议建在查询频率比较高的表中</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A5%E5%85%85"><span class="nav-number">5.5.4.</span> <span class="nav-text">补充</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E9%80%A0%E5%A4%96%E9%94%AE%E7%9A%84%E6%9D%A1%E4%BB%B6"><span class="nav-number">5.5.5.</span> <span class="nav-text">创造外键的条件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%96%E9%94%AE%E6%93%8D%E4%BD%9C%E7%A4%BA%E4%BE%8B"><span class="nav-number">5.5.6.</span> <span class="nav-text">外键操作示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#on-delete"><span class="nav-number">5.5.7.</span> <span class="nav-text">on delete</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E8%A1%A8"><span class="nav-number">5.6.</span> <span class="nav-text">修改表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%8D%E5%88%B6%E8%A1%A8"><span class="nav-number">5.7.</span> <span class="nav-text">复制表</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%B0%E5%BD%95%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C"><span class="nav-number">6.</span> <span class="nav-text">记录相关操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AEINSERT"><span class="nav-number">6.1.</span> <span class="nav-text">插入数据INSERT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AEUPDATE"><span class="nav-number">6.2.</span> <span class="nav-text">更新数据UPDATE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AEDELETE"><span class="nav-number">6.3.</span> <span class="nav-text">删除数据DELETE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AESELECT"><span class="nav-number">6.4.</span> <span class="nav-text">查询数据SELECT</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%95%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="nav-number">6.4.1.</span> <span class="nav-text">单表查询</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B9%A6%E5%86%99%E5%BB%BA%E8%AE%AE"><span class="nav-number">6.4.1.1.</span> <span class="nav-text">书写建议</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%87%A0%E4%B8%AA%E9%87%8D%E8%A6%81%E5%85%B3%E9%94%AE%E5%AD%97%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="nav-number">6.4.1.2.</span> <span class="nav-text">几个重要关键字的执行顺序</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#where%E7%BA%A6%E6%9D%9F%E6%9D%A1%E4%BB%B6"><span class="nav-number">6.4.1.3.</span> <span class="nav-text">where约束条件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2-GROUP-BY"><span class="nav-number">6.4.1.4.</span> <span class="nav-text">分组查询:GROUP BY</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#HAVING%E8%BF%87%E6%BB%A4-%E5%88%86%E7%BB%84%E4%B9%8B%E5%90%8E%E7%9A%84%E7%AD%9B%E9%80%89%E6%9D%A1%E4%BB%B6"><span class="nav-number">6.4.1.5.</span> <span class="nav-text">HAVING过滤,分组之后的筛选条件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#distinct-%E5%8E%BB%E9%87%8D"><span class="nav-number">6.4.1.6.</span> <span class="nav-text">distinct 去重</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link"><span class="nav-number">6.4.2.</span> <span class="nav-text"></span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%9E%E8%A1%A8%E6%93%8D%E4%BD%9C-%E8%BF%9E%E8%A1%A8%E6%9F%A5%E8%AF%A2-%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">6.4.3.</span> <span class="nav-text">连表操作(连表查询+子查询)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%E8%A1%A5%E5%85%85"><span class="nav-number">6.4.4.</span> <span class="nav-text">知识点补充</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="nav-number">6.4.5.</span> <span class="nav-text">子查询</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#pymysql%E6%A8%A1%E5%9D%97"><span class="nav-number">7.</span> <span class="nav-text">pymysql模块</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80-%E9%93%BE%E6%8E%A5%E3%80%81%E6%89%A7%E8%A1%8Csql%E3%80%81%E5%85%B3%E9%97%AD%EF%BC%88%E6%B8%B8%E6%A0%87%EF%BC%89"><span class="nav-number">7.1.</span> <span class="nav-text">一 链接、执行sql、关闭（游标）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C-execute-%E4%B9%8Bsql%E6%B3%A8%E5%85%A5"><span class="nav-number">7.2.</span> <span class="nav-text">二 execute()之sql注入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89-%E5%A2%9E%E3%80%81%E5%88%A0%E3%80%81%E6%94%B9%EF%BC%9Aconn-commit"><span class="nav-number">7.3.</span> <span class="nav-text">三 增、删、改：conn.commit()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9B-%E6%9F%A5%EF%BC%9Afetchone%EF%BC%8Cfetchmany%EF%BC%8Cfetchall"><span class="nav-number">7.4.</span> <span class="nav-text">四 查：fetchone，fetchmany，fetchall</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%94-%E8%8E%B7%E5%8F%96%E6%8F%92%E5%85%A5%E7%9A%84%E6%9C%80%E5%90%8E%E4%B8%80%E6%9D%A1%E6%95%B0%E6%8D%AE%E7%9A%84%E8%87%AA%E5%A2%9EID"><span class="nav-number">7.5.</span> <span class="nav-text">五 获取插入的最后一条数据的自增ID</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Waylon Yan"
      src="/images/timg.jpeg">
  <p class="site-author-name" itemprop="name">Waylon Yan</p>
  <div class="site-description" itemprop="description">tech life sharing</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">34</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Waylonwhynot" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Waylonwhynot" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:ywl1006@outlook.com" title="E-Mail → mailto:ywl1006@outlook.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Waylon Yan</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">381k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">10:35</span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div> -->

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
